var Uu=Object.create;var Nt=Object.defineProperty;var Vu=Object.getOwnPropertyDescriptor;var Zu=Object.getOwnPropertyNames;var Hu=Object.getPrototypeOf,zu=Object.prototype.hasOwnProperty;var Gu=(e,t,a)=>t in e?Nt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var Yu=(e,t)=>{for(var a in t)Nt(e,a,{get:t[a],enumerable:!0})},gs=(e,t,a,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Zu(t))!zu.call(e,r)&&r!==a&&Nt(e,r,{get:()=>t[r],enumerable:!(n=Vu(t,r))||n.enumerable});return e};var $u=(e,t,a)=>(a=e!=null?Uu(Hu(e)):{},gs(t||!e||!e.__esModule?Nt(a,"default",{value:e,enumerable:!0}):a,e)),Qu=e=>gs(Nt({},"__esModule",{value:!0}),e);var Y=(e,t,a)=>(Gu(e,typeof t!="symbol"?t+"":t,a),a),sa=(e,t,a)=>{if(!t.has(e))throw TypeError("Cannot "+a)};var D=(e,t,a)=>(sa(e,t,"read from private field"),a?a.call(e):t.get(e)),Q=(e,t,a)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,a)},et=(e,t,a,n)=>(sa(e,t,"write to private field"),n?n.call(e,a):t.set(e,a),a);var _t=(e,t,a)=>(sa(e,t,"access private method"),a);var Zf={};Yu(Zf,{Parser:()=>Ds});module.exports=Qu(Zf);var qu=require("tiny-typed-emitter");var ot=(d=>(d[d.none=0]="none",d[d.slot=1]="slot",d[d.stat=2]="stat",d[d.ability_point=3]="ability_point",d[d.combat_effect=4]="combat_effect",d[d.skill_damage=5]="skill_damage",d[d.skill_critical_ratio=6]="skill_critical_ratio",d[d.skill_critical_damage=7]="skill_critical_damage",d[d.skill_penetration=8]="skill_penetration",d[d.npc_grade_less_damage=9]="npc_grade_less_damage",d[d.npc_grade_less_critical_ratio=10]="npc_grade_less_critical_ratio",d[d.npc_grade_less_critical_damage=11]="npc_grade_less_critical_damage",d[d.npc_grade_less_penetration=12]="npc_grade_less_penetration",d[d.npc_grade_greater_damage=13]="npc_grade_greater_damage",d[d.npc_grade_greater_critical_ratio=14]="npc_grade_greater_critical_ratio",d[d.npc_grade_greater_critical_damage=15]="npc_grade_greater_critical_damage",d[d.npc_grade_greater_penetration=16]="npc_grade_greater_penetration",d[d.npc_species_damage=17]="npc_species_damage",d[d.npc_species_critical_ratio=18]="npc_species_critical_ratio",d[d.npc_species_critical_damage=19]="npc_species_critical_damage",d[d.npc_species_penetration=20]="npc_species_penetration",d[d.npc_attr_damage=21]="npc_attr_damage",d[d.npc_attr_critical_ratio=22]="npc_attr_critical_ratio",d[d.npc_attr_critical_damage=23]="npc_attr_critical_damage",d[d.npc_attr_penetration=24]="npc_attr_penetration",d[d.mana_reduction=25]="mana_reduction",d[d.skill_mana_reduction=26]="skill_mana_reduction",d[d.skill_cooldown_reduction=27]="skill_cooldown_reduction",d[d.ability_feature=28]="ability_feature",d[d.class_option=29]="class_option",d[d.ability_point_passive=30]="ability_point_passive",d[d.instrument=31]="instrument",d[d.skill_feature=32]="skill_feature",d[d.npc_adaptation=33]="npc_adaptation",d[d.skill_group_damage=34]="skill_group_damage",d[d.skill_group_cooldown_reduction=35]="skill_group_cooldown_reduction",d[d.skill_level=36]="skill_level",d[d.skill_feature_level=37]="skill_feature_level",d[d.life_casting_speed=38]="life_casting_speed",d[d.life_casting_tier=39]="life_casting_tier",d[d.life_bonus_type_success=40]="life_bonus_type_success",d[d.life_bonus_type_extra=41]="life_bonus_type_extra",d[d.life_bonus_type_skill_bonus=42]="life_bonus_type_skill_bonus",d[d.life_bonus_type_minigame_perfect=43]="life_bonus_type_minigame_perfect",d[d.life_durability_bonus=44]="life_durability_bonus",d[d.life_mini_game_difficulty=45]="life_mini_game_difficulty",d[d.combat_effect_cooldown_reduction=46]="combat_effect_cooldown_reduction",d[d.skill_damage_addend=47]="skill_damage_addend",d[d.awakening_usable_count_addend=48]="awakening_usable_count_addend",d[d.battle_item_heal=49]="battle_item_heal",d[d.party_heal=50]="party_heal",d[d.party_shield=51]="party_shield",d[d.identity_gauge=52]="identity_gauge",d[d.attack_power_amplify_addend=53]="attack_power_amplify_addend",d[d.attack_power_amplify_multiplier=54]="attack_power_amplify_multiplier",d[d.not_in_party_damage=55]="not_in_party_damage",d[d.skill_effect_group_set_damage=56]="skill_effect_group_set_damage",d))(ot||{});var Be=(P=>(P[P.none=0]="none",P[P.modify_damage=1]="modify_damage",P[P.modify_final_damage=2]="modify_final_damage",P[P.modify_critical_ratio=3]="modify_critical_ratio",P[P.modify_critical_multiplier=4]="modify_critical_multiplier",P[P.modify_penetration=5]="modify_penetration",P[P.modify_penetration_when_critical=6]="modify_penetration_when_critical",P[P.exec_active_effect_when_damage=7]="exec_active_effect_when_damage",P[P.exec_active_effect_when_critical=8]="exec_active_effect_when_critical",P[P.exec_reactive_effect_when_miss=9]="exec_reactive_effect_when_miss",P[P.exec_reactive_effect_when_damage=10]="exec_reactive_effect_when_damage",P[P.exec_reactive_effect_when_critical=11]="exec_reactive_effect_when_critical",P[P.exec_after_effect=12]="exec_after_effect",P[P.exec_after_skill=13]="exec_after_skill",P[P.apply_heal=14]="apply_heal",P[P.modify_reactive_damage=15]="modify_reactive_damage",P[P.modify_damage_shield_multiplier=16]="modify_damage_shield_multiplier",P[P.exec_active_effect_when_kill=17]="exec_active_effect_when_kill",P[P.exec_start_skill=18]="exec_start_skill",P[P.modify_penetration_addend=19]="modify_penetration_addend",P[P.modify_penetration_addend_when_critical=20]="modify_penetration_addend_when_critical",P[P.modify_reactive_critical_multiplier=21]="modify_reactive_critical_multiplier",P[P.modify_damage_when_critical=22]="modify_damage_when_critical",P[P.modify_paralyzation_point=23]="modify_paralyzation_point",P[P.exec_when_counter=24]="exec_when_counter",P[P.exec_when_be_killed=25]="exec_when_be_killed",P))(Be||{});var ua=(b=>(b[b.none=0]="none",b[b.underling=1]="underling",b[b.normal=2]="normal",b[b.elite=3]="elite",b[b.named=4]="named",b[b.seed=5]="seed",b[b.boss=6]="boss",b[b.raid=7]="raid",b[b.lucky=8]="lucky",b[b.epic_raid=9]="epic_raid",b[b.commander=10]="commander",b))(ua||{});var Ce=(a=>(a[a.absolute=0]="absolute",a[a.relative=1]="relative",a))(Ce||{});var Me=(u=>(u[u.none=0]="none",u[u.enable_notify=1]="enable_notify",u[u.enable_dir_change=2]="enable_dir_change",u[u.change_move_dist=3]="change_move_dist",u[u.change_layer=4]="change_layer",u[u.change_stage_speed=5]="change_stage_speed",u[u.change_stage_collision=6]="change_stage_collision",u[u.change_max_target=7]="change_max_target",u[u.change_area_range=8]="change_area_range",u[u.change_area_angle=9]="change_area_angle",u[u.change_cost=10]="change_cost",u[u.recover_cost=11]="recover_cost",u[u.recover_used_cost=12]="recover_used_cost",u[u.reduce_default_cooldown=13]="reduce_default_cooldown",u[u.reduce_active_cooldown=14]="reduce_active_cooldown",u[u.enable_stage_buff=15]="enable_stage_buff",u[u.add_stage_buff=16]="add_stage_buff",u[u.change_buff_area_range=17]="change_buff_area_range",u[u.change_buff_duration=18]="change_buff_duration",u[u.change_buff_stat=19]="change_buff_stat",u[u.change_buff_stack=20]="change_buff_stack",u[u.change_buff_param=21]="change_buff_param",u[u.change_buff_expired_action=22]="change_buff_expired_action",u[u.change_chain_ratio=23]="change_chain_ratio",u[u.change_abnormal=24]="change_abnormal",u[u.change_abnormal_ratio=25]="change_abnormal_ratio",u[u.change_dam_attr=26]="change_dam_attr",u[u.change_dam_value=27]="change_dam_value",u[u.change_dam_coefficient=28]="change_dam_coefficient",u[u.change_dam_critical=29]="change_dam_critical",u[u.change_dam_critical_rate=30]="change_dam_critical_rate",u[u.change_attack_stage_speed=31]="change_attack_stage_speed",u[u.change_stack_charge_time=32]="change_stack_charge_time",u[u.change_stack_max_count=33]="change_stack_max_count",u[u.change_targeting=34]="change_targeting",u[u.change_min_range=35]="change_min_range",u[u.change_max_range=36]="change_max_range",u[u.change_push_info=37]="change_push_info",u[u.change_parts_attack_attr=38]="change_parts_attack_attr",u[u.change_skill_chain_info=39]="change_skill_chain_info",u[u.change_skill_chain_delay=40]="change_skill_chain_delay",u[u.change_behit_move_info=41]="change_behit_move_info",u[u.add_buff_stat=42]="add_buff_stat",u[u.add_chain_skill_effect=43]="add_chain_skill_effect",u[u.remove_chain_skill_effect=44]="remove_chain_skill_effect",u[u.add_chain_combat_effect=45]="add_chain_combat_effect",u[u.remove_chain_combat_effect=46]="remove_chain_combat_effect",u[u.change_skill_effect_bonus=47]="change_skill_effect_bonus",u[u.change_skill_effect_ai_point=48]="change_skill_effect_ai_point",u[u.change_dam_addend=49]="change_dam_addend",u[u.change_hitted=50]="change_hitted",u[u.change_skill_move_speed=51]="change_skill_move_speed",u[u.add_skill_buff=52]="add_skill_buff",u[u.change_skill_bonus=53]="change_skill_bonus",u[u.change_skill_normal_info=54]="change_skill_normal_info",u[u.change_skill_invisibility=55]="change_skill_invisibility",u[u.change_skill_constraint=56]="change_skill_constraint",u[u.change_skill_book_type=57]="change_skill_book_type",u[u.change_projection_skill_effect_id=58]="change_projection_skill_effect_id",u[u.change_push_pvp_info=59]="change_push_pvp_info",u[u.change_forced_critical=60]="change_forced_critical",u[u.change_instance_skill_effect_info=61]="change_instance_skill_effect_info",u[u.change_skill_start_stage=62]="change_skill_start_stage",u[u.change_skill_effect_dir_target=63]="change_skill_effect_dir_target",u[u.change_stage_dir_rate=64]="change_stage_dir_rate",u[u.change_projection=65]="change_projection",u[u.change_skill_view=66]="change_skill_view",u[u.change_projectile_speed=67]="change_projectile_speed",u[u.change_projectile_dist=68]="change_projectile_dist",u[u.change_projectile_resourcescale=69]="change_projectile_resourcescale",u[u.change_projectile_max_target_hit_count=70]="change_projectile_max_target_hit_count",u[u.change_summon_trap_lifetime=71]="change_summon_trap_lifetime",u[u.change_summon_trap_destroy_delaytime=72]="change_summon_trap_destroy_delaytime",u[u.change_summon_trap_react_info=73]="change_summon_trap_react_info",u[u.change_summon_trap_invoke_effect=74]="change_summon_trap_invoke_effect",u[u.change_summon_trap_count=75]="change_summon_trap_count",u[u.enable_identity_event=76]="enable_identity_event",u[u.change_identity_proc_value=77]="change_identity_proc_value",u[u.change_skill_effect_identity_proc_info=78]="change_skill_effect_identity_proc_info",u[u.change_identity_proc_pvp_value=79]="change_identity_proc_pvp_value",u[u.change_skill_effect_identity_proc_pvp_info=80]="change_skill_effect_identity_proc_pvp_info",u[u.change_skill_effect_identity_proc_replace_info=81]="change_skill_effect_identity_proc_replace_info",u[u.change_skill_effect_identity_proc_replace_pvp_info=82]="change_skill_effect_identity_proc_replace_pvp_info",u[u.swap_chain_skill_effect=83]="swap_chain_skill_effect",u[u.swap_chain_combat_effect=84]="swap_chain_combat_effect",u[u.change_charge_scale=85]="change_charge_scale",u[u.change_summon_npc_id=86]="change_summon_npc_id",u[u.change_summon_npc_sight_range=87]="change_summon_npc_sight_range",u[u.change_summon_npc_pursuit_range=88]="change_summon_npc_pursuit_range",u[u.change_summon_npc_walk_movespeed=89]="change_summon_npc_walk_movespeed",u[u.change_summon_npc_battle_movespeed=90]="change_summon_npc_battle_movespeed",u[u.change_summon_npc_life_time=91]="change_summon_npc_life_time",u[u.change_summon_npc_ai_index=92]="change_summon_npc_ai_index",u[u.change_summon_npc_invincible_duration=93]="change_summon_npc_invincible_duration",u[u.change_summon_npc_acquire_identity=94]="change_summon_npc_acquire_identity",u[u.change_summon_npc_skill_id=95]="change_summon_npc_skill_id",u[u.change_summon_npc_die_skill_id=96]="change_summon_npc_die_skill_id",u[u.change_summon_npc_destroy_skill_id=97]="change_summon_npc_destroy_skill_id",u[u.change_summon_npc_spawn_buff_id=98]="change_summon_npc_spawn_buff_id",u[u.change_summon_npc_count=99]="change_summon_npc_count",u[u.change_summon_npc_stat=100]="change_summon_npc_stat",u[u.change_summon_npc_threat_point=101]="change_summon_npc_threat_point",u[u.change_summon_npc_skill_usable_tick=102]="change_summon_npc_skill_usable_tick",u[u.change_summon_npc_skill_use_order=103]="change_summon_npc_skill_use_order",u[u.change_combat_effect_arg=104]="change_combat_effect_arg",u[u.change_skill_effect_cost=105]="change_skill_effect_cost",u[u.change_accumulate_dam_rate=106]="change_accumulate_dam_rate",u[u.change_projectile_bank_data_addend=107]="change_projectile_bank_data_addend",u[u.change_identity_category=108]="change_identity_category",u[u.change_skill_slot_visible_effect=109]="change_skill_slot_visible_effect",u[u.change_attack_mask=110]="change_attack_mask",u[u.change_aim_target_max_range=111]="change_aim_target_max_range",u))(Me||{}),bt=(s=>(s[s.none=0]="none",s[s.hp=1]="hp",s[s.mp=2]="mp",s[s.str=3]="str",s[s.agi=4]="agi",s[s.int=5]="int",s[s.con=6]="con",s[s.str_x=7]="str_x",s[s.agi_x=8]="agi_x",s[s.int_x=9]="int_x",s[s.con_x=10]="con_x",s[s.criticalhit=15]="criticalhit",s[s.specialty=16]="specialty",s[s.oppression=17]="oppression",s[s.rapidity=18]="rapidity",s[s.endurance=19]="endurance",s[s.mastery=20]="mastery",s[s.criticalhit_x=21]="criticalhit_x",s[s.specialty_x=22]="specialty_x",s[s.oppression_x=23]="oppression_x",s[s.rapidity_x=24]="rapidity_x",s[s.endurance_x=25]="endurance_x",s[s.mastery_x=26]="mastery_x",s[s.max_hp=27]="max_hp",s[s.max_mp=28]="max_mp",s[s.max_hp_x=29]="max_hp_x",s[s.max_mp_x=30]="max_mp_x",s[s.max_hp_x_x=31]="max_hp_x_x",s[s.max_mp_x_x=32]="max_mp_x_x",s[s.normal_hp_recovery=33]="normal_hp_recovery",s[s.combat_hp_recovery=34]="combat_hp_recovery",s[s.normal_hp_recovery_rate=35]="normal_hp_recovery_rate",s[s.combat_hp_recovery_rate=36]="combat_hp_recovery_rate",s[s.normal_mp_recovery=37]="normal_mp_recovery",s[s.combat_mp_recovery=38]="combat_mp_recovery",s[s.normal_mp_recovery_rate=39]="normal_mp_recovery_rate",s[s.combat_mp_recovery_rate=40]="combat_mp_recovery_rate",s[s.self_recovery_rate=41]="self_recovery_rate",s[s.drain_hp_dam_rate=42]="drain_hp_dam_rate",s[s.drain_mp_dam_rate=43]="drain_mp_dam_rate",s[s.dam_reflection_rate=44]="dam_reflection_rate",s[s.char_attack_dam=47]="char_attack_dam",s[s.skill_effect_dam_addend=48]="skill_effect_dam_addend",s[s.attack_power_rate=49]="attack_power_rate",s[s.skill_damage_rate=50]="skill_damage_rate",s[s.attack_power_rate_x=51]="attack_power_rate_x",s[s.skill_damage_rate_x=52]="skill_damage_rate_x",s[s.cooldown_reduction=53]="cooldown_reduction",s[s.paralyzation_point_rate=54]="paralyzation_point_rate",s[s.def=55]="def",s[s.res=56]="res",s[s.def_x=57]="def_x",s[s.res_x=58]="res_x",s[s.def_x_x=59]="def_x_x",s[s.res_x_x=60]="res_x_x",s[s.critical_physical_inc_rate=65]="critical_physical_inc_rate",s[s.critical_magical_inc_rate=66]="critical_magical_inc_rate",s[s.def_pen_rate=67]="def_pen_rate",s[s.res_pen_rate=68]="res_pen_rate",s[s.physical_inc_rate=69]="physical_inc_rate",s[s.magical_inc_rate=70]="magical_inc_rate",s[s.self_shield_rate=71]="self_shield_rate",s[s.hit_rate=72]="hit_rate",s[s.dodge_rate=73]="dodge_rate",s[s.critical_hit_rate=74]="critical_hit_rate",s[s.critical_res_rate=75]="critical_res_rate",s[s.critical_dam_rate=76]="critical_dam_rate",s[s.attack_speed=77]="attack_speed",s[s.attack_speed_rate=78]="attack_speed_rate",s[s.move_speed=79]="move_speed",s[s.move_speed_rate=80]="move_speed_rate",s[s.prop_move_speed=81]="prop_move_speed",s[s.prop_move_speed_rate=82]="prop_move_speed_rate",s[s.vehicle_move_speed=83]="vehicle_move_speed",s[s.vehicle_move_speed_rate=84]="vehicle_move_speed_rate",s[s.ship_move_speed=85]="ship_move_speed",s[s.ship_move_speed_rate=86]="ship_move_speed_rate",s[s.fire_dam_rate=87]="fire_dam_rate",s[s.ice_dam_rate=88]="ice_dam_rate",s[s.electricity_dam_rate=89]="electricity_dam_rate",s[s.earth_dam_rate=91]="earth_dam_rate",s[s.dark_dam_rate=92]="dark_dam_rate",s[s.holy_dam_rate=93]="holy_dam_rate",s[s.elements_dam_rate=94]="elements_dam_rate",s[s.fire_res_rate=95]="fire_res_rate",s[s.ice_res_rate=96]="ice_res_rate",s[s.electricity_res_rate=97]="electricity_res_rate",s[s.earth_res_rate=99]="earth_res_rate",s[s.dark_res_rate=100]="dark_res_rate",s[s.holy_res_rate=101]="holy_res_rate",s[s.elements_res_rate=102]="elements_res_rate",s[s.self_cc_time_rate=105]="self_cc_time_rate",s[s.enemy_cc_time_rate=106]="enemy_cc_time_rate",s[s.identity_value1=107]="identity_value1",s[s.identity_value2=108]="identity_value2",s[s.identity_value3=109]="identity_value3",s[s.awakening_dam_rate=110]="awakening_dam_rate",s[s.item_drop_rate=111]="item_drop_rate",s[s.gold_rate=112]="gold_rate",s[s.exp_rate=113]="exp_rate",s[s.attack_power_addend=123]="attack_power_addend",s[s.attack_power_addend_2=124]="attack_power_addend_2",s[s.npc_species_humanoid_dam_rate=125]="npc_species_humanoid_dam_rate",s[s.npc_species_devil_dam_rate=126]="npc_species_devil_dam_rate",s[s.npc_species_substance_dam_rate=127]="npc_species_substance_dam_rate",s[s.npc_species_undead_dam_rate=128]="npc_species_undead_dam_rate",s[s.npc_species_plant_dam_rate=129]="npc_species_plant_dam_rate",s[s.npc_species_insect_dam_rate=130]="npc_species_insect_dam_rate",s[s.npc_species_spirit_dam_rate=131]="npc_species_spirit_dam_rate",s[s.npc_species_wild_beast_dam_rate=132]="npc_species_wild_beast_dam_rate",s[s.npc_species_mechanic_dam_rate=133]="npc_species_mechanic_dam_rate",s[s.npc_species_ancient_dam_rate=134]="npc_species_ancient_dam_rate",s[s.npc_species_god_dam_rate=135]="npc_species_god_dam_rate",s[s.npc_species_archfiend_dam_rate=136]="npc_species_archfiend_dam_rate",s[s.vitality=137]="vitality",s[s.ship_booter_speed=138]="ship_booter_speed",s[s.ship_wreck_speed_rate=139]="ship_wreck_speed_rate",s[s.island_speed_rate=140]="island_speed_rate",s[s.attack_power_sub_rate_1=141]="attack_power_sub_rate_1",s[s.attack_power_sub_rate_2=142]="attack_power_sub_rate_2",s[s.physical_inc_sub_rate_1=143]="physical_inc_sub_rate_1",s[s.physical_inc_sub_rate_2=144]="physical_inc_sub_rate_2",s[s.magical_inc_sub_rate_1=145]="magical_inc_sub_rate_1",s[s.magical_inc_sub_rate_2=146]="magical_inc_sub_rate_2",s[s.skill_damage_sub_rate_1=147]="skill_damage_sub_rate_1",s[s.skill_damage_sub_rate_2=148]="skill_damage_sub_rate_2",s[s.resource_recovery_rate=149]="resource_recovery_rate",s[s.weapon_dam=151]="weapon_dam",s[s.weapon_dam_x=152]="weapon_dam_x",s))(bt||{});var je=(i=>(i[i.normal=0]="normal",i[i.hard=1]="hard",i[i.hellchaos=2]="hellchaos",i[i.challenge=3]="challenge",i[i.special=4]="special",i[i.extreme=5]="extreme",i))(je||{});var Ls=require("tiny-typed-emitter");var z,yt,W,Rt,fa,ht,Oe,ma=class extends Ls.TypedEmitter{constructor(a,n,r=!0,o=!!process.env.DEV){super();Q(this,Rt);Q(this,ht);Y(this,"PartyStatusEffectRegistry");Y(this,"LocalStatusEffectRegistry");Q(this,z,void 0);Q(this,yt,void 0);Q(this,W,void 0);Y(this,"debug");Y(this,"trace",!1);this.PartyStatusEffectRegistry=new Map,this.LocalStatusEffectRegistry=new Map,this.debug=o,et(this,z,a),et(this,yt,n),et(this,W,r)}getStatusEffectRegistryForPlayer(a,n){let r=this.getPlayerRegistry(n),o=r.get(a);if(o)return o;let i=new Map;return r.set(a,i),i}hasStatusEffectRegistryForPlayer(a,n){return this.getPlayerRegistry(n).has(a)}getPlayerRegistry(a){switch(a){case 1:return this.LocalStatusEffectRegistry;case 0:return this.PartyStatusEffectRegistry;default:break}return this.LocalStatusEffectRegistry}RemoveLocalObject(a,n){let r=this.LocalStatusEffectRegistry.get(a);if(r)for(let[,o]of r)this.RemoveStatusEffect(a,o.instanceId,1,void 0,n);this.LocalStatusEffectRegistry.delete(a)}RemovePartyObject(a,n){let r=this.PartyStatusEffectRegistry.get(a);if(r)for(let[,o]of r)this.RemoveStatusEffect(a,o.instanceId,0,void 0,n);this.PartyStatusEffectRegistry.delete(a)}RegisterStatusEffect(a){let n=this.getStatusEffectRegistryForPlayer(a.targetId,a.type),r=n.get(a.instanceId);r?D(this,W)&&r.expirationTimer&&(clearTimeout(r.expirationTimer),r.expirationTimer=void 0):a.effectType===0&&this.emit("shieldApplied",a),n.set(a.instanceId,a),this.SetupStatusEffectTimeout(a)}HasAnyStatusEffect(a,n,r,o){if(!this.hasStatusEffectRegistryForPlayer(a,n))return!1;let i=this.getStatusEffectRegistryForPlayer(a,n);for(let[,f]of i)if(!(!D(this,W)&&!this.IsReplayStatusEffectValidElseRemove(f,o))){for(let c of r)if(c===f.statusEffectId)return!0}return!1}IsReplayStatusEffectValidElseRemove(a,n){return a.expireAt===void 0||a.expireAt.getTime()>n.getTime()?!0:(this.ExpireStatusEffectByTimeout(a),!1)}HasAnyStatusEffectFromParty(a,n,r,o,i){if(!this.hasStatusEffectRegistryForPlayer(a,n))return!1;let f=this.getStatusEffectRegistryForPlayer(a,n);for(let[,c]of f)if(!(!D(this,W)&&!this.IsReplayStatusEffectValidElseRemove(c,i))&&o.includes(c.statusEffectId)){let l=D(this,z).getPartyIdFromEntityId(c.sourceId);if(this.ValidForWholeRaid(c))return l!==void 0;if(l===r)return!0}return!1}RemoveStatusEffect(a,n,r,o,i){if(!this.hasStatusEffectRegistryForPlayer(a,r))return;let f=this.getStatusEffectRegistryForPlayer(a,r),c=f.get(n);return c&&(D(this,W)&&(clearTimeout(c.expirationTimer),c.expirationTimer=void 0),f.delete(n),o===4&&(D(this,W)||this.IsReplayStatusEffectValidElseRemove(c,i))&&this.RegisterValueUpdate(c,c.value,0)),c}GetStatusEffects(a,n,r,o){if(!this.hasStatusEffectRegistryForPlayer(a,n))return[];let i=this.getStatusEffectRegistryForPlayer(a,n);if(!D(this,W))for(let[,c]of i)this.IsReplayStatusEffectValidElseRemove(c,r);let f=[...i.values()];return o!==void 0?f.filter((c,l,S)=>c.sourceId===o):f}GetStatusEffectsFromParty(a,n,r,o){if(!this.hasStatusEffectRegistryForPlayer(a,n))return[];let i=this.getStatusEffectRegistryForPlayer(a,n);if(!D(this,W))for(let[,f]of i)this.IsReplayStatusEffectValidElseRemove(f,o);return[...i.values()].filter(f=>this.ValidForWholeRaid(f)?D(this,z).getPartyIdFromEntityId(f.sourceId)!==void 0:r===D(this,z).getPartyIdFromEntityId(f.sourceId))}Clear(a){let n=0;for(let[,o]of this.LocalStatusEffectRegistry){for(let[,i]of o)this.RemoveStatusEffect(i.targetId,i.instanceId,i.type,void 0,a);n+=o.size}let r=0;for(let[,o]of this.PartyStatusEffectRegistry){for(let[,i]of o)this.RemoveStatusEffect(i.targetId,i.instanceId,i.type,void 0,a);r+=o.size}this.trace&&console.log("On Clear SE in local",n,"in party",r),this.LocalStatusEffectRegistry.clear(),this.PartyStatusEffectRegistry.clear()}UpdateDuration(a,n,r,o){let f=this.getStatusEffectRegistryForPlayer(n,o).get(a);if(f){let c=r-f.timestamp;if(D(this,W)&&f.expirationTimer&&(this.trace&&console.log("Clearing timeout for",f.instanceId,"because of duration change"),clearTimeout(f.expirationTimer),f.expirationTimer=void 0),f.expireAt){let l=f.expireAt.getTime()+Number(c),S=l-f.pktTime.getTime();S>0?(this.trace&&console.log("Extending duration by",c,"ms","New timeout delay",S,"from",f.expireAt.toISOString(),"to",new Date(l).toISOString()),D(this,W)&&(f.expirationTimer=setTimeout(this.ExpireStatusEffectByTimeout.bind(this,f),S)),f.expireAt=new Date(l),f.timestamp=r):f.expireAt=void 0}}else this.debug&&console.error("Tried to update duration for SE with instanceId",a," on target",n,"but where is no such SE registered")}SyncStatusEffect(a,n,r,o,i){let f=_t(this,ht,Oe).call(this,n,i),c=f?0:1,l=f?n:r;if(!l)return;let b=this.getStatusEffectRegistryForPlayer(l,c).get(a);if(!b)return;let I=b.value;b.value=o,this.RegisterValueUpdate(b,I,o)}ValidForWholeRaid(a){return(a.buffCategory===3||a.buffCategory===1||a.buffCategory===2)&&a.category===1&&a.showType===1}SetupStatusEffectTimeout(a){if(a.expirationDelay>0&&a.expirationDelay<604800){let n=a.pktTime.getTime()>a.occurTime.getTime()?a.pktTime:a.occurTime,r=Math.ceil(a.expirationDelay*1e3),o=n.getTime()+r+ma.TIMEOUT_DELAY_MS-a.pktTime.getTime();a.expireAt=new Date(a.pktTime.getTime()+o),this.trace&&console.log("Setting up statuseffect expiration time for",a.name,a.instanceId,"to",a.expireAt.toISOString(),"with delay",o),D(this,W)&&(a.expirationTimer=setTimeout(this.ExpireStatusEffectByTimeout.bind(this,a),o))}}ExpireStatusEffectByTimeout(a){this.debug&&console.error("Triggered timeout on",a.name,"with iid",a.instanceId),this.RemoveStatusEffect(a.targetId,a.instanceId,a.type,void 0,new Date)}RegisterValueUpdate(a,n,r){a.effectType===0&&this.emit("shieldChanged",a,n,r)}newPC(a,n,r){let o=_t(this,ht,Oe).call(this,a.pcStruct.characterId,n);o?this.RemovePartyObject(a.pcStruct.characterId,r):this.RemoveLocalObject(a.pcStruct.playerId,r);for(let i of a.pcStruct.statusEffectDatas)this.RegisterStatusEffect(this.buildStatusEffect(i,o?a.pcStruct.characterId:a.pcStruct.playerId,i.sourceId,o?0:1,r))}buildStatusEffect(a,n,r,o,i){let f=a.value?a.value.readUInt32LE():0,c=a.value?a.value.readUInt32LE(8):0,l=f<c?f:c,S=0,b=0,I=0,H="Unknown",L=1,K=D(this,yt).skillBuff.get(a.statusEffectId);if(K){switch(H=K.name,K.category){case"debuff":S=1;break}switch(K.buffcategory){case"bracelet":b=1;break;case"etc":b=2;break;case"battleitem":b=3;break}switch(K.iconshowtype){case"all":I=1;break}switch(K.type){case"shield":L=0;break}}return{instanceId:a.effectInstanceId,sourceId:r,statusEffectId:a.statusEffectId,targetId:n,type:o,dbTarget:K?.target??"none",value:l,buffCategory:b,category:S,showType:I,expirationDelay:a.totalTime,expirationTimer:void 0,timestamp:a.endTick,expireAt:void 0,occurTime:a.occurTime,name:H,pktTime:i,effectType:L,stackCount:a.stackCount}}getStatusEffects(a,n,r,o){let i=[],f=[],c=_t(this,Rt,fa).call(this,a,r),l=this.GetStatusEffects(c?a.characterId:a.entityId,c?0:1,o,void 0);for(let S of l)f.push([S.statusEffectId,S.sourceId,S.stackCount]);if(n){let S=_t(this,Rt,fa).call(this,n,r),b=D(this,z).isEntityInParty(a.entityId),I=b?D(this,z).getPartyIdFromEntityId(a.entityId):void 0,H=b&&I?this.GetStatusEffectsFromParty(S?n.characterId:n.entityId,S?0:1,I,o):this.GetStatusEffects(S?n.characterId:n.entityId,S?0:1,o,a.entityId);for(let L of H)L.type===1&&L.category===1&&L.sourceId!==a.entityId&&L.dbTarget==="self"||i.push([L.statusEffectId,L.sourceId,L.stackCount])}return[f,i]}},Dt=ma;z=new WeakMap,yt=new WeakMap,W=new WeakMap,Rt=new WeakSet,fa=function(a,n){if(a.entityType!==1)return!1;let r=a;return _t(this,ht,Oe).call(this,r.characterId,n)},ht=new WeakSet,Oe=function(a,n){let r=D(this,z).isCharacterInParty(n),o=D(this,z).isCharacterInParty(a);if(r){if(!o||a===n)return!1;let i=D(this,z).getPartyIdFromCharacterId(n),f=D(this,z).getPartyIdFromCharacterId(a);return i===f}return!1},Y(Dt,"TIMEOUT_DELAY_MS",1e3);var qe=class{#t;#n;#r;#i;entities=new Map;localPlayer;constructor(t,a,n,r){this.#t=t,this.#n=a,this.#r=n,this.#i=r,this.localPlayer={entityId:0n,entityType:1,name:"You",class:0,gearLevel:0,characterId:0n,stance:0,stats:new Map,skills:new Map,items:{}}}processNewPC(t){let a=t.parsed;if(!a)return;let n={entityId:a.pcStruct.playerId,entityType:1,name:a.pcStruct.name,class:a.pcStruct.classId,gearLevel:a.pcStruct.maxItemLevel,characterId:a.pcStruct.characterId,stance:0,stats:this.#i.getStatPairMap(a.pcStruct.statPair),skills:new Map,items:{}};this.entities.set(n.entityId,n);let r=this.#t.getEntityId(n.characterId);r&&this.#n.changeEntityId(r,a.pcStruct.playerId),this.#t.addMapping(n.characterId,n.entityId),this.#n.completeEntry(n.characterId,n.entityId),this.#r.newPC(a,this.localPlayer.characterId,t.time),n.itemSet=this.getPlayerSetOptions(a.pcStruct.equipItemDataList);let o=[];a.pcStruct.equipItemDataList.forEach(f=>{f.id!==void 0&&f.slot!==void 0&&o.push({id:f.id,slot:f.slot})}),n.items.equipList=o;let i=[];return a.pcStruct.equipLifeToolDataList.forEach(f=>{f.id!==void 0&&f.slot!==void 0&&i.push({id:f.id,slot:f.slot})}),n.items.lifeToolList=i,n}processInitEnv(t){let a=t.parsed;if(!a)return;this.localPlayer.entityId!==0n&&this.#n.changeEntityId(this.localPlayer.entityId,a.playerId),this.entities.clear();let n={entityId:a.playerId,entityType:1,name:this.localPlayer.name,class:this.localPlayer.class,gearLevel:this.localPlayer.gearLevel,characterId:this.localPlayer.characterId,stance:this.localPlayer.stance,stats:this.localPlayer.stats,skills:this.localPlayer.skills,items:this.localPlayer.items};this.localPlayer=n,this.entities.set(n.entityId,n),this.#t.clear(),this.#r.Clear(t.time),n.characterId!==0n&&this.#t.addMapping(n.characterId,n.entityId),this.localPlayer&&this.localPlayer.characterId&&this.localPlayer.characterId>0n&&this.#n.completeEntry(this.localPlayer.characterId,a.playerId)}processInitPC(t){let a=t.parsed;if(!a)return;this.entities.clear();let n={entityId:a.playerId,entityType:1,name:a.name,class:a.classId,gearLevel:a.gearLevel,characterId:a.characterId,stance:0,stats:this.#i.getStatPairMap(a.statPair),skills:new Map,items:a.characterId===this.localPlayer.characterId?this.localPlayer.items:{}};this.localPlayer=n,this.entities.set(n.entityId,n),this.#t.addMapping(n.characterId,n.entityId),this.#n.setOwnName(a.name),this.#n.completeEntry(n.characterId,a.playerId),this.#r.RemoveLocalObject(a.playerId,t.time);for(let r of a.statusEffectDatas){let o=this.getSourceEntity(r.sourceId);this.#r.RegisterStatusEffect(this.#r.buildStatusEffect(r,a.playerId,o.entityId,1,t.time))}return n}processNewNpc(t){let a=t.parsed;if(!a)return;let n=!1,r=this.#i.npc.get(a.npcStruct.typeId);r&&[6,7,9,10].includes(ua[r.grade])&&(n=!0);let o={entityId:a.npcStruct.objectId,entityType:2,name:r?.name??a.npcStruct.objectId.toString(16),typeId:a.npcStruct.typeId,isBoss:n,grade:r?.grade??"none",pushimmune:r?.pushimmune??!1,stats:this.#i.getStatPairMap(a.npcStruct.statPair),level:a.npcStruct.level,balanceLevel:a.npcStruct.balanceLevel??a.npcStruct.level},i=this.#i.getNpcEsther(a.npcStruct.typeId);i!==void 0&&(o.entityType=4,o.name=i.name,o.icon=i.icon),this.entities.set(o.entityId,o),this.#r.RemoveLocalObject(a.npcStruct.objectId,t.time);for(let f of a.npcStruct.statusEffectDatas){let c=this.getSourceEntity(f.sourceId);this.#r.RegisterStatusEffect(this.#r.buildStatusEffect(f,a.npcStruct.objectId,c.entityId,1,t.time))}return o}processNewNpcSummon(t){let a=t.parsed;if(!a)return;let n=!1,r=this.#i.npc.get(a.npcData.typeId);r&&["boss","raid","epic_raid","commander"].includes(r.grade)&&(n=!0);let o={entityId:a.npcData.objectId,entityType:3,name:r?.name??a.npcData.objectId.toString(16),ownerId:a.ownerId,typeId:a.npcData.typeId,isBoss:n,grade:r?.grade??"none",pushimmune:r?.pushimmune??!1,stats:this.#i.getStatPairMap(a.npcData.statPair),level:a.npcData.level,balanceLevel:a.npcData.balanceLevel??a.npcData.level};this.#r.RemoveLocalObject(a.npcData.objectId,t.time);for(let i of a.npcData.statusEffectDatas){let f=this.getSourceEntity(i.sourceId);this.#r.RegisterStatusEffect(this.#r.buildStatusEffect(i,a.npcData.objectId,f.entityId,1,t.time))}return this.entities.set(o.entityId,o),o}getPlayerSetOptions(t){let a=new Map;t.forEach(r=>{if(r.id&&r.slot&&r.slot>=1&&r.slot<=6){let o=this.#i.itemSet.items.get(r.id);if(o){let i=a.get(o.setname);i||(i=new Map,a.set(o.setname,i)),i.set(o.level,(i.get(o.level)??0)+1)}}});let n=[];return a.forEach((r,o)=>{let i=this.#i.itemSet.seteffects.get(o);if(!i)return;let f=0,c=0;for(let[l,S]of[...r.entries()].sort((b,I)=>I[0]-b[0])){let b=i.get(l);if(!b)return;for(let[I,H]of[...b.entries()])I>f&&S+c>=I&&(n.push(...H.options),f=Math.max(f,I));c=S}}),n}getSourceEntity(t){let a=this.entities.get(t);if((a?.entityType===5||a?.entityType===3)&&(t=a.ownerId),a=this.entities.get(t),a)return a;let n={entityId:t,entityType:2,name:t.toString(16),stats:new Map};return this.entities.set(t,n),n}guessIsPlayer(t,a){let n=this.#i.getSkillClassId(a);if(n!==0){let r;if(t.entityType===1){let o=t;if(o.class===n)return o;r={entityId:o.entityId,entityType:1,name:o.name,class:n,gearLevel:o.gearLevel,characterId:o.characterId,stance:o.stance,stats:o.stats,skills:new Map,items:{}}}else r={entityId:t.entityId,entityType:1,name:t.name,class:n,gearLevel:0,characterId:0n,stance:0,stats:new Map,skills:new Map,items:{}};return this.entities.set(t.entityId,r),r}return t}getOrCreateEntity(t){let a=this.entities.get(t);return a||(a={entityId:t,entityType:0,name:t.toString(16),stats:new Map},this.entities.set(t,a)),a}getEntityByName(t){return[...this.entities.values()].find(a=>a.name===t)}};var lu=require("tiny-typed-emitter");var fu=require("crypto");var mu=$u(require("axios"));var p=class{b;o;constructor(t){this.b=t,this.o=0}skip(t=0){this.o+=t}bool(){return this.u8()===1}u8(){return this.b.readUint8(this.o++)}i8(){return this.b.readInt8(this.o++)}u16(){let t=this.b.readUint16LE(this.o);return this.o+=2,t}i16(){let t=this.b.readInt16LE(this.o);return this.o+=2,t}u32(){let t=this.b.readUint32LE(this.o);return this.o+=4,t}i32(){let t=this.b.readInt32LE(this.o);return this.o+=4,t}f32(){let t=this.b.readFloatLE(this.o);return this.o+=4,t}u64(){let t=this.b.readBigUint64LE(this.o);return this.o+=8,t}i64(){let t=this.b.readBigInt64LE(this.o);return this.o+=8,t}string(t){let a=this.u16();if(a<=t){a=a*2;let n=this.b.toString("utf16le",this.o,this.o+a);return this.o+=a,n}return""}bytes(t=0,a,n){if(a&&t>a)return Buffer.alloc(0);n&&(t=t*n);let r=Buffer.from(this.b.subarray(this.o,this.o+t));return this.o+=t,r}array(t,a,n){return n&&t>n?[]:new Array(t).fill(void 0).map(a)}},We=class{b;o;constructor(t=65535){this.b=Buffer.allocUnsafe(t),this.o=0}get value(){return this.b.subarray(0,this.o)}skip(t=0){this.o+=t}bool(t=!1){return this.u8(t?1:0),t}u8(t=0){this.b.writeUInt8(t,this.o++)}i8(t=0){this.b.writeInt8(t,this.o++)}u16(t=0){this.o=this.b.writeUInt16LE(t,this.o)}i16(t=0){this.o=this.b.writeInt16LE(t,this.o)}u32(t=0){this.o=this.b.writeUInt32LE(t,this.o)}i32(t=0){this.o=this.b.writeInt32LE(t,this.o)}f32(t=0){this.o=this.b.writeFloatLE(t,this.o)}u64(t=0n){this.o=this.b.writeBigUInt64LE(BigInt(t),this.o)}i64(t=0n){this.o=this.b.writeBigInt64LE(BigInt(t),this.o)}string(t="",a=0){this.u16(t.length),t.length<=a&&(this.o+=this.b.write(t,this.o,"utf16le"))}bytes(t=Buffer.alloc(0),a={}){if(a.maxLen){let n=a.multiplier??1;if(t.length%n)throw new Error(`Error writing bytes, chunkSize should be a multiple of intut value size, got ${t.length}%${n}`);let r=t.length/n;if(r>a.maxLen)throw new Error(`Error writing bytes, input value size exceeded maxLen, got ${r} > ${a.maxLen}`);if(!a.lenType)throw new Error(`Error writing bytes, invalid lenType when writing chunks, got ${a.lenType}`);this[a.lenType](r)}else if(a.length&&t.length!==a.length)throw new Error(`Error writing bytes, input value size doesn't match opts.length, ${t.length} !== ${a.lenType}`);this.o+=t.copy(this.b,this.o)}array(t=[],a,n){if(t===void 0||t.length>a.maxLen){this[a.lenType](0);return}this[a.lenType](t.length),t.forEach(n)}};var at=class{time;#t;#n;#r;#i;constructor(...t){if(t.length===5){let[a,n,r,o,i]=t;this.#n=a,this.time=r,this.#t=n,this.#r=o,this.#i=i}else if(t.length===3){let[a,n,r]=t;this.#n=Buffer.alloc(0),this.time=new Date,this.#t=n,this.#r=()=>a,this.#i=r}else throw new Error("[meter-core/logger/parser] - LogEvent<T>: Invalid constructor arguments")}#a;get parsed(){if(!this.#a)try{this.#a=this.#r(new p(this.#n))}catch(t){console.error(`[meter-core/logger/parser] - parsed - ${t}`);return}return this.#a}#e;get serialized(){if(!this.#e)try{if(!this.parsed)return;let t=new We;t.skip(Bs),this.#i(t,this.parsed);let a=t.value;a.writeUint16LE(a.length,Ks),a.writeUint16LE(this.#t,da),a.writeUintLE(+new Date,ws,pa),this.#e=t.value}catch(t){console.error(`[meter-core/logger/parser] - serialized - ${t}`);return}return this.#e}},la=6,As=2,Ks=0,ca=2,da=Ks+As,pa=6,ws=da+ca,Bs=As+ca+pa;function St(e,t){let a={};return a.points=e.u16(),a.id=e.u32(),a.level=e.u8(),a}function Pt(e,t){e.u16(t.points),e.u32(t.id),e.u8(t.level)}function ba(e,t){let a={};return a.abilityDataList=e.array(e.u16(),()=>St(e,t),100),a}function ha(e,t){e.array(t.abilityDataList,{maxLen:100,lenType:"u16"},a=>{Pt(e,a)})}var Sa="AbilityChangeNotify";function Cs(e,t){let a={};return a.featureType=e.u16(),a.level=e.u32(),a}function Ms(e,t){e.u16(t.featureType),e.u32(t.level)}function Pa(e,t){let a={};return a.activeAbilityList=e.array(e.u16(),()=>Cs(e,t),60),a.objectId=e.u64(),a}function ka(e,t){e.array(t.activeAbilityList,{maxLen:60,lenType:"u16"},a=>{Ms(e,a)}),e.u64(t.objectId)}var Ia="ActiveAbilityNotify";function Ta(e,t){let a={};return a.objectId=e.u64(),a.addonSkillFeatureList=e.array(e.u16(),()=>{let n={};return n.addonSkillFeatureIdList=e.array(e.u16(),()=>e.u32(),5),n.skillId=e.u32(),n},200),a}function Ea(e,t){e.u64(t.objectId),e.array(t.addonSkillFeatureList,{maxLen:200,lenType:"u16"},a=>{e.array(a.addonSkillFeatureIdList,{maxLen:5,lenType:"u16"},n=>{e.u32(n)}),e.u32(a.skillId)})}var va="AddonSkillFeatureChangeNotify";function xa(e,t){let a={};return a.paralyzationMaxPoint=e.u32(),a.type=e.u8(),a.objectId=e.u64(),a.paralyzationPoint=e.u32(),a}function Na(e,t){e.u32(t.paralyzationMaxPoint),e.u8(t.type),e.u64(t.objectId),e.u32(t.paralyzationPoint)}var Da="BlockSkillStateNotify";function ya(e,t){let a={};return a.sourceId=e.u64(),a.targetId=e.u64(),a.type=e.u32(),a}function Ra(e,t){e.u64(t.sourceId),e.u64(t.targetId),e.u32(t.type)}var ga="CounterAttackNotify";function La(e,t){let a={};return a.sourceId=e.u64(),a.targetId=e.u64(),a}function Aa(e,t){e.u64(t.sourceId),e.u64(t.targetId)}var Ka="DeathNotify";function wa(e,t){let a={};return a.abilityDataList=e.array(e.u16(),()=>St(e,t),100),a}function Ba(e,t){e.array(t.abilityDataList,{maxLen:100,lenType:"u16"},a=>{Pt(e,a)})}var Ca="InitAbility";function Ma(e,t){let a={};return a.playerId=e.u64(),a}function ja(e,t){e.u64(t.playerId)}var Oa="InitEnv";var tf=[0,31,28,31,30,31,30,31,31,30,31,30,31];function ef(e){return!(e%4||!(e%100)&&e%400)}function af(e,t,a){if(e>99){if(e<1752||e==1752&&(t<9||t==9&&a<<14))return!1}else e+=1900;return a>0&&t<=12&&(a<=tf[t]||a==29&&t==2&&ef(e))}function Fa(e){let t=Number(e&0xffffffffn),a=Number(e>>32n&0xffffffffn),n=t&4095,r=(t&65535)>>12,o=t>>16&31;af(n,r,o)||(n=r=o=0);let i=t>>21&31,f=t>>26&63,c=a&63,l=a>>6&16383;return i<24&&f<60&&c<60&&l<1e3||(i=24,f=c=l=0),new Date(Date.UTC(n<=99?n+1900:n,r-1,o,i,f,c,l))}function js(e){let t=0n;return t|=BigInt(e.getUTCMilliseconds())<<38n,t|=BigInt(e.getUTCSeconds())<<32n,t|=BigInt(e.getUTCMinutes())<<26n,t|=BigInt(e.getUTCHours())<<21n,t|=BigInt(e.getUTCDate())<<16n,t|=BigInt(e.getUTCMonth()+1)<<12n,t|=BigInt(e.getUTCFullYear()<2e3?e.getUTCFullYear()-1900:e.getUTCFullYear()),t}function O(e,t=0){let a=e.u16();return(a&4095)<2079?(e.o-=2,Fa(e.i64())):Fa(BigInt(a)&0xfffn|0x11000n)}function rt(e,t=Fa(0x1181fn)){t.getUTCFullYear()>=2079?e.u16(Number(js(t)&0xffffn)):e.i64(js(t))}function U(e,t){let a={};return a.skillLevel=e.u8(),a.occurTime=O(e,t),a.statusEffectId=e.u32(),a.sourceId=e.u64(),a.totalTime=e.f32(),a.endTick=e.u64(),e.bool()&&(a.value=e.bytes(16)),a.effectInstanceId=e.u32(),t>=1?a.stackCount=e.u8():a.stackCount=1,a}function V(e,t){e.u8(t.skillLevel),rt(e,t.occurTime),e.u32(t.statusEffectId),e.u64(t.sourceId),e.f32(t.totalTime),e.u64(t.endTick),e.bool(t.value!==void 0)&&e.bytes(t.value,{length:16}),e.u32(t.effectInstanceId),e.u8(t.stackCount)}function nf(e){if(e.length===0)return 0n;if(e.length>8)throw new Error("Value is too large");let t=Buffer.alloc(8);return e.copy(t),t.readBigInt64LE()}function T(e,t=0){let a=e.u8(),n=e.bytes(a>>1&7),r=nf(n)<<4n|BigInt(a>>4);return a&1?-r:r}function B(e,t=0n){let a=Buffer.alloc(8),n=t<0n;a.writeBigInt64LE((n?-t:t)>>4n);let r=0;for(let[o,i]of a.entries())i!=0&&(r=o+1);if(r>7)throw new Error("Value is too large");e.u8(Number((n?-t:t)&0xfn)<<4|(r&7)<<1|(n?1:0)),e.bytes(a.subarray(0,r),{length:r})}function qa(e,t){let a={};return a.statPair=e.array(e.u16(),()=>{let n={};return n.StatType=e.u8(),n.Value=T(e,t),n},152),a.name=e.string(20),a.level=e.u16(),a.statusEffectDatas=e.array(e.u16(),()=>U(e,t),80),a.characterId=e.u64(),a.gearLevel=e.f32(),a.playerId=e.u64(),a.classId=e.u16(),a}function Wa(e,t){e.array(t.statPair,{maxLen:152,lenType:"u16"},a=>{e.u8(a.statType),B(e,a.value)}),e.string(t.name,20),e.u16(t.level),e.array(t.statusEffectDatas,{maxLen:80,lenType:"u16"},a=>{V(e,a)}),e.u64(t.characterId),e.f32(t.gearLevel),e.u64(t.playerId),e.u16(t.classId)}var Ua="InitPC";function Va(e,t){let a={};return a.statPair=e.array(e.u16(),()=>{let n={};return n.statType=e.u8(),n.value=T(e,t),n},152),a.statusEffectDatas=e.array(e.u16(),()=>U(e,t),80),a.addonSkillFeatureList=e.array(e.u16(),()=>{let n={};return n.addonSkillFeatureIdList=e.array(e.u16(),()=>e.u32(),5),n.skillId=e.u32(),n},200),a.abilityDataList=e.array(e.u16(),()=>St(e,t),100),a}function Za(e,t){e.array(t.statPair,{maxLen:152,lenType:"u16"},a=>{e.u8(a.statType),B(e,a.value)}),e.array(t.statusEffectDatas,{maxLen:80,lenType:"u16"},a=>{V(e,a)}),e.array(t.addonSkillFeatureList,{maxLen:200,lenType:"u16"},a=>{e.array(a.addonSkillFeatureIdList,{maxLen:5,lenType:"u16"},n=>{e.u32(n)}),e.u32(a.skillId)}),e.array(t.abilityDataList,{maxLen:100,lenType:"u16"},a=>{Pt(e,a)})}var Ha="InitLocal";function za(e,t){let a={};return a.account_CharacterId1=e.u64(),a.serverAddr=e.string(256),a.account_CharacterId2=e.u64(),a}function gt(e,t){e.u64(t.account_CharacterId1),e.string(t.serverAddr,256),e.u64(t.account_CharacterId2)}var Ga="MigrationExecute";function Ya(e){return e>>20===1?-((~e>>>0)+1&2097151):e}function y(e,t=0){let a=e.u64();return{x:Ya(Number(a&0x1fffffn)),y:Ya(Number(a>>21n&0x1fffffn)),z:Ya(Number(a>>42n&0x1fffffn))}}function q(e,t={x:0,y:0,z:0}){e.u64(BigInt(Math.round(t.x??0)>>>0&2097151)|BigInt(Math.round(t.y??0)>>>0&2097151)<<21n|BigInt(Math.round(t.z??0)>>>0&2097151)<<42n)}function F(e,t=0){return e.u16()*(2*Math.PI)/65536}function nt(e,t=0){e.u16(Math.round(t*65536/(2*Math.PI))%65536)}function Ue(e,t){let a={};return a.spawnIndex=e.u32(),a.objectId=e.u64(),e.bool()&&(a.transitIndex=e.u32()),a.position=y(e,t),a.statusEffectDatas=e.array(e.u16(),()=>U(e,t),80),a.directionYaw=F(e,t),a.statPair=e.array(e.u16(),()=>{let n={};return n.statType=e.u8(),n.value=T(e,t),n},152),a.typeId=e.u32(),t>=1?(a.level=e.u16(),e.bool()&&(a.balanceLevel=e.u16())):a.level=0,a}function Ve(e,t){e.u32(t.spawnIndex),e.u64(t.objectId),e.bool(t.transitIndex!==void 0)&&e.u32(t.transitIndex),q(e,t.position),e.array(t.statusEffectDatas,{maxLen:80,lenType:"u16"},a=>{V(e,a)}),nt(e,t.directionYaw),e.array(t.statPair,{maxLen:152,lenType:"u16"},a=>{e.u8(a.statType),B(e,a.value)}),e.u32(t.typeId),e.u16(t.level),e.bool(t.balanceLevel!==void 0)&&e.u16(t.balanceLevel)}function $a(e,t){let a={};return a.npcStruct=Ue(e,t),a}function Qa(e,t){Ve(e,t.npcStruct)}var Ja="NewNpc";function Xa(e,t){let a={};return a.publishReason=e.u8(),a.ownerId=e.u64(),a.npcData=Ue(e,t),a}function tn(e,t){e.u8(t.publishReason),e.u64(t.ownerId),Ve(e,t.npcData)}var en="NewNpcSummon";function ft(e,t){let a={};return a.slot=e.u16(),a.level=e.u16(),a.itemTint=e.bytes(e.u16(),3,14),a.expireTime=O(e),a.id=e.u32(),a}function mt(e,t){e.u16(t.slot),e.u16(t.level),e.bytes(t.itemTint,{maxLen:3,lenType:"u16",multiplier:14}),rt(e,t.expireTime),e.u32(t.id)}function Fs(e,t){let a={};return a.maxItemLevel=e.f32(),a.statPair=e.array(e.u16(),()=>{let n={};return n.statType=e.u8(),n.value=T(e,t),n},152),a.name=e.string(20),a.heading=F(e,t),a.characterId=e.u64(),a.playerId=e.u64(),a.addonSkillFeatureList=e.array(e.u16(),()=>{let n={};return n.addonSkillFeatureIdList=e.array(e.u16(),()=>e.u32(),5),n.SkillId=e.u32(),n},200),a.classId=e.u16(),a.level=e.u16(),a.statusEffectDatas=e.array(e.u16(),()=>U(e,t),80),t>=1?(a.avgItemLevel=e.f32(),a.position=y(e),a.equipItemDataList=e.array(e.u16(),()=>ft(e,t),32),a.equipLifeToolDataList=e.array(e.u16(),()=>ft(e,t),9),a.guildName=e.string(20),t>=2?a.guildId=e.u64():a.guildId=BigInt(e.u32())):(a.avgItemLevel=a.maxItemLevel,a.position={x:0,y:0,z:0},a.equipItemDataList=[],a.equipLifeToolDataList=[],a.guildName="",a.guildId=0n),a}function qs(e,t){e.f32(t.maxItemLevel),e.array(t.statPair,{maxLen:152,lenType:"u16"},a=>{e.u8(a.statType),B(e,a.value)}),e.string(t.name,20),nt(e,t.heading),e.u64(t.characterId),e.u64(t.playerId),e.array(t.addonSkillFeatureList,{maxLen:200,lenType:"u16"},a=>{e.array(a.addonSkillFeatureIdList,{maxLen:5,lenType:"u16"},n=>{e.u32(n)}),e.u32(a.skillId)}),e.u16(t.classId),e.u16(t.level),e.array(t.statusEffectDatas,{maxLen:80,lenType:"u16"},a=>{V(e,a)}),e.f32(t.avgItemLevel),q(e,t.position),e.array(t.equipItemDataList,{maxLen:32,lenType:"u16"},a=>{mt(e,a)}),e.array(t.equipLifeToolDataList,{maxLen:9,lenType:"u16"},a=>{mt(e,a)}),e.string(t.guildName,20),e.u64(t.guildId)}function nn(e,t){let a={};return a.pcStruct=Fs(e,t),a}function on(e,t){qs(e,t.pcStruct)}var rn="NewPC";function It(e,t=0){return{first:e.u8(),second:e.u8(),third:e.u8()}}function Ze(e,t){e.u8(t.first),e.u8(t.second),e.u8(t.third)}function Tt(e,t=0){return{first:e.u16(),second:e.u16(),third:e.u16()}}function He(e,t){e.u16(t.first),e.u16(t.second),e.u16(t.third)}function Ws(e,t){let a={};return a.tripodIndex=It(e,t),a.chainSkillEffect=e.u32(),a.skillEffect=e.u32(),a.skillId=e.u32(),a.targetObjectId=e.u64(),a.ownerId=e.u64(),a.skillLevel=e.u8(),a.projectileId=e.u64(),a.tripodLevel=Tt(e,t),a}function Us(e,t){Ze(e,t.tripodIndex),e.u32(t.chainSkillEffect),e.u32(t.skillEffect),e.u32(t.skillId),e.u64(t.targetObjectId),e.u64(t.ownerId),e.u8(t.skillLevel),e.u64(t.projectileId),He(e,t.tripodLevel)}function fn(e,t){let a={};return a.projectileInfo=Ws(e,t),a}function mn(e,t){Us(e,t.projectileInfo)}var ln="NewProjectile";function cn(e,t){let a={};return a.enable=e.bool(),a.paralyzationPoint=e.u32(),a.decreasePoint=e.u32(),a.paralyzationMaxPoint=e.u32(),a.noHitCheckTime=e.u32(),a.hitCheckTime=e.u32(),a.objectId=e.u64(),a}function dn(e,t){e.bool(t.enable),e.u32(t.paralyzationPoint),e.u32(t.decreasePoint),e.u32(t.paralyzationMaxPoint),e.u32(t.noHitCheckTime),e.u32(t.hitCheckTime),e.u64(t.objectId)}var pn="ParalyzationStateNotify";function Vs(e,t){let a={};return a.maxHp=T(e,t),a.characterId=e.u64(),a.position=y(e,t),a.transitIndex=e.u32(),a.curHp=T(e,t),a.characterLevel=e.u16(),a.gearLevel=e.f32(),a.zoneId=e.u32(),a.partyMemberNumber=e.u8(),a.name=e.string(20),a.zoneInstId=e.u64(),a.worldId=e.u8(),a.classId=e.u16(),a.auths=e.u8(),a}function Zs(e,t){B(e,t.maxHp),e.u64(t.characterId),q(e,t.position),e.u32(t.transitIndex),B(e,t.curHp),e.u16(t.characterLevel),e.f32(t.gearLevel),e.u32(t.zoneId),e.u8(t.partyMemberNumber),e.string(t.name,20),e.u64(t.zoneInstId),e.u8(t.worldId),e.u16(t.classId),e.u8(t.auths)}function _n(e,t){let a={};return a.raidInstanceId=e.u32(),a.lootGrade=e.u32(),a.partyType=e.u8(),a.partyInstanceId=e.u32(),a.partyLootType=e.u8(),a.memberDatas=e.array(e.u16(),()=>Vs(e,t),40),a}function bn(e,t){e.u32(t.raidInstanceId),e.u32(t.lootGrade),e.u8(t.partyType),e.u32(t.partyInstanceId),e.u8(t.partyLootType),e.array(t.memberDatas,{maxLen:40,lenType:"u16"},a=>{Zs(e,a)})}var hn="PartyInfo";function Sn(e,t){let a={};return a.partyLeaveType=e.u8(),a.partyInstanceId=e.u32(),a.name=e.string(20),a}function Pn(e,t){e.u8(t.partyLeaveType),e.u32(t.partyInstanceId),e.string(t.name,20)}var kn="PartyLeaveResult";function In(e,t){let a={};return a.objectId=e.u64(),a.passiveStatusEffectList=e.array(e.u16(),()=>e.u32(),10),a.unk0_m=e.u8(),a}function Tn(e,t){e.u64(t.objectId),e.array(t.passiveStatusEffectList,{maxLen:10,lenType:"u16"},a=>{e.u32(a)}),e.u8(t.unk0_m)}var En="PartyPassiveStatusEffectAddNotify";function vn(e,t){let a={};return a.objectId=e.u64(),a.passiveStatusEffectList=e.array(e.u16(),()=>e.u32(),10),a}function xn(e,t){e.u64(t.objectId),e.array(t.passiveStatusEffectList,{maxLen:10,lenType:"u16"},a=>{e.u32(a)})}var Nn="PartyPassiveStatusEffectRemoveNotify";function Dn(e,t){let a={};return a.characterId=e.u64(),a.statusEffectDatas=e.array(e.u16(),()=>U(e,t),80),a.playerIdOnRefresh=e.u64(),a}function yn(e,t){e.u64(t.characterId),e.array(t.statusEffectDatas,{maxLen:80,lenType:"u16"},a=>{V(e,a)}),e.u64(t.playerIdOnRefresh)}var Rn="PartyStatusEffectAddNotify";function gn(e,t){let a={};return a.characterId=e.u64(),a.statusEffectIds=e.array(e.u16(),()=>e.u32(),80),a.reason=e.u8(),a}function Ln(e,t){e.u64(t.characterId),e.array(t.statusEffectIds,{maxLen:80,lenType:"u16"},a=>{e.u32(a)}),e.u8(t.reason)}var An="PartyStatusEffectRemoveNotify";function Kn(e,t){let a={};return a.partyInstanceId=e.u32(),a.raidInstanceId=e.u32(),a.characterId=e.u64(),a}function wn(e,t){e.u32(t.partyInstanceId),e.u32(t.raidInstanceId),e.u64(t.characterId)}var Bn="PartyStatusEffectResultNotify";function Cn(e,t){let a={};return a.passiveStatusEffectList=e.array(e.u16(),()=>e.u32(),10),a}function Mn(e,t){e.array(t.passiveStatusEffectList,{maxLen:10,lenType:"u16"},a=>{e.u32(a)})}var jn="PassiveStatusEffectAddNotify";function On(e,t){let a={};return a.passiveStatusEffectList=e.array(e.u16(),()=>e.u32(),10),a}function Fn(e,t){e.array(t.passiveStatusEffectList,{maxLen:10,lenType:"u16"},a=>{e.u32(a)})}var qn="PassiveStatusEffectRemoveNotify";function Wn(e,t){return{}}function Un(e,t){}var Vn="RaidBossKillNotify";function Zn(e,t){let a={};return t>=3?a.raidResult=e.u8():a.raidResult=0,a}function Hn(e,t){e.u8(t.raidResult)}var zn="RaidResult";function Hs(e,t){let a={};return a.unpublishReason=e.u8(),a.objectId=e.u64(),a}function zs(e,t){e.u8(t.unpublishReason),e.u64(t.objectId)}function Gn(e,t){let a={};return a.unpublishedObjects=e.array(e.u16(),()=>Hs(e,t),200),a}function Yn(e,t){e.array(t.unpublishedObjects,{maxLen:200,lenType:"u16"},a=>{zs(e,a)})}var $n="RemoveObject";function ze(e,t=0){let a={},n=e.u8();return n&1&&(a.moveTime=e.u32()),n&2&&(a.standUpTime=e.u32()),n&4&&(a.downTime=e.u32()),n&8&&(a.freezeTime=e.u32()),n&16&&(a.moveHeight=e.u32()),n&32&&(a.farmostDist=e.u32()),n&64&&(a.flag40=e.bytes(e.u16(),6)),a}function Gs(e,t){let a=(t.moveTime===void 0?0:1)|(t.standUpTime===void 0?0:2)|(t.downTime===void 0?0:4)|(t.freezeTime===void 0?0:8)|(t.moveHeight===void 0?0:16)|(t.farmostDist===void 0?0:32)|(t.flag40===void 0?0:64);e.u8(a),a&1&&e.u32(t.moveTime),a&2&&e.u32(t.standUpTime),a&4&&e.u32(t.downTime),a&8&&e.u32(t.freezeTime),a&16&&e.u32(t.moveHeight),a&32&&e.u32(t.farmostDist),a&64&&e.bytes(t.flag40,{maxLen:6,lenType:"u16"})}function Ge(e,t){let a={};return a.modifier=e.u8(),a.targetId=e.u64(),a.damageType=e.u8(),e.bool()&&(a.damageAttr=e.u8()),a.curHp=T(e,t),a.unk3_m=e.u16(),a.maxHp=T(e,t),a.damage=T(e,t),a}function Ye(e,t){e.u8(t.modifier),e.u64(t.targetId),e.u8(t.damageType),e.bool(t.damageAttr!==void 0)&&e.u8(t.damageAttr),B(e,t.curHp),e.u16(t.unk3_m),B(e,t.maxHp),B(e,t.damage)}function Qs(e,t){let a={};return a.skillMoveOptionData=ze(e,t),a.destination=y(e,t),a.position=y(e,t),a.skillDamageEvent=Ge(e,t),a}function Js(e,t){Gs(e,t.skillMoveOptionData),q(e,t.destination),q(e,t.position),Ye(e,t.skillDamageEvent)}function Qn(e,t){let a={};return a.skillId=e.u32(),a.skillDamageAbnormalMoveEvents=e.array(e.u16(),()=>Qs(e,t),50),a.skillEffectId=e.u32(),a.sourceId=e.u64(),a}function Jn(e,t){e.u32(t.skillId),e.array(t.skillDamageAbnormalMoveEvents,{maxLen:50,lenType:"u16"},a=>{Js(e,a)}),e.u32(t.skillEffectId),e.u64(t.sourceId)}var Xn="SkillDamageAbnormalMoveNotify";function ti(e,t){let a={};return a.skillLevel=e.u8(),a.sourceId=e.u64(),a.skillId=e.u32(),a.skillDamageEvents=e.array(e.u16(),()=>Ge(e,t),50),a.skillEffectId=e.u32(),a}function ei(e,t){e.u8(t.skillLevel),e.u64(t.sourceId),e.u32(t.skillId),e.array(t.skillDamageEvents,{maxLen:50,lenType:"u16"},a=>{Ye(e,a)}),e.u32(t.skillEffectId??0)}var ai="SkillDamageNotify";function ni(e,t){let a={};return a.sourceId=e.u64(),a.skillId=e.u32(),a.stage=e.u8(),a}function ii(e,t){e.u64(t.sourceId),e.u32(t.skillId),e.u8(t.stage)}var oi="SkillStageNotify";function $e(e,t=0){let a={},n=e.u8();return n&1&&(a.layerIndex=e.u8()),n&2&&(a.startStageIndex=e.u8()),n&4&&(a.transitIndex=e.u32()),n&8&&(a.stageStartTime=e.u32()),n&16&&(a.farmostDistance=e.u32()),n&32&&(a.tripodIndex=It(e)),n&64&&(a.tripodLevel=Tt(e)),a}function Xs(e,t){let a=(t.layerIndex===void 0?0:1)|(t.startStageIndex===void 0?0:2)|(t.transitIndex===void 0?0:4)|(t.stageStartTime===void 0?0:8)|(t.farmostDistance===void 0?0:16)|(t.tripodIndex===void 0?0:32)|(t.tripodLevel===void 0?0:64);e.u8(a),a&1&&e.u8(t.layerIndex),a&2&&e.u8(t.startStageIndex),a&4&&e.u32(t.transitIndex),a&8&&e.u32(t.stageStartTime),a&16&&e.u32(t.farmostDistance),a&32&&Ze(e,t.tripodIndex),a&64&&He(e,t.tripodLevel)}function ri(e,t){let a={};return a.sourceId=e.u64(),a.curDirectionYaw=F(e,t),a.newDirectionYaw=F(e,t),a.aimTargetPosition=y(e,t),e.bool()&&(a.pitchRotation=F(e,t)),e.bool()&&(a.aiStateId=e.u32()),a.curPosition=y(e,t),e.bool()&&(a.unk1_m=e.u32()),a.skillLevel=e.u8(),a.newPosition=y(e,t),a.skillId=e.u32(),a.skillOptionData=$e(e,t),a}function si(e,t){e.u64(t.sourceId),nt(e,t.curDirectionYaw),nt(e,t.newDirectionYaw),q(e,t.aimTargetPosition),e.bool(t.pitchRotation!==void 0)&&nt(e,t.pitchRotation),e.bool(t.aiStateId!==void 0)&&e.u32(t.aiStateId),q(e,t.curPosition),e.bool(t.unk1_m!==void 0)&&e.u32(t.unk1_m),e.u8(t.skillLevel),q(e,t.newPosition),e.u32(t.skillId),Xs(e,t.skillOptionData)}var ui="SkillStartNotify";function fi(e,t){let a={};return a.statusEffectData=U(e,t),a.objectId=e.u64(),a.new=e.bool(),a}function mi(e,t){V(e,t.statusEffectData),e.u64(t.objectId),e.bool(t.new)}var li="StatusEffectAddNotify";function ci(e,t){let a={};return a.statusEffectIds=e.array(e.u16(),()=>e.u32(),80),a.objectId=e.u64(),a.reason=e.u8(),a}function di(e,t){e.array(t.statusEffectIds,{maxLen:80,lenType:"u16"},a=>{e.u32(a)}),e.u64(t.objectId),e.u8(t.reason)}var pi="StatusEffectRemoveNotify";function _i(e,t){let a={};return a.effectInstanceId=e.u32(),a.targetId=e.u64(),a.expirationTick=e.u64(),a}function bi(e,t){e.u32(t.effectInstanceId),e.u64(t.targetId),e.u64(t.expirationTick)}var hi="StatusEffectDurationNotify";function Si(e,t){let a={};return a.objectId=e.u64(),a.effectInstanceId=e.u32(),a.characterId=e.u64(),a.value=e.u32(),a}function Pi(e,t){e.u64(t.objectId),e.u32(t.effectInstanceId),e.u64(t.characterId),e.u32(t.value)}var ki="StatusEffectSyncDataNotify";function Ii(e,t){let a={};return a.step=e.u32(),a.unk2_m=e.bool(),a.triggerId=e.u32(),a}function Ti(e,t){e.u32(t.step),e.bool(t.unk2_m),e.u32(t.triggerId)}var Ei="TriggerBossBattleStatus";function vi(e,t){let a={};return a.packetResultCode=e.u32(),a.triggerId=e.u32(),a.unk0_m=e.u32(),a.involvedPCs=e.array(e.u16(),()=>e.u64(),40),a}function xi(e,t){e.u32(t.packetResultCode),e.u32(t.triggerId),e.u32(t.unk0_m),e.array(t.involvedPCs,{maxLen:40,lenType:"u16"},a=>{e.u64(a)})}var Ni="TriggerFinishNotify";function Di(e,t){let a={};return a.triggerId=e.u32(),a.triggerSignalType=e.u32(),a.sourceId=e.u64(),a.involvedPCs=e.array(e.u16(),()=>e.u64(),40),a}function yi(e,t){e.u32(t.triggerId),e.u32(t.triggerSignalType),e.u64(t.sourceId),e.array(t.involvedPCs,{maxLen:40,lenType:"u16"},a=>{e.u64(a)})}var Ri="TriggerStartNotify";function gi(e,t){let a={};return a.maxHp=T(e,t),a.characterId=e.u64(),a.unk0_m=e.u32(),a.statusEffectDatas=e.array(e.u16(),()=>U(e,t),80),a.position=e.u64(),a.curHp=T(e,t),a}function Li(e,t){B(e,t.maxHp),e.u64(t.characterId),e.u32(t.unk0_m),e.array(t.statusEffectDatas,{maxLen:80,lenType:"u16"},a=>{V(e,a)}),e.u64(t.position),B(e,t.curHp)}var Ai="TroopMemberUpdateMinNotify";function Ki(e,t){let a={};return a.identityGauge1=e.u32(),a.identityGauge2=e.u32(),a.identityGauge3=e.u32(),a.playerId=e.u64(),a}function wi(e,t){e.u32(t.identityGauge1),e.u32(t.identityGauge2),e.u32(t.identityGauge3),e.u64(t.playerId)}var Bi="IdentityGaugeChangeNotify";function Ci(e,t){let a={};return a.objectId=e.u64(),a}function Mi(e,t){e.u64(t.objectId)}var ji="ZoneObjectUnpublishNotify";function eu(e,t){let a={};return a.stackCount=e.u8(),a.target=e.u8(),a.id=e.u32(),a}function au(e,t){e.u8(t.stackCount),e.u8(t.target),e.u32(t.id)}function Oi(e,t){let a={};return a.zoneStatusEffectDataList=e.array(e.u16(),()=>eu(e,t),4),a}function Fi(e,t){e.array(t.zoneStatusEffectDataList,{maxLen:4,lenType:"u16"},a=>{au(e,a)})}var qi="ZoneStatusEffectAddNotify";function Wi(e,t){let a={};return a.statusEffectId=e.u32(),a}function Ui(e,t){e.u32(t.statusEffectId)}var Vi="ZoneStatusEffectRemoveNotify";function Zi(e,t){let a={};return a.skillLevel=e.u8(),a.caster=e.u64(),a.skillId=e.u32(),a}function Hi(e,t){e.u8(t.skillLevel),e.u64(t.caster),e.u32(t.skillId)}var zi="SkillCastNotify";function Gi(e,t){let a={};return a.objectId=e.u64(),a.stance=e.u8(),a}function Yi(e,t){e.u64(t.objectId),e.u8(t.stance)}var $i="IdentityStanceChangeNotify";function Qi(e,t){let a={};return a.objectId=e.u64(),a.equipItemDataList=e.array(e.u16(),()=>ft(e,t),32),a}function Ji(e,t){e.u64(t.objectId),e.array(t.equipItemDataList,{maxLen:32,lenType:"u16"},a=>{mt(e,a)})}var Xi="EquipChangeNotify";function to(e,t){let a={};return a.objectId=e.u64(),a.equipLifeToolDataList=e.array(e.u16(),()=>ft(e,t),9),a}function eo(e,t){e.u64(t.objectId),e.array(t.equipLifeToolDataList,{maxLen:9,lenType:"u16"},a=>{mt(e,a)})}var ao="EquipLifeToolChangeNotify";function nu(e,t){let a={};return e.bool()&&(a.serialNumber=e.u64(),a.id=e.u32(),a.level=e.u16(),a.slot=e.u16(),a.durability=e.u32(),a.unk1_6_m=e.u32(),a.flag=e.u32(),a.expireTime=O(e),a.lockUpdateTime=O(e)),a}function iu(e,t){e.bool(t.slot!==void 0)&&(e.u64(t.serialNumber),e.u32(t.id),e.u16(t.level),e.u16(t.slot),e.u32(t.durability),e.u32(t.unk1_6_m),e.u32(t.flag),rt(e,t.expireTime),rt(e,t.lockUpdateTime))}function no(e,t){let a={};return a.itemDataList=e.array(e.u16(),()=>nu(e,t),80),a.storageType=e.u8(),a}function io(e,t){e.array(t.storageType===1?t.itemDataList:[],{maxLen:80,lenType:"u16"},a=>{iu(e,a)}),e.u8(t.storageType)}var oo="InitItem";function ou(e,t){let a={};return a.npcId=e.u32(),a.isDead=e.bool(),a}function ru(e,t){e.u32(t.npcId),e.bool(t.isDead)}function ro(e,t){let a={};return a.raidResult=e.u8(),a.raidId=e.u32(),a.totalTime=e.u64(),a.bossKillDataList=e.array(e.u16(),()=>ou(e,t),3),a.endTick=e.u64(),a.startTick=e.u64(),a}function so(e,t){e.u8(t.raidResult),e.u32(t.raidId),e.u64(t.totalTime),e.array(t.bossKillDataList,{maxLen:3,lenType:"u16"},a=>{ru(e,a)}),e.u64(t.endTick),e.u64(t.startTick)}var uo="RaidBegin";function fo(e,t){let a={};return a.zoneInstId=e.u64(),a.zoneId=e.u32(),a.loadComplete=e.bool(),a.completeMembers=e.array(e.u16(),()=>e.u64(),40),a.totalMembers=e.array(e.u16(),()=>e.u64(),40),a.firstPCEnterTick=e.u64(),a.zoneLevel=e.u8(),a}function mo(e,t){e.u64(t.zoneInstId),e.u32(t.zoneId),e.bool(t.loadComplete),e.array(t.completeMembers,{maxLen:40,lenType:"u16"},a=>{e.u64(a)}),e.array(t.totalMembers,{maxLen:40,lenType:"u16"},a=>{e.u64(a)}),e.u64(t.firstPCEnterTick),e.u8(t.zoneLevel)}var lo="ZoneMemberLoadStatusNotify";function su(e,t){let a={};return a.position=y(e),a.objectId=e.u64(),a.ownerId=e.u64(),a.skillId=e.u32(),a.skillEffect=e.u32(),a}function uu(e,t){q(e,t.position),e.u64(t.objectId),e.u64(t.ownerId),e.u32(t.skillId),e.u32(t.skillEffect)}function co(e,t){let a={};return a.trapData=su(e,t),a}function po(e,t){uu(e,t.trapData)}var _o="NewTrap";function bo(e,t){let a={};return a.players=e.array(e.u8(),()=>{let n={};return n.name=e.string(20),n.stats=e.array(e.u8(),()=>{let r={};return r.id=e.u8(),r.value=e.u32(),r},100),n},24),a}function ho(e,t){e.array(t.players,{maxLen:24,lenType:"u8"},a=>{e.string(a.name,20),e.array(a.stats,{maxLen:100,lenType:"u8"},n=>{e.u8(n.id),e.u32(n.value)})})}var So="APP_StatApi";var Qe=new Map([[0,[Sa,ba,ha]],[1,[Ia,Pa,ka]],[2,[va,Ta,Ea]],[4,[Da,xa,Na]],[5,[ga,ya,Ra]],[6,[Ka,La,Aa]],[7,[Ca,wa,Ba]],[8,[Oa,Ma,ja]],[9,[Ua,qa,Wa]],[10,[Ha,Va,Za]],[11,[Ga,za,gt]],[12,[Ja,$a,Qa]],[13,[en,Xa,tn]],[14,[rn,nn,on]],[15,[ln,fn,mn]],[16,[pn,cn,dn]],[17,[hn,_n,bn]],[18,[kn,Sn,Pn]],[19,[En,In,Tn]],[20,[Nn,vn,xn]],[21,[Rn,Dn,yn]],[22,[An,gn,Ln]],[23,[Bn,Kn,wn]],[24,[jn,Cn,Mn]],[25,[qn,On,Fn]],[26,[Vn,Wn,Un]],[27,[zn,Zn,Hn]],[28,[$n,Gn,Yn]],[29,[Xn,Qn,Jn]],[30,[ai,ti,ei]],[31,[oi,ni,ii]],[32,[ui,ri,si]],[34,[li,fi,mi]],[35,[pi,ci,di]],[36,[hi,_i,bi]],[37,[ki,Si,Pi]],[38,[Ei,Ii,Ti]],[39,[Ni,vi,xi]],[40,[Ri,Di,yi]],[41,[Ai,gi,Li]],[42,[Bi,Ki,wi]],[43,[ji,Ci,Mi]],[44,[qi,Oi,Fi]],[45,[Vi,Wi,Ui]],[46,[zi,Zi,Hi]],[47,[$i,Gi,Yi]],[48,[Xi,Qi,Ji]],[49,[ao,to,eo]],[50,[oo,no,io]],[52,[uo,ro,so]],[51,[lo,fo,mo]],[53,[_o,co,po]],[6e4,[So,bo,ho]]]);var X,it,At,ko=class{constructor(t,a,n){Q(this,X,void 0);Q(this,it,void 0);Q(this,At,void 0);Y(this,"ip");Y(this,"zoneSyncStatus",0);Y(this,"cache",new Map);n&&et(this,X,n),et(this,it,t),et(this,At,a)}syncData(){let t=[];D(this,it).entities.forEach(a=>{a.entityType===1&&t.push(a)}),this.getPlayersData(t)}getPlayersData(t,a=0){if(a>24){t.forEach(r=>{let o=this.cache.get(r.name);o&&o.status===1?o.status=0:o||this.cache.set(r.name,{hash:"",status:0,info:{name:r.name,stats:[]}})});return}if(!this.isCurrentZoneValid()){t.forEach(r=>{let o=this.cache.get(r.name);o&&o.status===1&&this.cache.delete(r.name)});return}if(!D(this,X)||!this.ip)return;let n={};t.forEach(r=>{let o=this.getHash(r),i=this.cache.get(r.name);if(!o){i&&i.status===1&&this.cache.delete(r.name);return}i&&(i.status===0||a===0&&i.status===1||i.status===2&&i.hash===o)||(i?(i.hash=o,i.status=1):i={hash:o,status:1,info:{name:r.name,stats:[]}},this.cache.set(r.name,i),n[r.name]=o)}),Object.keys(n).length!==0&&mu.default.get(`${ko.baseUrl}/req2`,{params:{ip:this.ip,ci:D(this,At),...n}}).then(r=>{if(r.status===200&&D(this,X))try{let o=r.data,i=Qe.get(6e4);if(i){let[f,c,l]=i,S={players:o};if(t=t.filter(b=>!o.find(I=>I.name===b.name)),t.length>0&&setTimeout(()=>{t=t.map(b=>D(this,it).getEntityByName(b.name)).filter(b=>b!==void 0&&b.entityType===1),this.getPlayersData(t,a+1)},1e4),S.players.length>0){let b=new at(S,6e4,l);D(this,X).emit(f,b),D(this,X).emit("*",f,b),D(this,X).appendLog(b)}}}catch{setTimeout(()=>{t=t.map(i=>D(this,it).getEntityByName(i.name)).filter(i=>i!==void 0&&i.entityType===1),this.getPlayersData(t,a+5)},1e4)}}).catch(r=>{setTimeout(()=>{t=t.map(o=>D(this,it).getEntityByName(o.name)).filter(o=>o!==void 0&&o.entityType===1),this.getPlayersData(t,a+5)},1e4)})}getHash(t){if(!t.items.equipList||t.characterId===0n||!t.class||t.name==="You")return;let a=new Array(32).fill(0);t.items.equipList?.forEach(r=>{a[r.slot]=r.id});let n=`${t.name}${t.class}${t.characterId}${a.join("")}`;return(0,fu.createHash)("md5").update(n).digest("hex")}updatePlayerStats(t){t.forEach(a=>{let n=this.cache.get(a.name);n?(n.info=a,n.status=2):this.cache.set(a.name,{hash:"",status:2,info:a})})}getStats(t){if(!this.isCurrentZoneValid())return;let a=this.cache.get(t);if(a&&a.status===2)return a.info.stats}isCurrentZoneValid(){return this.zoneSyncStatus!==0&&(this.zoneSyncStatus&10)===0}},Lt=ko;X=new WeakMap,it=new WeakMap,At=new WeakMap,Y(Lt,"baseUrl","https://la.herysia.com");var Pf={isLive:!0,dontResetOnZoneChange:!1,resetAfterPhaseTransition:!1,splitOnPhaseTransition:!1},Je=class extends lu.TypedEmitter{#t;encounters;#n;#r;#i;#a;options;resetTimer;phaseTransitionResetRequest;phaseTransitionResetRequestTime;#e;constructor(t,a,n,r,o){super(),this.#n=t,this.#r=a,this.#i=n,this.#a=r,this.options={...Pf,...o},this.resetTimer=null,this.phaseTransitionResetRequest=!1,this.phaseTransitionResetRequestTime=0,this.#e=new Map,this.encounters=[],this.#t={startedOn:0,lastCombatPacket:0,fightStartedOn:0,localPlayer:this.#n.localPlayer.name,currentBoss:void 0,killState:0,zoneLevel:je[0],entities:new Map,damageStatistics:{totalDamageDealt:0,topDamageDealt:0,totalDamageTaken:0,topDamageTaken:0,totalHealingDone:0,topHealingDone:0,totalShieldDone:0,topShieldDone:0,debuffs:new Map,buffs:new Map,topShieldGotten:0,totalEffectiveShieldingDone:0,topEffectiveShieldingDone:0,topEffectiveShieldingUsed:0,effectiveShieldingBuffs:new Map,appliedShieldingBuffs:new Map}}}onCounterAttack(t,a){let n=this.updateEntity(t,{},a);n.hits.counter+=1}onInitEnv(t,a){this.options.isLive?(this.#t.entities.forEach((n,r,o)=>{n.hits.total===0&&o.delete(r)}),this.options.dontResetOnZoneChange===!1&&this.resetTimer===null&&(this.resetTimer=setTimeout(()=>{this.resetState(+a+6e3)},6e3),this.emit("message","new-zone"))):(this.splitEncounter(a),this.emit("message","new-zone"))}splitEncounter(t){if(this.#t.fightStartedOn!==0&&(this.#t.damageStatistics.totalDamageDealt!==0||this.#t.damageStatistics.totalDamageTaken!==0)){let a=structuredClone(this.#t);a.entities.forEach(n=>{n.isPlayer&&(n.statApiValid=this.#i.isCurrentZoneValid()&&this.#i.cache.get(n.name)?.status===2)}),a.localPlayer=this.#n.localPlayer.name,this.applyBreakdowns(a.entities),this.encounters.push(a)}this.resetState(+t)}getBossIfStillExist(){if(this.#t.currentBoss?.id){let t=BigInt(`0x0${this.#t.currentBoss?.id}`);return this.#n.entities.has(t)?this.#t.currentBoss:void 0}}resetState(t){this.cancelReset(),this.resetBreakdowns(),this.#t={startedOn:+t,lastCombatPacket:+t,fightStartedOn:0,localPlayer:this.#n.localPlayer.name,currentBoss:this.getBossIfStillExist(),entities:new Map,killState:0,zoneLevel:this.#t.zoneLevel,damageStatistics:{totalDamageDealt:0,topDamageDealt:0,totalDamageTaken:0,topDamageTaken:0,totalHealingDone:0,topHealingDone:0,totalShieldDone:0,topShieldDone:0,debuffs:new Map,buffs:new Map,appliedShieldingBuffs:new Map,effectiveShieldingBuffs:new Map,topEffectiveShieldingDone:0,topEffectiveShieldingUsed:0,topShieldGotten:0,totalEffectiveShieldingDone:0}},this.emit("reset-state",this.#t)}cancelReset(){this.resetTimer&&clearTimeout(this.resetTimer),this.resetTimer=null}onPhaseTransition(t,a){this.options.isLive&&(this.emit("message",`phase-transition-${t}`),this.options.resetAfterPhaseTransition&&(this.phaseTransitionResetRequest=!0,this.phaseTransitionResetRequestTime=+a)),!this.options.isLive&&this.options.splitOnPhaseTransition&&this.splitEncounter(a)}updateOptions(t){this.options={...this.options,...t}}onDeath(t,a){let n=this.#t.entities.get(t.name),r=0;n?n.isDead?r=n.deaths:r=n.deaths+1:r=1,this.updateEntity(t,{isDead:!0,deathTime:+a,deaths:r},a)}onDamage(t,a,n,r,o,i){if((r.modifier&15)===11&&r.skillId===0&&r.skillEffectId===0)return;this.phaseTransitionResetRequest&&this.phaseTransitionResetRequestTime>0&&this.phaseTransitionResetRequestTime<+i-8e3&&(this.resetState(+i),this.phaseTransitionResetRequest=!1);let[f,c]=this.#r.getStatusEffects(t,n,this.#n.localPlayer.characterId,i);if(this.#a.isBattleItem(r.skillEffectId,"attack")&&a&&a.entityType===5){let w=a;r.skillEffectId=w.skillEffectId}let l=this.updateEntity(t,{},i),S=this.updateEntity(n,{currentHp:r.targetCurHp,maxHp:r.targetMaxHp},i);if(!l||!S)return;!S.isPlayer&&r.targetCurHp<0&&(r.damage=r.damage+r.targetCurHp);let b=r.skillId;r.skillId===0&&r.skillEffectId!==0&&(b=r.skillEffectId);let I=l.skills.get(b);I||(I={...this.createEntitySkill(),id:b,...this.getSkillNameIcon(r.skillId,r.skillEffectId)},l.skills.set(b,I));let H=r.modifier&15,L=(r.modifier>>4&7)-1,K=(H&9)!==0,$=new Set,C=new Set;f.forEach(([w])=>{$.add(w)}),c.forEach(([w])=>{C.add(w)}),I.damageInfo.damageDealt+=r.damage,r.damage>I.maxDamage&&(I.maxDamage=r.damage),l.hits.total+=1,I.hits.total+=1,l.damageInfo.damageDealt+=r.damage,S.damageTaken+=r.damage;let Le=K?1:0;l.hits.crit+=Le,I.hits.crit+=Le;let Ae=!1,Ke=!1,we=this.#a.getSkillEffectDirectionalMask(r.skillEffectId)-1;if(we===0||we===2){Ke=L===0;let w=Ke?1:0;l.hits.backAttack+=w,l.hits.totalBackAttack+=1,I.hits.backAttack+=w,I.hits.totalBackAttack+=1}if(we===1||we===2){Ae=L===1;let w=Ae?1:0;l.hits.frontAttack+=w,l.hits.totalFrontAttack+=1,I.hits.frontAttack+=w,I.hits.totalFrontAttack+=1}if(l.isPlayer){this.#t.damageStatistics.totalDamageDealt+=r.damage,this.#t.damageStatistics.topDamageDealt=Math.max(this.#t.damageStatistics.topDamageDealt,l.damageInfo.damageDealt);let w=!1,ct=!1;$.forEach(m=>{if(!this.#t.damageStatistics.buffs.has(m)){let N=this.#a.getStatusEffectHeaderData(m);N&&this.#t.damageStatistics.buffs.set(m,N)}let A=this.#t.damageStatistics.buffs.get(m);A&&!w&&(w=(A.buffcategory==="classskill"||A.buffcategory==="identity"||A.buffcategory==="ability")&&A.source.skill!==void 0&&A.target===1&&this.#a.isSupportClassId(A.source.skill.classid));let J=I.damageDealtBuffedBy.get(m)??0;I.damageDealtBuffedBy.set(m,J+r.damage);let dt=l.damageDealtBuffedBy.get(m)??0;l.damageDealtBuffedBy.set(m,dt+r.damage);let xt=l.hits.hitsBuffedBy.get(m)??0;l.hits.hitsBuffedBy.set(m,xt+1);let R=I.hits.hitsBuffedBy.get(m)??0;I.hits.hitsBuffedBy.set(m,R+1)}),C.forEach(m=>{if(!this.#t.damageStatistics.debuffs.has(m)){let N=this.#a.getStatusEffectHeaderData(m);N&&this.#t.damageStatistics.debuffs.set(m,N)}let A=this.#t.damageStatistics.debuffs.get(m);A&&!ct&&(ct=(A.buffcategory==="classskill"||A.buffcategory==="identity"||A.buffcategory==="ability")&&A.source.skill!==void 0&&A.target===1&&this.#a.isSupportClassId(A.source.skill.classid));let J=I.damageDealtDebuffedBy.get(m)??0;I.damageDealtDebuffedBy.set(m,J+r.damage);let dt=l.damageDealtDebuffedBy.get(m)??0;l.damageDealtDebuffedBy.set(m,dt+r.damage);let xt=l.hits.hitsDebuffedBy.get(m)??0;l.hits.hitsDebuffedBy.set(m,xt+1);let R=I.hits.hitsDebuffedBy.get(m)??0;I.hits.hitsDebuffedBy.set(m,R+1)});let ys=ct?1:0,Rs=w?1:0;if(I.damageInfo.damageDealtBuffedBySupport+=w?r.damage:0,I.damageInfo.damageDealtDebuffedBySupport+=ct?r.damage:0,l.damageInfo.damageDealtBuffedBySupport+=w?r.damage:0,l.damageInfo.damageDealtDebuffedBySupport+=ct?r.damage:0,l.hits.hitsBuffedBySupport+=Rs,l.hits.hitsDebuffedBySupport+=ys,I.hits.hitsBuffedBySupport+=Rs,I.hits.hitsDebuffedBySupport+=ys,r.damage>0&&l.isPlayer){let m={multDmg:{sumRate:0,totalRate:1,values:Array()},atkPowSubRate2:{selfSumRate:0,sumRate:0,values:Array()},atkPowSubRate1:{sumRate:0,totalRate:1,values:Array()},skillDamRate:{selfSumRate:0,sumRate:0,values:Array()},atkPowAmplify:{values:Array()},crit:{selfSumRate:0,sumRate:0,values:Array()},critDmgRate:2};if(f.forEach(([R,N,g])=>{let v=this.#n.entities.get(N);if(!v)return;let _=this.getBuffAfterTripods(this.#a.skillBuff.get(R),v,r);if(_){if(_.type==="skill_damage_amplify"&&_.statuseffectvalues&&v.entityType===1&&N!==t.entityId){let k=_.statuseffectvalues[0]??0,h=_.statuseffectvalues[4]??0;if((k===0||k===r.skillId)&&(h===0||h===r.skillEffectId)){let E=_.statuseffectvalues[1]??0;if(E!==0){let x=E/1e4*g;m.multDmg.values.push({casterEntity:v,rate:x}),m.multDmg.sumRate+=x,m.multDmg.totalRate*=1+x}}}else if(_.type==="attack_power_amplify"&&_.statuseffectvalues&&v.entityType===1&&N!==t.entityId){let k=_.statuseffectvalues[0]??0;if(k!==0){let h=k/1e4*g,E=this.#i.getStats(v.name)?.find(j=>j.id===4)?.value,x=this.#i.getStats(t.name)?.find(j=>j.id===4)?.value;E&&x&&(h*=E/x),m.atkPowAmplify.values.push({casterEntity:v,rate:h})}}_.passiveoption.forEach(k=>{if(ot[k.type]===2){if(k.keystat==="attack_power_sub_rate_2"){let h=k.value;if(h!==0){let E=h/1e4*g;v.entityType===1&&N!==t.entityId?(m.atkPowSubRate2.values.push({casterEntity:v,rate:E}),m.atkPowSubRate2.sumRate+=E):m.atkPowSubRate2.selfSumRate+=E}}else if(k.keystat==="attack_power_sub_rate_1"){let h=k.value;if(h!==0){let E=h/1e4*g;v.entityType===1&&N!==t.entityId&&(m.atkPowSubRate1.values.push({casterEntity:v,rate:E}),m.atkPowSubRate1.sumRate+=E,m.atkPowSubRate1.totalRate*=1+E)}}else if(k.keystat==="skill_damage_rate"){let h=k.value;if(h!==0){let E=h/1e4*g;v.entityType===1&&N!==t.entityId?(m.skillDamRate.values.push({casterEntity:v,rate:E}),m.skillDamRate.sumRate+=E):m.skillDamRate.selfSumRate+=E}}}if(k.keystat==="critical_hit_rate"){let h=k.value;if(h!==0){let E=h/1e4*g;v.entityType===1&&N!==t.entityId?(m.crit.values.push({casterEntity:v,rate:E}),m.crit.sumRate+=E):m.crit.selfSumRate+=E}}if(v.entityType===1&&N!==t.entityId)if(k.keystat==="skill_damage_sub_rate_2"){let h=k.value;if(h!==0){let E=h/1e4*g,x=this.#i.getStats(v.name)?.find(j=>j.id===1)?.value??0;switch(v.class){case 204:E*=1+x/.0699*.35/1e4;break;case 105:E*=1+x/.0699*.63/1e4;break;case 602:E*=1+x/.0699*.38/1e4;break;default:break}m.multDmg.values.push({casterEntity:v,rate:E}),m.multDmg.sumRate+=E,m.multDmg.totalRate*=1+E}}else k.keystat==="critical_dam_rate"&&_.category==="buff"&&(m.critDmgRate+=k.value/1e4*g);else if(ot[k.type]===4){let h=this.#a.combatEffect.get(k.keyindex);m.critDmgRate+=g*this.getCritMultiplierFromCombatEffect(h,{self:t,target:n,caster:v,skill:this.#a.skill.get(b),hitOption:L,targetCount:o})}})}}),c.forEach(([R,N,g])=>{let v=this.#n.entities.get(N);if(!v)return;let _=this.getBuffAfterTripods(this.#a.skillBuff.get(R),v,r);if(_){if(_.type==="instant_stat_amplify"&&_.statuseffectvalues){let k=_.statuseffectvalues[0]??0;if(k!==0){let h=k/1e4*g;v.entityType===1&&N!==t.entityId?(m.crit.values.push({casterEntity:v,rate:h}),m.crit.sumRate+=h):m.crit.selfSumRate+=h}}if(!(v.entityType!==1||N===t.entityId)){if(_.type==="instant_stat_amplify"&&_.statuseffectvalues){let k=_.statuseffectvalues[0]??0;if(r.damageType===0){let h=_.statuseffectvalues[2]??0;if(h!==0){let x=-(h/1e4)*g*.5;m.multDmg.values.push({casterEntity:v,rate:x}),m.multDmg.sumRate+=x,m.multDmg.totalRate*=1+x}let E=_.statuseffectvalues[7]??0;if(E!==0){let x=E/1e4*g;m.multDmg.values.push({casterEntity:v,rate:x}),m.multDmg.sumRate+=x,m.multDmg.totalRate*=1+x}if(K){let x=_.statuseffectvalues[9]??0;if(x!==0){let j=x/1e4*g;m.multDmg.values.push({casterEntity:v,rate:j}),m.multDmg.sumRate+=j,m.multDmg.totalRate*=1+j}}}else if(r.damageType===1){let h=_.statuseffectvalues[3]??0;if(h!==0){let x=-(h/1e4)*g*.5;m.multDmg.values.push({casterEntity:v,rate:x}),m.multDmg.sumRate+=x,m.multDmg.totalRate*=1+x}let E=_.statuseffectvalues[8]??0;if(E!==0){let x=E/1e4*g;m.multDmg.values.push({casterEntity:v,rate:x}),m.multDmg.sumRate+=x,m.multDmg.totalRate*=1+x}if(K){let x=_.statuseffectvalues[10]??0;if(x!==0){let j=x/1e4*g;m.multDmg.values.push({casterEntity:v,rate:j}),m.multDmg.sumRate+=j,m.multDmg.totalRate*=1+j}}}}if(_.type==="skill_damage_amplify"&&_.statuseffectvalues){let k=_.statuseffectvalues[0]??0,h=_.statuseffectvalues[4]??0;if((k===0||k===r.skillId)&&(h===0||h===r.skillEffectId)){let E=_.statuseffectvalues[1]??0;if(E!==0){let x=E/1e4*g;m.multDmg.values.push({casterEntity:v,rate:x}),m.multDmg.sumRate+=x,m.multDmg.totalRate*=1+x}}}if(_.type==="directional_attack_amplify"&&_.statuseffectvalues){if(Ae){let k=_.statuseffectvalues[0]??0;if(k!==0){let h=k/100*g;m.multDmg.values.push({casterEntity:v,rate:h}),m.multDmg.sumRate+=h,m.multDmg.totalRate*=1+h}}if(Ke){let k=_.statuseffectvalues[4]??0;if(k!==0){let h=k/100*g;m.multDmg.values.push({casterEntity:v,rate:h}),m.multDmg.sumRate+=h,m.multDmg.totalRate*=1+h}}}}}}),m.crit.values.length>0){let R=this.#a.skill.get(r.skillId);t.itemSet?.forEach(N=>{if(ot[N.type]===2&&bt[N.keystat]===76)m.critDmgRate+=N.value/1e4;else if(ot[N.type]===4){let g=this.#a.combatEffect.get(N.keyindex);m.critDmgRate+=this.getCritMultiplierFromCombatEffect(g,{self:t,target:n,caster:t,skill:R,hitOption:L,targetCount:o})}t.skills.get(r.skillId)?.tripods.forEach(g=>{let v=new Map;g.options.forEach(_=>{let k=Me[_.type];if(k===45){if((_.params[0]??0)===0||r.skillEffectId===(_.params[0]??0)){let h=_.params[1];if(h){let E=this.#a.combatEffect.get(h);E&&v.set(E.id,E)}}}else if(k===46)v.delete(_.params[0]??0);else if(k===104){if((_.params[0]??0)===0||r.skillEffectId===(_.params[0]??0)){let h=v.get(_.params[1]??0);if(h){let E=structuredClone(h);v.set(h.id,E),E.effects.forEach(x=>{x.actions.forEach(j=>{for(let pt=0;pt<_.params.length-2;pt++)Ce[_.paramtype]===1?j.args[pt]*=1+(_.params[pt+2]??0)/100:j.args[pt]+=_.params[pt+2]??0})})}}}else k===29?((_.params[0]??0)===0||r.skillEffectId===(_.params[0]??0))&&(m.critDmgRate+=(_.params[1]??0)/1e4):k===30&&((_.params[0]??0)===0||r.skillEffectId===(_.params[0]??0))&&(m.crit.selfSumRate+=(_.params[1]??0)/1e4)}),v.forEach(_=>{m.critDmgRate+=this.getCritMultiplierFromCombatEffect(_,{self:t,target:n,caster:t,skill:R,hitOption:L,targetCount:o})})})})}if(m.skillDamRate.values.length>0){let R=this.#i.getStats(t.name)?.find(N=>N.id===5)?.value;R&&(m.skillDamRate.selfSumRate+=R/1e4)}let A=0;if(m.crit.values.length>0){m.crit.selfSumRate+=(this.#i.getStats(t.name)?.find(N=>N.id===0)?.value??0)/.2794/1e4;let R=Math.min(Math.max(0,1-m.crit.selfSumRate),m.crit.sumRate);A=(R*m.critDmgRate-R)/(m.crit.selfSumRate*m.critDmgRate-m.crit.selfSumRate+1)}let J=m.atkPowAmplify.values.length<=0?{rate:0}:m.atkPowAmplify.values.reduce((R,N)=>R.rate>N.rate?R:N),dt=(1+A)*(1+m.atkPowSubRate2.sumRate/(1+m.atkPowSubRate2.selfSumRate))*(1+m.skillDamRate.sumRate/(1+m.skillDamRate.selfSumRate))*(1+J.rate)*m.multDmg.totalRate*m.atkPowSubRate1.totalRate-1,xt=A+m.atkPowSubRate2.sumRate/(1+m.atkPowSubRate2.selfSumRate)+m.skillDamRate.sumRate/(1+m.skillDamRate.selfSumRate)+J.rate+(m.multDmg.totalRate-1)+(m.atkPowSubRate1.totalRate-1);{let R=dt*r.damage/(xt*(1+dt)),N=A*R/m.crit.sumRate;m.crit.values.forEach(_=>{let k=_.rate*N,h=this.#t.entities.get(_.casterEntity.name);this.applyRdps(l,h,I,k)}),m.atkPowSubRate2.values.forEach(_=>{let k=_.rate/(1+m.atkPowSubRate2.selfSumRate)*R,h=this.#t.entities.get(_.casterEntity.name);this.applyRdps(l,h,I,k)}),m.skillDamRate.values.forEach(_=>{let k=_.rate/(1+m.skillDamRate.selfSumRate)*R,h=this.#t.entities.get(_.casterEntity.name);this.applyRdps(l,h,I,k)});let g=(m.multDmg.totalRate-1)*R/m.multDmg.sumRate;m.multDmg.values.forEach(_=>{let k=_.rate*g,h=this.#t.entities.get(_.casterEntity.name);this.applyRdps(l,h,I,k)});let v=(m.atkPowSubRate1.totalRate-1)*R/m.atkPowSubRate1.sumRate;if(m.atkPowSubRate1.values.forEach(_=>{let k=_.rate*v,h=this.#t.entities.get(_.casterEntity.name);this.applyRdps(l,h,I,k)}),J.rate>0){let _=J.rate*R,k=this.#t.entities.get(J.casterEntity?.name);this.applyRdps(l,k,I,_)}}}let P={timestamp:+i,damage:r.damage,targetEntity:S.id,isCrit:K,isBackAttack:Ke,isFrontAttack:Ae,isBuffedBySupport:w,isDebuffedBySupport:ct,buffedBy:[...$],debuffedBy:[...C]},Wu=BigInt("0x"+l.id);this.addBreakdown(Wu,b,P)}S.isPlayer&&(this.#t.damageStatistics.totalDamageTaken+=r.damage,this.#t.damageStatistics.topDamageTaken=Math.max(this.#t.damageStatistics.topDamageTaken,S.damageTaken)),S.isBoss&&(this.#t.currentBoss=S),this.#t.fightStartedOn===0&&(this.#t.fightStartedOn=+i),this.#t.lastCombatPacket=+i}getBuffAfterTripods(t,a,n){if(!t||a.entityType!==1)return t;let r=structuredClone(t);return a.skills.get(n.skillId)?.tripods.forEach(o=>{o.options.forEach(i=>{let f=Me[i.type];if(f===19){if(((i.params[0]??0)===0||n.skillEffectId===(i.params[0]??0))&&r.id===(i.params[1]??0)){let c=new Map;for(let l=2;l<i.params.length;l+=2)i.params[l]&&i.params[l+1]&&c.set(i.params[l]??0,i.params[l+1]??0);r.passiveoption.forEach(l=>{let S=c.get(bt[l.keystat]);ot[l.type]===2&&S&&(Ce[i.paramtype]===0?l.value+=S:l.value*=1+S/100)})}}else if(f===42){if(((i.params[0]??0)===0||n.skillEffectId===(i.params[0]??0))&&r.id===(i.params[1]??0)){let c=bt[i.params[2]??0],l=i.params[3]??0;c&&l!==void 0&&r.passiveoption.push({type:"stat",keystat:c,keyindex:0,value:l})}}else if(f===21&&r.statuseffectvalues&&((i.params[0]??0)===0||n.skillEffectId===(i.params[0]??0))&&r.id===(i.params[1]??0))if((i.paramtype[2]??0)===0)r.statuseffectvalues=i.params.slice(3);else{let c=[];for(let l=0;l<Math.max(r.statuseffectvalues.length,i.params.length-3);l++)i.params[l+3]&&c.push((r.statuseffectvalues[l]??0)*(1+(i.params[l+3]??0)/100));r.statuseffectvalues=c}})}),r}getCritMultiplierFromCombatEffect(t,a){if(!t)return 0;let n=0;return t.effects.filter(r=>r.actions.find(o=>Be[o.type]===4)).forEach(r=>{this.#a.isCombatEffectConditionsValid({effect:r,...a})&&r.actions.filter(o=>Be[o.type]===4).forEach(o=>{n+=(o.args[0]??0)/100})}),n}applyRdps(t,a,n,r){a&&(a.damageInfo.rdpsDamageGiven+=r),a&&this.#a.isSupportClassId(a.classId)&&(t.damageInfo.rdpsDamageReceivedSupp+=r,n.damageInfo.rdpsDamageReceivedSupp+=r),t.damageInfo.rdpsDamageReceived+=r,n.damageInfo.rdpsDamageReceived+=r}onStartSkill(t,a,n){let r=this.updateEntity(t,{isDead:!1},n);if(r){r.hits.casts+=1;let o=r.skills.get(a);o||(o={...this.createEntitySkill(),id:a,...this.getSkillNameIcon(a,0)},r.skills.set(a,o)),o.hits.casts+=1}}onShieldUsed(t,a,n,r){if(r<0&&console.error("Shield change values was negative, shield ammount increased"),t.entityType===1&&a.entityType===1){if(!this.#t.damageStatistics.effectiveShieldingBuffs.has(n)){let S=this.#a.getStatusEffectHeaderData(n);S&&this.#t.damageStatistics.effectiveShieldingBuffs.set(n,S)}let o=new Date,i=this.updateEntity(t,{},o),f=this.updateEntity(a,{},o);i.damagePreventedByShield+=r;let c=i.damagePreventedByShieldBy.get(n)??0;i.damagePreventedByShieldBy.set(n,c+r),this.#t.damageStatistics.topEffectiveShieldingUsed=Math.max(i.damagePreventedByShield,this.#t.damageStatistics.topEffectiveShieldingUsed),f.damagePreventedWithShieldOnOthers+=r;let l=f.damagePreventedWithShieldOnOthersBy.get(n)??0;f.damagePreventedWithShieldOnOthersBy.set(n,l+r),this.#t.damageStatistics.topEffectiveShieldingDone=Math.max(f.damagePreventedWithShieldOnOthers,this.#t.damageStatistics.topEffectiveShieldingDone),this.#t.damageStatistics.totalEffectiveShieldingDone+=r}}onShieldApplied(t,a,n,r){let o=new Date,i=this.updateEntity(t,{},o),f=this.updateEntity(a,{},o);if(f.isPlayer&&i.isPlayer){if(!this.#t.damageStatistics.appliedShieldingBuffs.has(n)){let S=this.#a.getStatusEffectHeaderData(n);S&&this.#t.damageStatistics.appliedShieldingBuffs.set(n,S)}i.shieldReceived+=r,f.shieldDone+=r;let c=f.shieldDoneBy.get(n)??0;f.shieldDoneBy.set(n,c+r);let l=i.shieldReceivedBy.get(n)??0;i.shieldReceivedBy.set(n,l+r),this.#t.damageStatistics.topShieldDone=Math.max(f.shieldDone,this.#t.damageStatistics.topShieldDone),this.#t.damageStatistics.topShieldGotten=Math.max(i.shieldReceived,this.#t.damageStatistics.topShieldGotten),this.#t.damageStatistics.totalShieldDone+=r}}getSkillNameIcon(t,a){if(t===0&&a===0)return{name:"Bleed",icon:"buff_168.png"};if(t===0){let n=this.#a.skillEffect.get(a);if(n&&n.itemname)return{name:n.itemname,icon:n.icon??""};if(n){if(n.sourceskill){let r=this.#a.skill.get(n.sourceskill);if(r)return{name:r.name,icon:r.icon}}else{let r=this.#a.skill.get(Math.floor(a/10));if(r)return{name:r.name,icon:r.icon}}return{name:n.comment}}else return{name:this.#a.getSkillName(t)}}else{let n=this.#a.skill.get(t);return!n&&(n=this.#a.skill.get(t-t%10),!n)?{name:this.#a.getSkillName(t),icon:""}:n.summonsourceskill?(n=this.#a.skill.get(n.summonsourceskill),n?{name:n.name+" (Summon)",icon:n.icon}:{name:this.#a.getSkillName(t),icon:""}):n.sourceskill?(n=this.#a.skill.get(n.sourceskill),n?{name:n.name,icon:n.icon}:{name:this.#a.getSkillName(t),icon:""}):{name:n.name,icon:n.icon}}}updateEntity(t,a,n){let r={lastUpdate:+n},o=this.#t.entities.get(t.name),i={};if(!o||t.entityType===1&&o.isPlayer!==!0){if(t.entityType===1){let f=t;i={classId:f.class,gearScore:f.gearLevel,isPlayer:!0}}else if(t.entityType===2||t.entityType===3){let f=t;i={npcId:f.typeId,isBoss:f.isBoss}}else if(t.entityType===4){let f=t;i={npcId:f.typeId,isBoss:f.isBoss,isEsther:!0,icon:f.icon}}}return o?Object.assign(o,a,r,i):(o={...this.createEntity(),...a,...r,...i,name:t.name,id:t.entityId.toString(16)},this.#t.entities.set(t.name,o)),o}updateOrCreateEntity(t,a,n){if(!(!a.name||!a.id)){for(let[r,o]of this.#t.entities)if(a.id===o.id){this.#t.entities.delete(r),this.updateEntity(t,{...o,...a},n);return}this.updateEntity(t,a,n)}}createEntitySkill(){return{id:0,name:"",icon:"",damageInfo:{damageDealt:0,rdpsDamageReceived:0,rdpsDamageReceivedSupp:0,rdpsDamageGiven:0,damageDealtDebuffedBySupport:0,damageDealtBuffedBySupport:0},maxDamage:0,hits:{casts:0,total:0,crit:0,backAttack:0,totalBackAttack:0,frontAttack:0,totalFrontAttack:0,counter:0,hitsDebuffedBySupport:0,hitsBuffedBySupport:0,hitsBuffedBy:new Map,hitsDebuffedBy:new Map},breakdown:[],damageDealtDebuffedBy:new Map,damageDealtBuffedBy:new Map}}createEntity(){return{lastUpdate:0,id:"",npcId:0,name:"",classId:0,isBoss:!1,isPlayer:!1,isDead:!1,deaths:0,deathTime:0,gearScore:0,currentHp:0,maxHp:0,damageInfo:{damageDealt:0,rdpsDamageReceived:0,rdpsDamageReceivedSupp:0,rdpsDamageGiven:0,damageDealtDebuffedBySupport:0,damageDealtBuffedBySupport:0},healingDone:0,shieldDone:0,damageTaken:0,skills:new Map,hits:{casts:0,total:0,crit:0,backAttack:0,totalBackAttack:0,frontAttack:0,totalFrontAttack:0,counter:0,hitsDebuffedBySupport:0,hitsBuffedBySupport:0,hitsBuffedBy:new Map,hitsDebuffedBy:new Map},damageDealtDebuffedBy:new Map,damageDealtBuffedBy:new Map,damagePreventedByShieldBy:new Map,damagePreventedWithShieldOnOthersBy:new Map,shieldDoneBy:new Map,shieldReceivedBy:new Map,damagePreventedWithShieldOnOthers:0,damagePreventedByShield:0,shieldReceived:0,statApiValid:!1}}getBroadcast(){let t={...this.#t};return t.entities=new Map,this.#t.entities.forEach((a,n)=>{!a.isPlayer&&!a.isEsther||(a.statApiValid=this.#i.isCurrentZoneValid()&&this.#i.cache.get(a.name)?.status===2,t.entities.set(n,{...a}))}),t.localPlayer=this.#n.localPlayer.name,t}resetBreakdowns(){this.#e.clear()}createBreakdownEntity(t){return this.#e.has(t)||this.#e.set(t,new Map),this.#e.get(t)}removeBreakdownEntry(t){this.#e.delete(t)}addBreakdown(t,a,n){let r=this.createBreakdownEntity(t);if(r.has(a))r.get(a).push(n);else{let o=new Array(n);r.set(a,o)}}getBreakdowns(t,a){let n=this.#e.get(t);if(n)return n.get(a)}clearBreakdowns(t,a){let n=this.#e.get(t);n&&n.delete(a)}applyBreakdowns(t,a=!0){t.forEach(n=>{n.skills.forEach(r=>{let o=BigInt("0x"+n.id),i=this.getBreakdowns(o,r.id);i&&(r.breakdown=[...i])})}),a&&this.resetBreakdowns()}setKillState(t){this.#t.killState=t}setZoneLevel(t){this.#t.zoneLevel=je[t]}};var ju=require("tiny-typed-emitter");function Et(e){let t={};return t.points=e.u16(),t.id=e.u32(),t.level=e.u8(),t}function To(e){let t=new p(e),a={};return a.abilityDataList=t.array(t.u16(),()=>Et(t),100),a}var Eo="PKTAbilityChangeNotify",Kt=34237;function cu(e){let t={};return t.level=e.u32(),t.featureType=e.u16(),t}function vo(e){let t=new p(e),a={};return a.activeAbilityList=t.array(t.u16(),()=>cu(t),60),a.objectId=t.u64(),a}var xo="PKTActiveAbilityNotify",wt=23742;function No(e){let t=new p(e),a={};return a.addonFeatureIdList=t.bytes(t.u16(),200,4),a.objectId=t.u64(),a.addonSkillFeatureList=t.array(t.u16(),()=>{let n={};return n.skillId=t.u32(),n.addonSkillFeatureIdList=t.array(t.u16(),()=>t.u32(),5),n},200),a}var Do="PKTAddonSkillFeatureChangeNotify",Bt=9808;function yo(e){let t=new p(e),a={};return a.packetResultCode=t.u32(),a.unk1_m=t.bytes(t.u32(),688),a}var Ro="PKTAuthTokenResult",go=24597;function Lo(e){let t=new p(e),a={};return a.paralyzationPoint=t.u32(),a.type=t.u8(),t.skip(1),a.paralyzationMaxPoint=t.u32(),t.skip(2),a.objectId=t.u64(),a}var Ao="PKTBlockSkillStateNotify",Ct=43110;function Ko(e){let t=new p(e),a={};return t.skip(1),a.targetId=t.u64(),t.skip(1),a.sourceId=t.u64(),a.type=t.u32(),a}var wo="PKTCounterAttackNotify",Mt=2889;function Bo(e){let t=new p(e),a={};return a.unk0=t.u64(),t.bool()&&(a.unk2_0=t.u8()),a.targetId=t.u64(),a.unk4=t.u32(),a.unk5=t.u32(),a.unk6=t.u8(),a.sourceId=t.u64(),t.bool()&&(a.unk9_0=t.u8()),a.unk10=t.u16(),t.bool()&&(a.unk12_0=t.u8()),a}var Co="PKTDeathNotify",jt=20789;function tt(e){let t={};return t.slot=e.u16(),t.expireTime=O(e),t.level=e.u16(),e.bool()&&(t.unk4_0=e.u8()),t.itemTint=e.bytes(e.u16(),5,14),t.id=e.u32(),t}function Mo(e){let t=new p(e),a={};return a.equipItemDataList=t.array(t.u16(),()=>tt(t),33),a.objectId=t.u64(),a.unk2=t.u32(),a.unk3=t.u32(),a}var jo="PKTEquipChangeNotify",Ot=46264;function Oo(e){let t=new p(e),a={};return a.objectId=t.u64(),a.equipLifeToolDataList=t.array(t.u16(),()=>tt(t),9),a}var Fo="PKTEquipLifeToolChangeNotify",Ft=15165;function qo(e){let t=new p(e),a={};return a.objectId=t.u64(),a.stance=t.u8(),t.skip(1),a}var Wo="PKTIdentityStanceChangeNotify",qt=74;function Uo(e){let t=new p(e),a={};return a.struct_135=t.bytes(t.u16(),353,48),a.abilityDataList=t.array(t.u16(),()=>Et(t),100),a}var Vo="PKTInitAbility",Wt=27635;function Zo(e){let t=new p(e),a={};return a.lostArkDateTime=O(t),a.unk1=t.u32(),a.unk2=t.u8(),a.playerId=t.u64(),a.unk4=t.u32(),a.unk5=t.u64(),a.struct_29=t.array(t.u16(),()=>{let n={};return n.versionString=t.string(64),n.struct_573=t.string(32),n.struct_590=t.string(128),n},64),a.struct_590=t.string(128),a}var Ho="PKTInitEnv",Ut=43544;function Z(e){let t={};return t.stackCount=e.u8(),t.skillLevel=e.u8(),t.totalTime=e.f32(),t.endTick=e.u64(),t.struct_441=e.bytes(e.u16(),8,7),t.effectInstanceId=e.u32(),t.occurTime=O(e),e.bool()&&(t.unk8_0=e.u64()),t.sourceId=e.u64(),e.bool()&&(t.value=e.bytes(16)),t.statusEffectId=e.u32(),t}function vt(e){let t={};return t.unk0=T(e),t.unk1=e.u16(),t.unk2=e.u8(),t.unk3=e.u64(),t.unk4=T(e),t.unk5=e.u8(),t.unk6=e.u8(),t}function Go(e){let t=new p(e),a={};return a.unk0=t.u16(),a.unk1=t.u64(),a.unk2=t.u8(),a.unk3=t.u16(),a.unk4=t.u32(),a.unk5=t.u64(),a.playerId=t.u64(),a.unk7=t.u8(),a.unk8=t.u8(),a.struct_367=t.string(7),a.unk10=t.u8(),a.unk11=t.u8(),a.statusEffectDatas=t.array(t.u16(),()=>Z(t),80),a.unk13=t.bytes(35),a.unk14=t.u32(),a.unk15=t.u8(),a.unk16=t.u8(),a.unk17=t.u32(),a.unk18=t.u8(),a.level=t.u16(),a.unk20=t.u64(),a.characterId=t.u64(),a.unk22=t.u8(),a.unk23=t.u8(),a.unk24=t.u32(),a.unk25=t.u8(),a.unk26=t.u16(),a.unk27=t.u8(),a.classId=t.u16(),a.unk29=t.u64(),a.unk30=t.u8(),a.unk31=t.bytes(120),a.unk32=t.u32(),a.unk33=t.u8(),a.unk34=t.u8(),a.unk35=t.u16(),a.unk36=t.u8(),a.unk37=t.u32(),a.struct_103=t.bytes(t.u16(),63),a.unk39=t.u32(),a.unk40=t.bytes(25),a.unk41=t.u32(),a.unk42=t.u8(),a.unk43=t.u32(),t.bool()&&(a.unk45_0=t.u32()),a.unk46=t.u8(),a.unk47=t.u64(),a.struct_226=t.bytes(t.u16(),3,17),a.statPair=t.array(t.u16(),()=>{let n={};return n.value=T(t),n.statType=t.u8(),n},153),a.struct_344=t.bytes(t.u16(),104,30),a.unk51=t.u8(),a.unk52=t.u32(),a.periodUpdateStatDataList=t.array(t.u16(),()=>vt(t),5),a.gearLevel=t.f32(),a.name=t.string(20),a.unk56=t.u32(),a.unk57=t.u8(),a}var Yo="PKTInitPC",Vt=56597;function du(e){let t={},a=e.u16();return a===1&&(t.unk1_0=e.bytes(a)),t}function pu(e){let t={};return t.unk0=e.u32(),t.unk1=e.u8(),t.unk2=e.u8(),t.struct_144=du(e),t.unk4=e.u8(),t.unk5=e.u32(),t.unk6=e.u8(),t.struct_145=e.bytes(e.u16(),3,9),t}function _u(e){let t={};return t.unk0=e.u32(),t.struct_240=e.bytes(e.u16(),10,18),t.unk2=e.u64(),t.struct_393=e.bytes(e.u16(),2,10),t.unk4=e.u32(),t.unk5=e.u32(),t.unk6=e.u32(),t.unk7=e.u16(),t.unk8=e.u8(),t.struct_146=e.bytes(e.u16(),10,9),t.unk10=e.u32(),t.unk11=e.u32(),t.struct_238=e.array(e.u16(),()=>pu(e),3),t.struct_261=e.bytes(e.u16(),2,9),t}function bu(e){let t={};return t.unk0=e.u16(),t.unk1=e.u8(),t.struct_97=e.bytes(e.u32(),51),t.unk3=e.u16(),t.unk4=e.u8(),t.unk5=e.bytes(3),t.unk6=e.u8(),t.unk7=e.u16(),t}function hu(e){let t={};return t.unk0=e.bytes(e.u16(),7),t.unk1=e.bytes(e.u16(),7),e.bool()&&(t.struct_746=bu(e)),t.unk4=e.u8(),t}function Su(e){let t={};return t.unk0=e.u32(),t.unk1=e.u32(),t.unk2=e.u32(),e.bool()&&(t.unk4_0=e.bytes(9)),t.struct_272=e.bytes(e.u16(),3,21),e.bool()&&(t.struct_232=e.bytes(e.u16(),2,32)),t.unk8=e.u8(),e.bool()&&(t.unk1_0=e.u32(),t.struct_193=e.bytes(e.u16(),5,30),t.unk1_2=e.u32()),t.unk10=e.u32(),t.struct_234=e.bytes(e.u16(),3,7),t.struct_436=e.bytes(e.u16(),3,10),t.itemTint=e.bytes(e.u16(),5,14),t.unk14=e.u32(),t.struct_274=e.bytes(e.u16(),10,29),t.unk16=e.u32(),e.bool()&&(t.struct_786=hu(e)),t}function ta(e){let t={};return t.isDead=e.bool(),t.npcId=e.u32(),t}function ku(e){let t={};return t.struct_1=e.array(e.u16(),()=>{let a={};return a.unk1_0_0=e.u32(),a.struct_523=e.bytes(e.u16(),10),a},3),t.unk1=e.u32(),t.unk2=e.u8(),t.bossKillDataList=e.array(e.u16(),()=>ta(e),3),t.unk4=e.u8(),t}function Iu(e){let t={};return t.struct_22=e.array(e.u16(),()=>{let a={};return a.unk1_0_0=e.u8(),a.struct_233=e.string(2),a.unk1_0_2=e.u16(),a},20),t.struct_234=e.bytes(e.u16(),3,7),t.unk2=e.u8(),t.struct_236=e.bytes(e.u16(),5,7),t.unk4=e.u8(),t.unk5=e.u8(),t}function Tu(e){let t={},a=e.u8();return a===1&&(t.struct_661=_u(e)),a===2&&(t.struct_132=e.bytes(e.u16(),3,6),t.struct_2=e.array(e.u16(),()=>{let n={};return n.unk1_0_0=e.u32(),n.struct_523=e.bytes(e.u16(),10),n.unk1_0_2=e.u8(),n.unk1_0_3=e.u8(),n},3),t.unk2_2=e.u8()),a===3&&(t.unk3_0=e.bytes(26)),a===4&&(t.unk4_0=e.bytes(e.u16(),10,13),t.unk4_1=e.bytes(e.u16(),10,13),t.unk4_2=e.u32()),a===5&&(t.struct_660=Su(e)),a===6&&(t.struct_605=ku(e)),a===7&&(t.unk7_0=e.bytes(9)),a===8&&(t.struct_653=Iu(e)),a===9&&(t.unk9_0=e.u8()),t}function Eu(e){let t={};return e.u32()>0&&(t.serialNumber=e.u64(),t.id=e.u32(),t.level=e.u16(),t.slot=e.u16(),t.durability=e.u32(),t.unk1_6_m=e.u32(),t.flag=e.u32(),t.expireTime=O(e),t.lockUpdateTime=O(e),e.bool()&&(t.unk1_10_0=e.bytes(9)),t.unk1_11=e.u8(),t.unk1_12=e.u8(),t.unk1_13=e.u32(),t.struct_560=Tu(e),t.unk1_15=e.u32()),t}function $o(e){let t=new p(e),a={};return a.itemDataList=t.array(t.u16(),()=>Eu(t),80),a.storageType=t.u8(),a}var Qo="PKTInitItem",Zt=9176;function vu(e){let t={};return e.bool()&&(t.unk1_0=e.bytes(9)),t.unk2=e.u32(),t.unk3=e.u32(),e.bool()&&(t.unk5_0=e.u32()),t.unk6=e.u32(),t}function Jo(e){let t=new p(e),a={};return a.struct_344=t.bytes(t.u16(),104,30),a.addonFeatureIdList=t.bytes(t.u16(),200,4),a.addonSkillFeatureList=t.array(t.u16(),()=>{let n={};return n.skillId=t.u32(),n.addonSkillFeatureIdList=t.array(t.u16(),()=>t.u32(),5),n},200),a.unk3=t.u8(),a.statusEffectDatas=t.array(t.u16(),()=>Z(t),80),a.struct_420=t.array(t.u16(),()=>vu(t),300),t.bool()&&(a.unk7_0=t.u32()),a.struct_135=t.bytes(t.u16(),353,48),a.unk9=t.u32(),a.unk10=t.u64(),a.unk11=t.u8(),a.abilityDataList=t.array(t.u16(),()=>Et(t),100),a.unk13=t.u8(),a.unk14=t.u64(),a.struct_226=t.bytes(t.u16(),3,17),a.statPair=t.array(t.u16(),()=>{let n={};return n.value=T(t),n.statType=t.u8(),n},153),a}var Xo="PKTInitLocal",Ht=24890;function tr(e){let t=new p(e),a={};return a.serverAddr=t.string(256),a.account_CharacterId1=t.u64(),a.unk2=t.u32(),a.account_CharacterId2=t.u64(),a}var er="PKTMigrationExecute",zt=1461;function xu(e){let t={};return t.lostArkString=e.string(20),t.unk1=e.u8(),t.lookData=e.bytes(e.u32(),512),t.unk3=e.u64(),t.unk4=e.u8(),t.equipItemDataList=e.array(e.u16(),()=>tt(e),33),t.unk6=e.u8(),t.unk7=e.u64(),t.unk8=e.u16(),t}function ea(e){let t={};return t.objectId=e.u64(),t.unk1=e.u8(),e.bool()&&(t.unk3_0=e.u8()),e.bool()&&(t.unk5_0=e.u32()),t.statusEffectDatas=e.array(e.u16(),()=>Z(e),80),e.bool()&&(t.unk8_0=e.u8()),e.bool()&&(t.balanceLevel=e.u16()),e.bool()&&(t.unk12_0=e.u8()),t.periodUpdateStatDataList=e.array(e.u16(),()=>vt(e),5),t.unk14=e.u8(),t.unk15=e.u8(),e.bool()&&(t.struct_730=xu(e)),e.bool()&&(t.unk19_0=e.u64()),e.bool()&&(t.struct_341=e.bytes(e.u16(),11,9)),t.typeId=e.u32(),e.bool()&&(t.unk24_0=e.u8()),e.bool()&&(t.unk26_0=e.u16()),t.unk27=e.u8(),e.bool()&&(t.unk29_0=e.u8()),e.bool()&&(t.transitIndex=e.u32()),e.bool()&&(t.unk33_0=e.u8()),t.unk34=e.u8(),e.bool()&&(t.unk36_0=e.u32()),t.statPair=e.array(e.u16(),()=>{let a={};return a.value=T(e),a.statType=e.u8(),a},153),t.level=e.u16(),t.directionYaw=F(e),t.position=y(e),e.bool()&&(t.struct_273=e.bytes(e.u16(),12,12)),e.bool()&&(t.unk44_0=e.u8()),t.spawnIndex=e.u32(),e.bool()&&(t.unk47_0=e.u32()),e.bool()&&(t.unk49_0=e.u32()),t.unk50=e.u8(),t}function ar(e){let t=new p(e),a={};return t.bool()&&(a.unk1_0=t.u8()),a.unk2=t.u8(),t.bool()&&(a.unk1_0_0=t.string(20),a.unk1_1=t.string(20)),t.bool()&&(a.unk5_0=t.u64()),a.npcStruct=ea(t),a}var nr="PKTNewNpc",Gt=59333;function ir(e){let t=new p(e),a={};return a.publishReason=t.u8(),a.npcData=ea(t),a.ownerId=t.u64(),t.skip(35),a}var or="PKTNewNpcSummon",Yt=47111;function Du(e){let t={};return e.bool()&&(t.unk1_0=e.bytes(12)),t.unk2=e.bytes(12),t.unk3=e.u32(),t.unk4=e.u32(),t}function yu(e){let t={};return t.unk45_m=e.u32(),t.periodUpdateStatDataList=e.array(e.u16(),()=>vt(e),5),t.statPair=e.array(e.u16(),()=>{let a={};return a.value=T(e),a.statType=e.u8(),a},153),t.maxItemLevel=e.f32(),t.characterId=e.u64(),e.bool()&&(t.grabbedData=e.bytes(12)),t.heading=F(e),t.unk1_m=e.u8(),t.name=e.string(20),t.statusEffectDatas=e.array(e.u16(),()=>Z(e),80),t.position=y(e),t.avgItemLevel=e.f32(),t.petId=e.u32(),t.unk25_m=e.u8(),t.unk4_m=e.u32(),t.unk2_m=e.u8(),t.equipItemDataList=e.array(e.u16(),()=>tt(e),33),t.unk17_m=e.u8(),t.equipLifeToolDataList=e.array(e.u16(),()=>tt(e),9),t.secondHonorTitleId=e.u16(),t.unk21=e.u64(),t.unk7_m=e.u32(),t.unk32_m=e.u8(),t.lookData=e.bytes(e.u32(),512),t.unk0_m=e.bytes(5),t.worldId=e.u8(),t.guildId=e.u64(),t.firstHonorTitleId=e.u16(),t.avatarHide=e.u8(),t.unk30=e.u32(),t.addonFeatureIdList=e.bytes(e.u16(),200,4),t.unk29_m=e.u8(),t.unk23_m=e.u8(),t.rvRLevel=e.u16(),t.unk35=e.u32(),t.guildName=e.string(20),t.addonSkillFeatureList=e.array(e.u16(),()=>{let a={};return a.skillId=e.u32(),a.addonSkillFeatureIdList=e.array(e.u16(),()=>e.u32(),5),a},200),t.unk38=e.u32(),t.unk5_m=e.u32(),t.unk40=e.u8(),t.unk41=e.u8(),t.unk42=e.u8(),t.classId=e.u16(),t.level=e.u16(),t.identityData=e.bytes(25),t.playerId=e.u64(),t}function rr(e){let t=new p(e),a={};return t.bool()&&(a.unk5_0_m=t.bytes(20)),t.bool()&&(a.unk3_0_m=t.u32()),t.bool()&&(a.trackMoveInfo=Du(t)),t.bool()&&(a.unk4_0_m=t.bytes(12)),t.bool()&&(a.struct_59=t.array(t.u16(),()=>{let n={};return n.itemTint=t.bytes(t.u16(),5,14),n.unk1_0_1=t.u32(),n.unk1_0_2=t.u64(),n},5)),a.unk2_m=t.u8(),a.pcStruct=yu(t),t.bool()&&(a.unk1_0=t.u32(),a.itemTint=t.bytes(t.u16(),5,14),a.unk1_2=t.u64()),a.unk0_m=t.u8(),a}var sr="PKTNewPC",$t=33762;function Ru(e){let t={};return t.unk0=e.u32(),t.unk1=e.u16(),e.bool()&&(t.unk3_0=e.u32()),t.unk4=e.u8(),t.targetObjectId=e.u64(),t.unk6=e.u32(),t.unk7=e.u64(),t.ownerId=e.u64(),t.chainSkillEffect=e.u32(),t.unk10=e.u8(),t.unk11=e.u64(),t.tripodLevel=Tt(e),t.skillId=e.u32(),t.projectileId=e.u64(),t.unk15=e.u16(),e.bool()&&(t.unk17_0=e.u64()),t.unk18=e.u32(),t.skillEffect=e.u32(),t.skillLevel=e.u8(),e.bool()&&(t.struct_341=e.bytes(e.u16(),11,9)),t.tripodIndex=It(e),t}function ur(e){let t=new p(e),a={};return a.projectileInfo=Ru(t),a}var fr="PKTNewProjectile",Qt=25491;function gu(e){let t={};return t.skillEffect=e.u32(),t.unk1=e.u8(),t.position=y(e),t.unk3=e.u8(),t.objectId=e.u64(),t.skillId=e.u32(),t.unk6=e.u32(),t.unk7=e.u8(),t.ownerId=e.u64(),t.unk9=e.u32(),e.bool()&&(t.struct_341=e.bytes(e.u16(),11,9)),t.unk12=e.u32(),t.unk13=e.u16(),t}function mr(e){let t=new p(e),a={};return a.unk0=t.u8(),a.trapData=gu(t),a.unk2=t.u8(),a}var lr="PKTNewTrap",Jt=59491;function cr(e){let t=new p(e),a={};return a.decreasePoint=t.u32(),a.hitCheckTime=t.u32(),a.noHitCheckTime=t.u32(),t.skip(1),a.objectId=t.u64(),a.paralyzationMaxPoint=t.u32(),t.skip(1),a.enable=t.bool(),a.paralyzationPoint=t.u32(),t.skip(1),a}var dr="PKTParalyzationStateNotify",Xt=33543;function Lu(e){let t={};return t.name=e.string(20),t.worldId=e.u8(),t.auths=e.u8(),t.position=y(e),t.zoneInstId=e.u64(),t.classId=e.u16(),t.unk6=e.u8(),t.transitIndex=e.u32(),t.unk8=e.u16(),t.unk9=e.u8(),t.unk10=e.u8(),t.unk11=e.u8(),t.maxHp=T(e),t.partyMemberNumber=e.u8(),t.gearLevel=e.f32(),t.unk15=e.u8(),t.curHp=T(e),t.characterId=e.u64(),t.zoneId=e.u32(),t.characterLevel=e.u16(),t}function pr(e){let t=new p(e),a={};return a.memberDatas=t.array(t.u16(),()=>Lu(t),40),a.partyLootType=t.u8(),a.lootGrade=t.u32(),a.partyType=t.u8(),a.raidInstanceId=t.u32(),a.partyInstanceId=t.u32(),a}var _r="PKTPartyInfo",te=59330;function br(e){let t=new p(e),a={};return a.name=t.string(20),a.partyInstanceId=t.u32(),a.partyLeaveType=t.u8(),a}var hr="PKTPartyLeaveResult",ee=43463;function Sr(e){let t=new p(e),a={};return a.objectId=t.u64(),a.unk0_m=t.u8(),a.passiveStatusEffectList=t.array(t.u16(),()=>t.u32(),10),a}var Pr="PKTPartyPassiveStatusEffectAddNotify",ae=47487;function kr(e){let t=new p(e),a={};return a.passiveStatusEffectList=t.array(t.u16(),()=>t.u32(),10),a.objectId=t.u64(),a}var Ir="PKTPartyPassiveStatusEffectRemoveNotify",ne=12028;function Tr(e){let t=new p(e),a={};return a.statusEffectDatas=t.array(t.u16(),()=>Z(t),80),a.playerIdOnRefresh=t.u64(),a.unk2=t.u8(),a.characterId=t.u64(),a.unk4=t.u64(),a}var Er="PKTPartyStatusEffectAddNotify",ie=25859;function vr(e){let t=new p(e),a={};return a.unk0=t.u64(),a.characterId=t.u64(),a.statusEffectIds=t.array(t.u16(),()=>t.u32(),80),a.reason=t.u8(),a}var xr="PKTPartyStatusEffectRemoveNotify",oe=20302;function Nr(e){let t=new p(e),a={};return t.skip(14),a.raidInstanceId=t.u32(),t.skip(13),a.characterId=t.u64(),t.skip(1),a.partyInstanceId=t.u32(),a}var Dr="PKTPartyStatusEffectResultNotify",re=16085;function yr(e){let t=new p(e),a={};return a.passiveStatusEffectList=t.array(t.u16(),()=>t.u32(),10),a}var Rr="PKTPassiveStatusEffectAddNotify",se=7138;function gr(e){let t=new p(e),a={};return a.passiveStatusEffectList=t.array(t.u16(),()=>t.u32(),10),a}var Lr="PKTPassiveStatusEffectRemoveNotify",ue=2648;function Ar(e){let t=new p(e),a={};return a.raidResult=t.u8(),a.totalTime=t.u64(),a.unk1_m=t.bool(),a.unk4_m=t.u64(),a.endTick=t.u64(),a.unk11_m=t.bool(),a.unk6_m=t.u64(),a.unk0_m=t.bool(),a.braveHeartCount=t.u8(),a.initBraveHeartCount=t.u8(),a.bossKillDataList=t.array(t.u16(),()=>ta(t),3),a.unk5_m=t.u64(),a.startTick=t.u64(),a.raidId=t.u32(),a}var Kr="PKTRaidBegin",fe=49450;function wr(e){let t=new p(e),a={};return a.unk0=t.bytes(6),a}var Br="PKTRaidBossKillNotify",me=20341;function Cr(e){let t=new p(e),a={};return a.struct_49=t.array(t.u16(),()=>{let n={};return n.unk1_0_0=T(t),n.unk1_0_1=t.u32(),n.unk1_0_2=T(t),n.struct_529=t.bytes(t.u16(),3),n},3),a.unk1=t.u64(),a.unk2=t.u64(),a.unk3=t.u8(),a.unk4=t.u8(),a.unk5=t.u64(),a.raidResult=t.u8(),a.unk7=t.u64(),a}var Mr="PKTRaidResult",le=23056;function Au(e){let t={};return t.unpublishReason=e.u8(),t.objectId=e.u64(),t}function jr(e){let t=new p(e),a={};return a.unpublishedObjects=t.array(t.u16(),()=>Au(t),200),a}var Or="PKTRemoveObject",ce=46115;function Fr(e){let t=new p(e),a={};return a.skillLevel=t.u8(),a.skillId=t.u32(),t.skip(2),a.caster=t.u64(),a}var qr="PKTSkillCastNotify",de=56741;function aa(e){let t={};return t.maxHp=T(e),t.curHp=T(e),e.bool()&&(t.damageAttr=e.u8()),t.damage=T(e),t.unk3_m=e.u16(),t.modifier=e.u8(),t.targetId=e.u64(),t.damageType=e.u8(),t}function wu(e){let t={};return t.unk2_m=e.u64(),t.skillDamageEvent=aa(e),t.unk8_m=e.u16(),t.destination=y(e),t.unk4_m=e.u16(),t.skillMoveOptionData=ze(e),t.unk1_m=e.u8(),t.unk3_m=e.u16(),t.position=y(e),t}function Wr(e){let t=new p(e),a={};return a.skillEffectId=t.u32(),a.skillDamageAbnormalMoveEvents=t.array(t.u16(),()=>wu(t),50),a.unk1_m=t.u8(),a.unk2_m=t.u32(),a.skillId=t.u32(),a.sourceId=t.u64(),a}var Ur="PKTSkillDamageAbnormalMoveNotify",pe=42318;function Vr(e){let t=new p(e),a={};return t.bool()&&(a.unk1_0=t.u32()),a.sourceId=t.u64(),a.skillLevel=t.u8(),t.bool()&&(a.skillEffectId=t.u32()),a.skillId=t.u32(),a.skillDamageEvents=t.array(t.u16(),()=>aa(t),50),a}var Zr="PKTSkillDamageNotify",_e=20086;function Hr(e){let t=new p(e),a={};return t.skip(8),a.skillId=t.u32(),a.sourceId=t.u64(),t.skip(6),a.stage=t.u8(),t.skip(25),a}var zr="PKTSkillStageNotify",be=30803;function Gr(e){let t=new p(e),a={};return a.aimTargetPosition=y(t),a.curPosition=y(t),a.sourceId=t.u64(),a.skillLevel=t.u8(),a.skillOptionData=$e(t),t.bool()&&(a.aiStateId=t.u32()),a.curDirectionYaw=F(t),t.bool()&&(a.unk1_m=t.u32()),a.newPosition=y(t),a.skillId=t.u32(),t.bool()&&(a.pitchRotation=F(t)),a.newDirectionYaw=F(t),a}var Yr="PKTSkillStartNotify",he=110;function $r(e){let t=new p(e),a={};return a.statPairList=t.array(t.u16(),()=>{let n={};return n.value=T(t),n.statType=t.u8(),n},153),a.objectId=t.u64(),t.bool()&&(a.unk3_0=t.u32()),a.unk4=t.array(t.u16(),()=>{let n={};return n.value=T(t),n.statType=t.u8(),n},153),a.unk5=t.u8(),a}var Qr="PKTStatChangeOriginNotify",Jr=2349;function Xr(e){let t=new p(e),a={};return t.bool()&&(a.unk1_0=t.u64()),a.new=t.bool(),a.statusEffectData=Z(t),a.objectId=t.u64(),a.unk5=t.u64(),a}var ts="PKTStatusEffectAddNotify",Se=33978;function es(e){let t=new p(e),a={};return a.reason=t.u8(),a.objectId=t.u64(),a.statusEffectIds=t.array(t.u16(),()=>t.u32(),80),a}var as="PKTStatusEffectRemoveNotify",Pe=22672;function ns(e){let t=new p(e),a={};return a.effectInstanceId=t.u32(),t.skip(1),a.expirationTick=t.u64(),a.targetId=t.u64(),t.skip(1),a}var is="PKTStatusEffectDurationNotify",ke=19054;function os(e){let t=new p(e),a={};return t.skip(2),a.effectInstanceId=t.u32(),a.characterId=t.u64(),a.value=t.u32(),t.skip(4),a.objectId=t.u64(),a}var rs="PKTStatusEffectSyncDataNotify",Ie=33630;function ss(e){let t=new p(e),a={};return a.triggerId=t.u32(),a.step=t.u32(),t.skip(2),a.unk2_m=t.bool(),a}var us="PKTTriggerBossBattleStatus",Te=6420;function fs(e){let t=new p(e),a={};return a.unk0_m=t.u32(),a.packetResultCode=t.u32(),a.triggerId=t.u32(),a.involvedPCs=t.array(t.u16(),()=>t.u64(),40),a}var ms="PKTTriggerFinishNotify",Ee=38704;function ls(e){let t=new p(e),a={};return a.sourceId=t.u64(),a.triggerSignalType=t.u32(),a.involvedPCs=t.array(t.u16(),()=>t.u64(),40),a.triggerId=t.u32(),a}var cs="PKTTriggerStartNotify",ve=20231;function ds(e){let t=new p(e),a={};return a.unk0_m=t.u32(),a.characterId=t.u64(),a.maxHp=T(t),a.curHp=T(t),a.position=t.u64(),a.statusEffectDatas=t.array(t.u16(),()=>Z(t),80),a}var ps="PKTTroopMemberUpdateMinNotify",xe=44092;function _s(e){let t=new p(e),a={};return a.playerId=t.u64(),a.identityGauge1=t.u32(),a.identityGauge2=t.u32(),a.identityGauge3=t.u32(),t.skip(2),a}var bs="PKTIdentityGaugeChangeNotify",Ne=19646;function hs(e){let t=new p(e),a={};return a.totalMembers=t.array(t.u16(),()=>t.u64(),40),a.zoneInstId=t.u64(),a.loadComplete=t.bool(),a.completeMembers=t.array(t.u16(),()=>t.u64(),40),a.zoneId=t.u32(),a.zoneLevel=t.u8(),a.firstPCEnterTick=t.u64(),a}var Ss="PKTZoneMemberLoadStatusNotify",De=14585;function Ps(e){let t=new p(e),a={};return t.skip(1),a.objectId=t.u64(),t.skip(1),a}var ks="PKTZoneObjectUnpublishNotify",ye=43137;function Bu(e){let t={};return t.instanceId=e.u32(),e.skip(4),t.stackCount=e.u8(),t.id=e.u32(),t.target=e.u8(),t}function Is(e){let t=new p(e),a={};return a.zoneStatusEffectDataList=t.array(t.u16(),()=>Bu(t),4),a}var Ts="PKTZoneStatusEffectAddNotify",Re=7747;function Es(e){let t=new p(e),a={};return t.skip(3),a.statusEffectId=t.u32(),a}var vs="PKTZoneStatusEffectRemoveNotify",ge=35401;var xs=new Map([[Kt,[Eo,To]],[wt,[xo,vo]],[Bt,[Do,No]],[go,[Ro,yo]],[Ct,[Ao,Lo]],[Mt,[wo,Ko]],[jt,[Co,Bo]],[Ot,[jo,Mo]],[Ft,[Fo,Oo]],[qt,[Wo,qo]],[Wt,[Vo,Uo]],[Ut,[Ho,Zo]],[Vt,[Yo,Go]],[Zt,[Qo,$o]],[Ht,[Xo,Jo]],[zt,[er,tr]],[Gt,[nr,ar]],[Yt,[or,ir]],[$t,[sr,rr]],[Qt,[fr,ur]],[Jt,[lr,mr]],[Xt,[dr,cr]],[te,[_r,pr]],[ee,[hr,br]],[ae,[Pr,Sr]],[ne,[Ir,kr]],[ie,[Er,Tr]],[oe,[xr,vr]],[re,[Dr,Nr]],[se,[Rr,yr]],[ue,[Lr,gr]],[fe,[Kr,Ar]],[me,[Br,wr]],[le,[Mr,Cr]],[ce,[Or,jr]],[de,[qr,Fr]],[pe,[Ur,Wr]],[_e,[Zr,Vr]],[be,[zr,Hr]],[he,[Yr,Gr]],[Jr,[Qr,$r]],[Se,[ts,Xr]],[Pe,[as,es]],[ke,[is,ns]],[Ie,[rs,os]],[Te,[us,ss]],[Ee,[ms,fs]],[ve,[cs,ls]],[xe,[ps,ds]],[Ne,[bs,_s]],[De,[Ss,hs]],[ye,[ks,Ps]],[Re,[Ts,Is]],[ge,[vs,Es]]]);var Mu=new Map([[Kt,[0]],[wt,[1]],[Bt,[2]],[Ct,[4]],[Mt,[5]],[jt,[6]],[Wt,[7]],[Ut,[8]],[Vt,[9]],[Ht,[10]],[zt,[11]],[Gt,[12]],[Yt,[13]],[$t,[14]],[Qt,[15]],[Xt,[16]],[te,[17]],[ee,[18]],[ae,[19]],[ne,[20]],[ie,[21]],[oe,[22]],[re,[23]],[se,[24]],[ue,[25]],[me,[26]],[le,[27]],[ce,[28]],[pe,[29]],[_e,[30]],[be,[31]],[he,[32]],[Se,[34]],[Pe,[35]],[ke,[36]],[Ie,[37]],[Te,[38]],[Ee,[39]],[ve,[40]],[xe,[41]],[Ne,[42]],[ye,[43]],[Re,[44]],[ge,[45]],[de,[46]],[qt,[47]],[Ot,[48]],[Ft,[49]],[Zt,[50]],[fe,[52]],[De,[51]],[Jt,[53]]]);var Uf=require("tiny-typed-emitter");var na=class{#t;#n;#r;#i;#a;#e;constructor(t,a,n,r,o,i){this.#t=t,this.#n=a,this.#r=n,this.#i=r,this.#a=o,this.#e=i}#o;get parsed(){if(!this.#o)try{this.#o=this.#e(this.#a.decrypt(this.#t,this.#n,this.#r,this.#i))}catch(t){console.error(`[meter-core/pkt-stream] - ${t}`);return}return this.#o}};var Ou=require("fs");var Ns=class extends ju.TypedEmitter{},ia=class extends Ns{#t;#n;constructor(t,a,n){super(),this.#t=a,n&&(this.#n=(0,Ou.createWriteStream)(n,{highWaterMark:0}));let r=Buffer.allocUnsafe(la);r.writeUIntLE(3,0,la),this.#n?.write(r),t.on("*",this.handlePkt.bind(this))}handlePkt(t,a,n,r){try{let o=xs.get(a),i=Mu.get(a);if(o&&i){let[f]=i,[c,l]=o,S=Qe.get(f);if(S){let[b,I,H]=S,K=new na(Buffer.from(t),a,n,!!r,this.#t,l).parsed;if(!K)return;let $=new at(K,f,H);this.emit(b,$),this.emit("*",b,$),this.appendLog($)}}}catch(o){console.error(o)}}appendLog(t){this.#n&&t.serialized&&this.#n.write(t.serialized)}};var oa=class{characterIdToPartyId;entityIdToPartyId;raidInstanceToPartyInstances;ownName;characterNameToCharacterId;#t;constructor(t){this.characterIdToPartyId=new Map,this.entityIdToPartyId=new Map,this.raidInstanceToPartyInstances=new Map,this.characterNameToCharacterId=new Map,this.#t=t}add(t,a,n=void 0,r=void 0,o=void 0){!n&&!r||(n&&!r&&(r=this.#t.getEntityId(n)),r&&!n&&(n=this.#t.getEntityId(r)),n&&this.characterIdToPartyId.set(n,a),r&&this.entityIdToPartyId.set(r,a),o&&n&&this.characterNameToCharacterId.set(o,n),this.registerPartyId(t,a))}completeEntry(t,a){let n=this.getPartyIdFromCharacterId(t),r=this.getPartyIdFromEntityId(a);n&&r||(!n&&r&&this.characterIdToPartyId.set(t,r),!r&&n&&this.entityIdToPartyId.set(a,n))}changeEntityId(t,a){let n=this.getPartyIdFromEntityId(t);n&&(this.entityIdToPartyId.delete(t),this.entityIdToPartyId.set(a,n))}setOwnName(t){this.ownName=t}remove(t,a){if(a===this.ownName){this.removePartyMappings(t);return}let n=this.characterNameToCharacterId.get(a);if(this.characterNameToCharacterId.delete(a),!n)return;this.characterIdToPartyId.delete(n);let r=this.#t.getEntityId(n);r&&this.characterIdToPartyId.delete(r)}isCharacterInParty(t){return this.characterIdToPartyId.has(t)}isEntityInParty(t){return this.entityIdToPartyId.has(t)}getPartyIdFromCharacterId(t){return this.characterIdToPartyId.get(t)}getPartyIdFromEntityId(t){return this.entityIdToPartyId.get(t)}removePartyMappings(t){let a=this.getRaidInstanceId(t),n=a?this.raidInstanceToPartyInstances.get(a)??new Set([t]):new Set([t]);for(let[r,o]of this.characterIdToPartyId)if(n.has(o)){this.characterIdToPartyId.delete(r);for(let[i,f]of this.characterNameToCharacterId)if(r===f){this.characterNameToCharacterId.delete(i);break}}for(let[r,o]of this.entityIdToPartyId)n.has(o)&&this.entityIdToPartyId.delete(r)}getRaidInstanceId(t){for(let a of this.raidInstanceToPartyInstances)if(a[1].has(t))return a[0]}registerPartyId(t,a){let n=this.raidInstanceToPartyInstances.get(t);n||(n=new Set,this.raidInstanceToPartyInstances.set(t,n)),n.add(a)}partyInfo(t,a,n){let r=t.parsed;if(r){if(r.memberDatas.length===1&&r.memberDatas[0]?.name===n.name){this.remove(r.partyInstanceId,r.memberDatas[0].name);return}this.removePartyMappings(r.partyInstanceId);for(let o of r.memberDatas){o.characterId===n.characterId&&this.setOwnName(o.name);let i=this.#t.getEntityId(o.characterId);if(i){let f=a.get(i);if(f&&f.entityType===1&&f.name!==o.name){let c=f;c.gearLevel=o.gearLevel,c.name=o.name,c.class=o.classId}}this.add(r.raidInstanceId,r.partyInstanceId,o.characterId,i,o.name)}}}};var ra=class{entityToCharacterId;characterToEntityId;constructor(){this.entityToCharacterId=new Map,this.characterToEntityId=new Map}addMapping(t,a){this.entityToCharacterId.set(a,t),this.characterToEntityId.set(t,a)}getCharacterId(t){return this.entityToCharacterId.get(t)}getEntityId(t){return this.characterToEntityId.get(t)}clear(){this.entityToCharacterId.clear(),this.characterToEntityId.clear()}};var Ds=class extends qu.TypedEmitter{#t;#n;#r;#i;#a;#e;#o;#s;#u;#f;constructor(t,a,n,r){super(),this.#t=t,this.#n=a,this.#r=new ra,this.#i=new oa(this.#r),this.#a=new Dt(this.#i,this.#n,r.isLive??!0),this.#e=new qe(this.#r,this.#i,this.#a,this.#n),this.#s=new Lt(this.#e,n,Fu(this.#t,r.isLive)?this.#t:void 0),this.#o=new Je(this.#e,this.#a,this.#s,this.#n,r),this.#o.emit=this.emit.bind(this),this.#u=!1,this.#f=!1,this.#o.options.isLive&&setInterval(this.broadcastStateChange.bind(this),100),this.#t.on("APP_StatApi",o=>{let i=o.parsed;i&&this.#s.updatePlayerStats(i.players)}).on("AbilityChangeNotify",o=>{}).on("ActiveAbilityNotify",o=>{}).on("AddonSkillFeatureChangeNotify",o=>{}).on("BlockSkillStateNotify",o=>{}).on("CounterAttackNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.entities.get(i.sourceId);f&&this.#o.onCounterAttack(f,o.time)}).on("DeathNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.entities.get(i.targetId);f&&this.#o.onDeath(f,o.time)}).on("EquipChangeNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.entities.get(i.objectId);if(!f||f.entityType!==1)return;f.itemSet=this.#e.getPlayerSetOptions(i.equipItemDataList);let c=[];i.equipItemDataList.forEach(l=>{l.id!==void 0&&l.slot!==void 0&&c.push({id:l.id,slot:l.slot})}),f.items.equipList=c}).on("EquipLifeToolChangeNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.entities.get(i.objectId);if(!f||f.entityType!==1)return;let c=[];i.equipLifeToolDataList.forEach(l=>{l.id!==void 0&&l.slot!==void 0&&c.push({id:l.id,slot:l.slot})}),f.items.lifeToolList=c}).on("IdentityStanceChangeNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.entities.get(i.objectId);f&&f.entityType===1&&(f.stance=i.stance)}).on("IdentityGaugeChangeNotify",o=>{}).on("InitAbility",o=>{}).on("InitEnv",o=>{this.#e.processInitEnv(o),this.#o.onInitEnv(o,o.time)}).on("InitLocal",o=>{}).on("InitPC",o=>{let i=this.#e.processInitPC(o);if(i&&o.parsed){let f=this.#n.getStatPairMap(o.parsed.statPair);this.#o.updateOrCreateEntity(i,{id:i.entityId.toString(16),name:i.name,classId:i.class,isPlayer:!0,gearScore:i.gearLevel,currentHp:Number(f.get(1))||0,maxHp:Number(f.get(27))||0},o.time)}}).on("InitItem",o=>{let i=o.parsed;if(i){if(i.storageType===1){this.#e.localPlayer.itemSet=this.#e.getPlayerSetOptions(i.itemDataList);let f=[];i.itemDataList.forEach(c=>{c.id!==void 0&&c.slot!==void 0&&f.push({id:c.id,slot:c.slot})}),this.#e.localPlayer.items.equipList=f}else if(i.storageType===21){let f=[];i.itemDataList.forEach(c=>{c.id!==void 0&&c.slot!==void 0&&f.push({id:c.id,slot:c.slot})}),this.#e.localPlayer.items.lifeToolList=f}}}).on("MigrationExecute",o=>{this.#s.zoneSyncStatus=0;let i=o.parsed;i&&(this.#e.localPlayer.characterId===0n&&(this.#e.localPlayer.characterId=i.account_CharacterId1<i.account_CharacterId2?i.account_CharacterId1:i.account_CharacterId2),this.#s.ip=o.parsed.serverAddr.split(":")[0])}).on("NewNpc",o=>{let i=this.#e.processNewNpc(o);if(i&&o.parsed){let f=this.#n.getStatPairMap(o.parsed.npcStruct.statPair);this.#o.updateOrCreateEntity(i,{id:i.entityId.toString(16),name:i.name,npcId:i.typeId,isPlayer:!1,isBoss:i.isBoss,currentHp:Number(f.get(1))||0,maxHp:Number(f.get(27))||0},o.time)}}).on("NewNpcSummon",o=>{let i=this.#e.processNewNpcSummon(o);if(i&&o.parsed){let f=this.#n.getStatPairMap(o.parsed.npcData.statPair);this.#o.updateOrCreateEntity(i,{id:i.entityId.toString(16),name:i.name,npcId:i.typeId,isPlayer:!1,isBoss:i.isBoss,currentHp:Number(f.get(1))||0,maxHp:Number(f.get(27))||0},o.time)}}).on("NewPC",o=>{let i=this.#e.processNewPC(o);if(i&&o.parsed){let f=this.#n.getStatPairMap(o.parsed.pcStruct.statPair);this.#o.updateOrCreateEntity(i,{id:i.entityId.toString(16),name:i.name,classId:i.class,isPlayer:!0,gearScore:i.gearLevel,currentHp:Number(f.get(1))||0,maxHp:Number(f.get(27))||0},o.time)}}).on("NewProjectile",o=>{let i=o.parsed;if(!i)return;let f={entityId:i.projectileInfo.projectileId,entityType:5,name:i.projectileInfo.projectileId.toString(16),ownerId:i.projectileInfo.ownerId,skillEffectId:i.projectileInfo.skillEffect,skillId:i.projectileInfo.skillId,stats:new Map};this.#e.entities.set(f.entityId,f)}).on("NewTrap",o=>{let i=o.parsed;if(!i)return;let f={entityId:i.trapData.objectId,entityType:5,name:i.trapData.objectId.toString(16),ownerId:i.trapData.ownerId,skillEffectId:i.trapData.skillEffect,skillId:i.trapData.skillId,stats:new Map};this.#e.entities.set(f.entityId,f)}).on("ParalyzationStateNotify",o=>{}).on("PartyInfo",o=>{this.#i.partyInfo(o,this.#e.entities,this.#e.localPlayer)}).on("PartyLeaveResult",o=>{let i=o.parsed;i&&this.#i.remove(i.partyInstanceId,i.name)}).on("PartyPassiveStatusEffectAddNotify",o=>{}).on("PartyPassiveStatusEffectRemoveNotify",o=>{}).on("PartyStatusEffectAddNotify",o=>{let i=o.parsed;if(i)for(let f of i.statusEffectDatas){let c=i.playerIdOnRefresh!==0n?i.playerIdOnRefresh:f.sourceId,l=this.#e.getSourceEntity(c);this.#a.RegisterStatusEffect(this.#a.buildStatusEffect(f,i.characterId,l.entityId,0,o.time))}}).on("PartyStatusEffectRemoveNotify",o=>{let i=o.parsed;if(i)for(let f of i.statusEffectIds){let c=this.#a.RemoveStatusEffect(i.characterId,f,0,i.reason,o.time);c&&c.statusEffectId===9701&&this.#s.syncData()}}).on("PartyStatusEffectResultNotify",o=>{let i=o.parsed;i&&this.#i.add(i.raidInstanceId,i.partyInstanceId,i.characterId)}).on("PassiveStatusEffectAddNotify",o=>{}).on("PassiveStatusEffectRemoveNotify",o=>{}).on("RaidBegin",o=>{let i=o.parsed;i&&(this.#n.statQueryFilter.raid.has(i.raidId)?this.#s.zoneSyncStatus|=16:this.#s.zoneSyncStatus|=8)}).on("ZoneMemberLoadStatusNotify",o=>{let i=o.parsed;i&&(this.#o.setZoneLevel(i.zoneLevel),this.#n.statQueryFilter.zone.has(i.zoneId)&&i.zoneLevel<=1?this.#s.zoneSyncStatus|=4:this.#s.zoneSyncStatus|=2)}).on("RaidBossKillNotify",o=>{this.#o.setKillState(1),this.#o.onPhaseTransition(1,o.time)}).on("RaidResult",o=>{o.parsed?.raidResult===1&&this.#o.setKillState(1),this.#o.onPhaseTransition(0,o.time)}).on("RemoveObject",o=>{let i=o.parsed;if(i)for(let f of i.unpublishedObjects)this.#a.RemoveLocalObject(f.objectId,o.time)}).on("SkillCastNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.getSourceEntity(i.caster);f=this.#e.guessIsPlayer(f,i.skillId),this.#o.onStartSkill(f,i.skillId,o.time)}).on("SkillDamageAbnormalMoveNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.getSourceEntity(i.sourceId);i.skillDamageAbnormalMoveEvents.forEach(c=>{let l=this.#e.getOrCreateEntity(c.skillDamageEvent.targetId),S=this.#e.getOrCreateEntity(i.sourceId);l.stats.set(1,c.skillDamageEvent.curHp),l.stats.set(27,c.skillDamageEvent.maxHp),this.#o.onDamage(f,S,l,{skillId:i.skillId,skillEffectId:i.skillEffectId,damage:Number(c.skillDamageEvent.damage),modifier:c.skillDamageEvent.modifier,targetCurHp:Number(c.skillDamageEvent.curHp),targetMaxHp:Number(c.skillDamageEvent.maxHp),damageAttr:c.skillDamageEvent.damageAttr??0,damageType:c.skillDamageEvent.damageType},i.skillDamageAbnormalMoveEvents.length,o.time)})}).on("SkillDamageNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.getSourceEntity(i.sourceId);i.skillDamageEvents.forEach(c=>{let l=this.#e.getOrCreateEntity(c.targetId),S=this.#e.getOrCreateEntity(i.sourceId);this.#o.onDamage(f,S,l,{skillId:i.skillId,skillEffectId:i.skillEffectId??0,damage:Number(c.damage),modifier:c.modifier,targetCurHp:Number(c.curHp),targetMaxHp:Number(c.maxHp),damageAttr:c.damageAttr??0,damageType:c.damageType},i.skillDamageEvents.length,o.time)})}).on("SkillStageNotify",o=>{}).on("SkillStartNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.getSourceEntity(i.sourceId);if(f=this.#e.guessIsPlayer(f,i.skillId),f.entityType===1){let c=f,l=c.skills.get(i.skillId);if(l||(l={effects:new Set,tripods:new Map},c.skills.set(i.skillId,l)),l.level=i.skillLevel,i.skillOptionData.tripodIndex&&i.skillOptionData.tripodLevel){l.tripods||(l.tripods=new Map);for(let[S,b]of["first","second","third"].entries()){if(i.skillOptionData.tripodIndex[b]===0){for(let C=1;C<=3;C++)l.tripods.delete(3*S+C);continue}let I=3*S+i.skillOptionData.tripodIndex[b],H=i.skillOptionData.tripodLevel[b],L=l.tripods.get(I);if(L&&H===L.level)continue;for(let C=1;C<=3;C++)l.tripods.delete(3*S+C);let K=this.#n.skillFeature.get(i.skillId)?.get(I),$=[];K&&K.entries.forEach(C=>{C.level!==0&&C.level!==H||$.push(C)}),l.tripods.set(I,{level:i.skillOptionData.tripodLevel[b],options:$.sort((C,Le)=>Le.level-C.level)})}}}this.#o.onStartSkill(f,i.skillId,o.time)}).on("StatusEffectAddNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.getSourceEntity(i.statusEffectData.sourceId);this.#a.RegisterStatusEffect(this.#a.buildStatusEffect(i.statusEffectData,i.objectId,f.entityId,1,o.time))}).on("StatusEffectDurationNotify",o=>{let i=o.parsed;i&&this.#a.UpdateDuration(i.effectInstanceId,i.targetId,i.expirationTick,1)}).on("StatusEffectRemoveNotify",o=>{let i=o.parsed;if(i)for(let f of i.statusEffectIds){let c=this.#a.RemoveStatusEffect(i.objectId,f,1,i.reason,o.time);c&&c.statusEffectId===9701&&this.#s.syncData()}}).on("StatusEffectSyncDataNotify",o=>{let i=o.parsed;i&&this.#a.SyncStatusEffect(i.effectInstanceId,i.characterId,i.objectId,i.value,this.#e.localPlayer.characterId)}).on("TriggerBossBattleStatus",o=>{this.#o.onPhaseTransition(2,o.time)}).on("TriggerFinishNotify",o=>{}).on("TriggerStartNotify",o=>{let i=o.parsed;if(i)switch(i.triggerSignalType){case 57:case 59:case 61:case 63:case 74:case 76:this.#o.setKillState(1);break;case 58:case 60:case 62:case 64:case 75:case 77:this.#o.setKillState(0);break;case 27:case 10:case 11:this.#s.syncData()}}).on("TroopMemberUpdateMinNotify",o=>{}).on("ZoneObjectUnpublishNotify",o=>{let i=o.parsed;i&&this.#a.RemoveLocalObject(i.objectId,o.time)}).on("ZoneStatusEffectAddNotify",o=>{}).on("TroopMemberUpdateMinNotify",o=>{let i=o.parsed;if(i&&i.statusEffectDatas.length>0)for(let f of i.statusEffectDatas){let c=this.#r.getEntityId(i.characterId),l=f.value?f.value.readUInt32LE():0,S=f.value?f.value.readUInt32LE(8):0,b=l<S?l:S;this.#a.SyncStatusEffect(f.effectInstanceId,i.characterId,c,b,this.#e.localPlayer.characterId)}}).on("ZoneStatusEffectRemoveNotify",o=>{}),this.#a.on("shieldApplied",o=>{let i=o.targetId;if(o.type===0&&(i=this.#r.getEntityId(o.targetId)??i),i===void 0)return;let f=this.#e.getSourceEntity(o.sourceId),c=this.#e.getOrCreateEntity(i);this.#o.onShieldApplied(c,f,o.statusEffectId,o.value)}).on("shieldChanged",(o,i,f)=>{let c=o.targetId;if(o.type===0&&(c=this.#r.getEntityId(o.targetId)??c),c===void 0)return;let l=this.#e.getSourceEntity(o.sourceId),S=this.#e.getOrCreateEntity(c);this.#o.onShieldUsed(S,l,o.statusEffectId,i-f)})}broadcastStateChange(){this.emit("state-change",this.#o.getBroadcast())}reset(){this.#o.resetState(+new Date)}cancelReset(){this.#o.cancelReset()}updateOptions(t){this.#o.updateOptions(t)}onConnect(t){this.#s.ip||(this.#s.ip=t.split(":")[0],Fu(this.#t,this.#o.options.isLive)&&this.#t.appendLog(new at({account_CharacterId1:0n,serverAddr:t,account_CharacterId2:0n},11,gt)))}get encounters(){return this.#o.splitEncounter(new Date),this.#o.encounters}};function Fu(e,t){return e instanceof ia||e.appendLog&&t}0&&(module.exports={Parser});
