var Wu=Object.create;var Nt=Object.defineProperty;var Uu=Object.getOwnPropertyDescriptor;var Vu=Object.getOwnPropertyNames;var Zu=Object.getPrototypeOf,Hu=Object.prototype.hasOwnProperty;var zu=(e,t,a)=>t in e?Nt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var Gu=(e,t)=>{for(var a in t)Nt(e,a,{get:t[a],enumerable:!0})},Rs=(e,t,a,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Vu(t))!Hu.call(e,r)&&r!==a&&Nt(e,r,{get:()=>t[r],enumerable:!(n=Uu(t,r))||n.enumerable});return e};var Yu=(e,t,a)=>(a=e!=null?Wu(Zu(e)):{},Rs(t||!e||!e.__esModule?Nt(a,"default",{value:e,enumerable:!0}):a,e)),$u=e=>Rs(Nt({},"__esModule",{value:!0}),e);var G=(e,t,a)=>(zu(e,typeof t!="symbol"?t+"":t,a),a),ra=(e,t,a)=>{if(!t.has(e))throw TypeError("Cannot "+a)};var D=(e,t,a)=>(ra(e,t,"read from private field"),a?a.call(e):t.get(e)),$=(e,t,a)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,a)},et=(e,t,a,n)=>(ra(e,t,"write to private field"),n?n.call(e,a):t.set(e,a),a);var _t=(e,t,a)=>(ra(e,t,"access private method"),a);var Uf={};Gu(Uf,{Parser:()=>Ns});module.exports=$u(Uf);var Fu=require("tiny-typed-emitter");var ot=(m=>(m[m.none=0]="none",m[m.slot=1]="slot",m[m.stat=2]="stat",m[m.ability_point=3]="ability_point",m[m.combat_effect=4]="combat_effect",m[m.skill_damage=5]="skill_damage",m[m.skill_critical_ratio=6]="skill_critical_ratio",m[m.skill_critical_damage=7]="skill_critical_damage",m[m.skill_penetration=8]="skill_penetration",m[m.npc_grade_less_damage=9]="npc_grade_less_damage",m[m.npc_grade_less_critical_ratio=10]="npc_grade_less_critical_ratio",m[m.npc_grade_less_critical_damage=11]="npc_grade_less_critical_damage",m[m.npc_grade_less_penetration=12]="npc_grade_less_penetration",m[m.npc_grade_greater_damage=13]="npc_grade_greater_damage",m[m.npc_grade_greater_critical_ratio=14]="npc_grade_greater_critical_ratio",m[m.npc_grade_greater_critical_damage=15]="npc_grade_greater_critical_damage",m[m.npc_grade_greater_penetration=16]="npc_grade_greater_penetration",m[m.npc_species_damage=17]="npc_species_damage",m[m.npc_species_critical_ratio=18]="npc_species_critical_ratio",m[m.npc_species_critical_damage=19]="npc_species_critical_damage",m[m.npc_species_penetration=20]="npc_species_penetration",m[m.npc_attr_damage=21]="npc_attr_damage",m[m.npc_attr_critical_ratio=22]="npc_attr_critical_ratio",m[m.npc_attr_critical_damage=23]="npc_attr_critical_damage",m[m.npc_attr_penetration=24]="npc_attr_penetration",m[m.mana_reduction=25]="mana_reduction",m[m.skill_mana_reduction=26]="skill_mana_reduction",m[m.skill_cooldown_reduction=27]="skill_cooldown_reduction",m[m.ability_feature=28]="ability_feature",m[m.class_option=29]="class_option",m[m.ability_point_passive=30]="ability_point_passive",m[m.instrument=31]="instrument",m[m.skill_feature=32]="skill_feature",m[m.npc_adaptation=33]="npc_adaptation",m[m.skill_group_damage=34]="skill_group_damage",m[m.skill_group_cooldown_reduction=35]="skill_group_cooldown_reduction",m[m.skill_level=36]="skill_level",m[m.skill_feature_level=37]="skill_feature_level",m[m.life_casting_speed=38]="life_casting_speed",m[m.life_casting_tier=39]="life_casting_tier",m[m.life_bonus_type_success=40]="life_bonus_type_success",m[m.life_bonus_type_extra=41]="life_bonus_type_extra",m[m.life_bonus_type_skill_bonus=42]="life_bonus_type_skill_bonus",m[m.life_bonus_type_minigame_perfect=43]="life_bonus_type_minigame_perfect",m[m.life_durability_bonus=44]="life_durability_bonus",m[m.life_mini_game_difficulty=45]="life_mini_game_difficulty",m[m.combat_effect_cooldown_reduction=46]="combat_effect_cooldown_reduction",m[m.skill_damage_addend=47]="skill_damage_addend",m[m.awakening_usable_count_addend=48]="awakening_usable_count_addend",m[m.battle_item_heal=49]="battle_item_heal",m[m.party_heal=50]="party_heal",m[m.party_shield=51]="party_shield",m[m.identity_gauge=52]="identity_gauge",m[m.attack_power_amplify_addend=53]="attack_power_amplify_addend",m[m.attack_power_amplify_multiplier=54]="attack_power_amplify_multiplier",m[m.not_in_party_damage=55]="not_in_party_damage",m[m.skill_effect_group_set_damage=56]="skill_effect_group_set_damage",m))(ot||{});var Be=(P=>(P[P.none=0]="none",P[P.modify_damage=1]="modify_damage",P[P.modify_final_damage=2]="modify_final_damage",P[P.modify_critical_ratio=3]="modify_critical_ratio",P[P.modify_critical_multiplier=4]="modify_critical_multiplier",P[P.modify_penetration=5]="modify_penetration",P[P.modify_penetration_when_critical=6]="modify_penetration_when_critical",P[P.exec_active_effect_when_damage=7]="exec_active_effect_when_damage",P[P.exec_active_effect_when_critical=8]="exec_active_effect_when_critical",P[P.exec_reactive_effect_when_miss=9]="exec_reactive_effect_when_miss",P[P.exec_reactive_effect_when_damage=10]="exec_reactive_effect_when_damage",P[P.exec_reactive_effect_when_critical=11]="exec_reactive_effect_when_critical",P[P.exec_after_effect=12]="exec_after_effect",P[P.exec_after_skill=13]="exec_after_skill",P[P.apply_heal=14]="apply_heal",P[P.modify_reactive_damage=15]="modify_reactive_damage",P[P.modify_damage_shield_multiplier=16]="modify_damage_shield_multiplier",P[P.exec_active_effect_when_kill=17]="exec_active_effect_when_kill",P[P.exec_start_skill=18]="exec_start_skill",P[P.modify_penetration_addend=19]="modify_penetration_addend",P[P.modify_penetration_addend_when_critical=20]="modify_penetration_addend_when_critical",P[P.modify_reactive_critical_multiplier=21]="modify_reactive_critical_multiplier",P[P.modify_damage_when_critical=22]="modify_damage_when_critical",P[P.modify_paralyzation_point=23]="modify_paralyzation_point",P[P.exec_when_counter=24]="exec_when_counter",P[P.exec_when_be_killed=25]="exec_when_be_killed",P))(Be||{});var sa=(b=>(b[b.none=0]="none",b[b.underling=1]="underling",b[b.normal=2]="normal",b[b.elite=3]="elite",b[b.named=4]="named",b[b.seed=5]="seed",b[b.boss=6]="boss",b[b.raid=7]="raid",b[b.lucky=8]="lucky",b[b.epic_raid=9]="epic_raid",b[b.commander=10]="commander",b))(sa||{});var Ce=(a=>(a[a.absolute=0]="absolute",a[a.relative=1]="relative",a))(Ce||{});var Me=(u=>(u[u.none=0]="none",u[u.enable_notify=1]="enable_notify",u[u.enable_dir_change=2]="enable_dir_change",u[u.change_move_dist=3]="change_move_dist",u[u.change_layer=4]="change_layer",u[u.change_stage_speed=5]="change_stage_speed",u[u.change_stage_collision=6]="change_stage_collision",u[u.change_max_target=7]="change_max_target",u[u.change_area_range=8]="change_area_range",u[u.change_area_angle=9]="change_area_angle",u[u.change_cost=10]="change_cost",u[u.recover_cost=11]="recover_cost",u[u.recover_used_cost=12]="recover_used_cost",u[u.reduce_default_cooldown=13]="reduce_default_cooldown",u[u.reduce_active_cooldown=14]="reduce_active_cooldown",u[u.enable_stage_buff=15]="enable_stage_buff",u[u.add_stage_buff=16]="add_stage_buff",u[u.change_buff_area_range=17]="change_buff_area_range",u[u.change_buff_duration=18]="change_buff_duration",u[u.change_buff_stat=19]="change_buff_stat",u[u.change_buff_stack=20]="change_buff_stack",u[u.change_buff_param=21]="change_buff_param",u[u.change_buff_expired_action=22]="change_buff_expired_action",u[u.change_chain_ratio=23]="change_chain_ratio",u[u.change_abnormal=24]="change_abnormal",u[u.change_abnormal_ratio=25]="change_abnormal_ratio",u[u.change_dam_attr=26]="change_dam_attr",u[u.change_dam_value=27]="change_dam_value",u[u.change_dam_coefficient=28]="change_dam_coefficient",u[u.change_dam_critical=29]="change_dam_critical",u[u.change_dam_critical_rate=30]="change_dam_critical_rate",u[u.change_attack_stage_speed=31]="change_attack_stage_speed",u[u.change_stack_charge_time=32]="change_stack_charge_time",u[u.change_stack_max_count=33]="change_stack_max_count",u[u.change_targeting=34]="change_targeting",u[u.change_min_range=35]="change_min_range",u[u.change_max_range=36]="change_max_range",u[u.change_push_info=37]="change_push_info",u[u.change_parts_attack_attr=38]="change_parts_attack_attr",u[u.change_skill_chain_info=39]="change_skill_chain_info",u[u.change_skill_chain_delay=40]="change_skill_chain_delay",u[u.change_behit_move_info=41]="change_behit_move_info",u[u.add_buff_stat=42]="add_buff_stat",u[u.add_chain_skill_effect=43]="add_chain_skill_effect",u[u.remove_chain_skill_effect=44]="remove_chain_skill_effect",u[u.add_chain_combat_effect=45]="add_chain_combat_effect",u[u.remove_chain_combat_effect=46]="remove_chain_combat_effect",u[u.change_skill_effect_bonus=47]="change_skill_effect_bonus",u[u.change_skill_effect_ai_point=48]="change_skill_effect_ai_point",u[u.change_dam_addend=49]="change_dam_addend",u[u.change_hitted=50]="change_hitted",u[u.change_skill_move_speed=51]="change_skill_move_speed",u[u.add_skill_buff=52]="add_skill_buff",u[u.change_skill_bonus=53]="change_skill_bonus",u[u.change_skill_normal_info=54]="change_skill_normal_info",u[u.change_skill_invisibility=55]="change_skill_invisibility",u[u.change_skill_constraint=56]="change_skill_constraint",u[u.change_skill_book_type=57]="change_skill_book_type",u[u.change_projection_skill_effect_id=58]="change_projection_skill_effect_id",u[u.change_push_pvp_info=59]="change_push_pvp_info",u[u.change_forced_critical=60]="change_forced_critical",u[u.change_instance_skill_effect_info=61]="change_instance_skill_effect_info",u[u.change_skill_start_stage=62]="change_skill_start_stage",u[u.change_skill_effect_dir_target=63]="change_skill_effect_dir_target",u[u.change_stage_dir_rate=64]="change_stage_dir_rate",u[u.change_projection=65]="change_projection",u[u.change_skill_view=66]="change_skill_view",u[u.change_projectile_speed=67]="change_projectile_speed",u[u.change_projectile_dist=68]="change_projectile_dist",u[u.change_projectile_resourcescale=69]="change_projectile_resourcescale",u[u.change_projectile_max_target_hit_count=70]="change_projectile_max_target_hit_count",u[u.change_summon_trap_lifetime=71]="change_summon_trap_lifetime",u[u.change_summon_trap_destroy_delaytime=72]="change_summon_trap_destroy_delaytime",u[u.change_summon_trap_react_info=73]="change_summon_trap_react_info",u[u.change_summon_trap_invoke_effect=74]="change_summon_trap_invoke_effect",u[u.change_summon_trap_count=75]="change_summon_trap_count",u[u.enable_identity_event=76]="enable_identity_event",u[u.change_identity_proc_value=77]="change_identity_proc_value",u[u.change_skill_effect_identity_proc_info=78]="change_skill_effect_identity_proc_info",u[u.change_identity_proc_pvp_value=79]="change_identity_proc_pvp_value",u[u.change_skill_effect_identity_proc_pvp_info=80]="change_skill_effect_identity_proc_pvp_info",u[u.change_skill_effect_identity_proc_replace_info=81]="change_skill_effect_identity_proc_replace_info",u[u.change_skill_effect_identity_proc_replace_pvp_info=82]="change_skill_effect_identity_proc_replace_pvp_info",u[u.swap_chain_skill_effect=83]="swap_chain_skill_effect",u[u.swap_chain_combat_effect=84]="swap_chain_combat_effect",u[u.change_charge_scale=85]="change_charge_scale",u[u.change_summon_npc_id=86]="change_summon_npc_id",u[u.change_summon_npc_sight_range=87]="change_summon_npc_sight_range",u[u.change_summon_npc_pursuit_range=88]="change_summon_npc_pursuit_range",u[u.change_summon_npc_walk_movespeed=89]="change_summon_npc_walk_movespeed",u[u.change_summon_npc_battle_movespeed=90]="change_summon_npc_battle_movespeed",u[u.change_summon_npc_life_time=91]="change_summon_npc_life_time",u[u.change_summon_npc_ai_index=92]="change_summon_npc_ai_index",u[u.change_summon_npc_invincible_duration=93]="change_summon_npc_invincible_duration",u[u.change_summon_npc_acquire_identity=94]="change_summon_npc_acquire_identity",u[u.change_summon_npc_skill_id=95]="change_summon_npc_skill_id",u[u.change_summon_npc_die_skill_id=96]="change_summon_npc_die_skill_id",u[u.change_summon_npc_destroy_skill_id=97]="change_summon_npc_destroy_skill_id",u[u.change_summon_npc_spawn_buff_id=98]="change_summon_npc_spawn_buff_id",u[u.change_summon_npc_count=99]="change_summon_npc_count",u[u.change_summon_npc_stat=100]="change_summon_npc_stat",u[u.change_summon_npc_threat_point=101]="change_summon_npc_threat_point",u[u.change_summon_npc_skill_usable_tick=102]="change_summon_npc_skill_usable_tick",u[u.change_summon_npc_skill_use_order=103]="change_summon_npc_skill_use_order",u[u.change_combat_effect_arg=104]="change_combat_effect_arg",u[u.change_skill_effect_cost=105]="change_skill_effect_cost",u[u.change_accumulate_dam_rate=106]="change_accumulate_dam_rate",u[u.change_projectile_bank_data_addend=107]="change_projectile_bank_data_addend",u[u.change_identity_category=108]="change_identity_category",u[u.change_skill_slot_visible_effect=109]="change_skill_slot_visible_effect",u[u.change_attack_mask=110]="change_attack_mask",u[u.change_aim_target_max_range=111]="change_aim_target_max_range",u))(Me||{}),bt=(s=>(s[s.none=0]="none",s[s.hp=1]="hp",s[s.mp=2]="mp",s[s.str=3]="str",s[s.agi=4]="agi",s[s.int=5]="int",s[s.con=6]="con",s[s.str_x=7]="str_x",s[s.agi_x=8]="agi_x",s[s.int_x=9]="int_x",s[s.con_x=10]="con_x",s[s.criticalhit=15]="criticalhit",s[s.specialty=16]="specialty",s[s.oppression=17]="oppression",s[s.rapidity=18]="rapidity",s[s.endurance=19]="endurance",s[s.mastery=20]="mastery",s[s.criticalhit_x=21]="criticalhit_x",s[s.specialty_x=22]="specialty_x",s[s.oppression_x=23]="oppression_x",s[s.rapidity_x=24]="rapidity_x",s[s.endurance_x=25]="endurance_x",s[s.mastery_x=26]="mastery_x",s[s.max_hp=27]="max_hp",s[s.max_mp=28]="max_mp",s[s.max_hp_x=29]="max_hp_x",s[s.max_mp_x=30]="max_mp_x",s[s.max_hp_x_x=31]="max_hp_x_x",s[s.max_mp_x_x=32]="max_mp_x_x",s[s.normal_hp_recovery=33]="normal_hp_recovery",s[s.combat_hp_recovery=34]="combat_hp_recovery",s[s.normal_hp_recovery_rate=35]="normal_hp_recovery_rate",s[s.combat_hp_recovery_rate=36]="combat_hp_recovery_rate",s[s.normal_mp_recovery=37]="normal_mp_recovery",s[s.combat_mp_recovery=38]="combat_mp_recovery",s[s.normal_mp_recovery_rate=39]="normal_mp_recovery_rate",s[s.combat_mp_recovery_rate=40]="combat_mp_recovery_rate",s[s.self_recovery_rate=41]="self_recovery_rate",s[s.drain_hp_dam_rate=42]="drain_hp_dam_rate",s[s.drain_mp_dam_rate=43]="drain_mp_dam_rate",s[s.dam_reflection_rate=44]="dam_reflection_rate",s[s.char_attack_dam=47]="char_attack_dam",s[s.skill_effect_dam_addend=48]="skill_effect_dam_addend",s[s.attack_power_rate=49]="attack_power_rate",s[s.skill_damage_rate=50]="skill_damage_rate",s[s.attack_power_rate_x=51]="attack_power_rate_x",s[s.skill_damage_rate_x=52]="skill_damage_rate_x",s[s.cooldown_reduction=53]="cooldown_reduction",s[s.paralyzation_point_rate=54]="paralyzation_point_rate",s[s.def=55]="def",s[s.res=56]="res",s[s.def_x=57]="def_x",s[s.res_x=58]="res_x",s[s.def_x_x=59]="def_x_x",s[s.res_x_x=60]="res_x_x",s[s.critical_physical_inc_rate=65]="critical_physical_inc_rate",s[s.critical_magical_inc_rate=66]="critical_magical_inc_rate",s[s.def_pen_rate=67]="def_pen_rate",s[s.res_pen_rate=68]="res_pen_rate",s[s.physical_inc_rate=69]="physical_inc_rate",s[s.magical_inc_rate=70]="magical_inc_rate",s[s.self_shield_rate=71]="self_shield_rate",s[s.hit_rate=72]="hit_rate",s[s.dodge_rate=73]="dodge_rate",s[s.critical_hit_rate=74]="critical_hit_rate",s[s.critical_res_rate=75]="critical_res_rate",s[s.critical_dam_rate=76]="critical_dam_rate",s[s.attack_speed=77]="attack_speed",s[s.attack_speed_rate=78]="attack_speed_rate",s[s.move_speed=79]="move_speed",s[s.move_speed_rate=80]="move_speed_rate",s[s.prop_move_speed=81]="prop_move_speed",s[s.prop_move_speed_rate=82]="prop_move_speed_rate",s[s.vehicle_move_speed=83]="vehicle_move_speed",s[s.vehicle_move_speed_rate=84]="vehicle_move_speed_rate",s[s.ship_move_speed=85]="ship_move_speed",s[s.ship_move_speed_rate=86]="ship_move_speed_rate",s[s.fire_dam_rate=87]="fire_dam_rate",s[s.ice_dam_rate=88]="ice_dam_rate",s[s.electricity_dam_rate=89]="electricity_dam_rate",s[s.earth_dam_rate=91]="earth_dam_rate",s[s.dark_dam_rate=92]="dark_dam_rate",s[s.holy_dam_rate=93]="holy_dam_rate",s[s.elements_dam_rate=94]="elements_dam_rate",s[s.fire_res_rate=95]="fire_res_rate",s[s.ice_res_rate=96]="ice_res_rate",s[s.electricity_res_rate=97]="electricity_res_rate",s[s.earth_res_rate=99]="earth_res_rate",s[s.dark_res_rate=100]="dark_res_rate",s[s.holy_res_rate=101]="holy_res_rate",s[s.elements_res_rate=102]="elements_res_rate",s[s.self_cc_time_rate=105]="self_cc_time_rate",s[s.enemy_cc_time_rate=106]="enemy_cc_time_rate",s[s.identity_value1=107]="identity_value1",s[s.identity_value2=108]="identity_value2",s[s.identity_value3=109]="identity_value3",s[s.awakening_dam_rate=110]="awakening_dam_rate",s[s.item_drop_rate=111]="item_drop_rate",s[s.gold_rate=112]="gold_rate",s[s.exp_rate=113]="exp_rate",s[s.attack_power_addend=123]="attack_power_addend",s[s.attack_power_addend_2=124]="attack_power_addend_2",s[s.npc_species_humanoid_dam_rate=125]="npc_species_humanoid_dam_rate",s[s.npc_species_devil_dam_rate=126]="npc_species_devil_dam_rate",s[s.npc_species_substance_dam_rate=127]="npc_species_substance_dam_rate",s[s.npc_species_undead_dam_rate=128]="npc_species_undead_dam_rate",s[s.npc_species_plant_dam_rate=129]="npc_species_plant_dam_rate",s[s.npc_species_insect_dam_rate=130]="npc_species_insect_dam_rate",s[s.npc_species_spirit_dam_rate=131]="npc_species_spirit_dam_rate",s[s.npc_species_wild_beast_dam_rate=132]="npc_species_wild_beast_dam_rate",s[s.npc_species_mechanic_dam_rate=133]="npc_species_mechanic_dam_rate",s[s.npc_species_ancient_dam_rate=134]="npc_species_ancient_dam_rate",s[s.npc_species_god_dam_rate=135]="npc_species_god_dam_rate",s[s.npc_species_archfiend_dam_rate=136]="npc_species_archfiend_dam_rate",s[s.vitality=137]="vitality",s[s.ship_booter_speed=138]="ship_booter_speed",s[s.ship_wreck_speed_rate=139]="ship_wreck_speed_rate",s[s.island_speed_rate=140]="island_speed_rate",s[s.attack_power_sub_rate_1=141]="attack_power_sub_rate_1",s[s.attack_power_sub_rate_2=142]="attack_power_sub_rate_2",s[s.physical_inc_sub_rate_1=143]="physical_inc_sub_rate_1",s[s.physical_inc_sub_rate_2=144]="physical_inc_sub_rate_2",s[s.magical_inc_sub_rate_1=145]="magical_inc_sub_rate_1",s[s.magical_inc_sub_rate_2=146]="magical_inc_sub_rate_2",s[s.skill_damage_sub_rate_1=147]="skill_damage_sub_rate_1",s[s.skill_damage_sub_rate_2=148]="skill_damage_sub_rate_2",s[s.resource_recovery_rate=149]="resource_recovery_rate",s[s.weapon_dam=151]="weapon_dam",s[s.weapon_dam_x=152]="weapon_dam_x",s))(bt||{});var gs=require("tiny-typed-emitter");var H,yt,q,Rt,ua,ht,je,fa=class extends gs.TypedEmitter{constructor(a,n,r=!0,o=!!process.env.DEV){super();$(this,Rt);$(this,ht);G(this,"PartyStatusEffectRegistry");G(this,"LocalStatusEffectRegistry");$(this,H,void 0);$(this,yt,void 0);$(this,q,void 0);G(this,"debug");G(this,"trace",!1);this.PartyStatusEffectRegistry=new Map,this.LocalStatusEffectRegistry=new Map,this.debug=o,et(this,H,a),et(this,yt,n),et(this,q,r)}getStatusEffectRegistryForPlayer(a,n){let r=this.getPlayerRegistry(n),o=r.get(a);if(o)return o;let i=new Map;return r.set(a,i),i}hasStatusEffectRegistryForPlayer(a,n){return this.getPlayerRegistry(n).has(a)}getPlayerRegistry(a){switch(a){case 1:return this.LocalStatusEffectRegistry;case 0:return this.PartyStatusEffectRegistry;default:break}return this.LocalStatusEffectRegistry}RemoveLocalObject(a,n){let r=this.LocalStatusEffectRegistry.get(a);if(r)for(let[,o]of r)this.RemoveStatusEffect(a,o.instanceId,1,void 0,n);this.LocalStatusEffectRegistry.delete(a)}RemovePartyObject(a,n){let r=this.PartyStatusEffectRegistry.get(a);if(r)for(let[,o]of r)this.RemoveStatusEffect(a,o.instanceId,0,void 0,n);this.PartyStatusEffectRegistry.delete(a)}RegisterStatusEffect(a){let n=this.getStatusEffectRegistryForPlayer(a.targetId,a.type),r=n.get(a.instanceId);r?D(this,q)&&r.expirationTimer&&(clearTimeout(r.expirationTimer),r.expirationTimer=void 0):a.effectType===0&&this.emit("shieldApplied",a),n.set(a.instanceId,a),this.SetupStatusEffectTimeout(a)}HasAnyStatusEffect(a,n,r,o){if(!this.hasStatusEffectRegistryForPlayer(a,n))return!1;let i=this.getStatusEffectRegistryForPlayer(a,n);for(let[,f]of i)if(!(!D(this,q)&&!this.IsReplayStatusEffectValidElseRemove(f,o))){for(let p of r)if(p===f.statusEffectId)return!0}return!1}IsReplayStatusEffectValidElseRemove(a,n){return a.expireAt===void 0||a.expireAt.getTime()>n.getTime()?!0:(this.ExpireStatusEffectByTimeout(a),!1)}HasAnyStatusEffectFromParty(a,n,r,o,i){if(!this.hasStatusEffectRegistryForPlayer(a,n))return!1;let f=this.getStatusEffectRegistryForPlayer(a,n);for(let[,p]of f)if(!(!D(this,q)&&!this.IsReplayStatusEffectValidElseRemove(p,i))&&o.includes(p.statusEffectId)&&(this.ValidForWholeRaid(p)||D(this,H).getPartyIdFromEntityId(p.sourceId)===r))return!0;return!1}RemoveStatusEffect(a,n,r,o,i){if(!this.hasStatusEffectRegistryForPlayer(a,r))return;let f=this.getStatusEffectRegistryForPlayer(a,r),p=f.get(n);return p&&(D(this,q)&&(clearTimeout(p.expirationTimer),p.expirationTimer=void 0),f.delete(n),o===4&&(D(this,q)||this.IsReplayStatusEffectValidElseRemove(p,i))&&this.RegisterValueUpdate(p,p.value,0)),p}GetStatusEffects(a,n,r){if(!this.hasStatusEffectRegistryForPlayer(a,n))return[];let o=this.getStatusEffectRegistryForPlayer(a,n);if(!D(this,q))for(let[,i]of o)this.IsReplayStatusEffectValidElseRemove(i,r);return[...o.values()]}GetStatusEffectsFromParty(a,n,r,o){if(!this.hasStatusEffectRegistryForPlayer(a,n))return[];let i=this.getStatusEffectRegistryForPlayer(a,n);if(!D(this,q))for(let[,f]of i)this.IsReplayStatusEffectValidElseRemove(f,o);return[...i.values()].filter(f=>this.ValidForWholeRaid(f)?!0:r===D(this,H).getPartyIdFromEntityId(f.sourceId))}Clear(a){let n=0;for(let[,o]of this.LocalStatusEffectRegistry){for(let[,i]of o)this.RemoveStatusEffect(i.targetId,i.instanceId,i.type,void 0,a);n+=o.size}let r=0;for(let[,o]of this.PartyStatusEffectRegistry){for(let[,i]of o)this.RemoveStatusEffect(i.targetId,i.instanceId,i.type,void 0,a);r+=o.size}this.trace&&console.log("On Clear SE in local",n,"in party",r),this.LocalStatusEffectRegistry.clear(),this.PartyStatusEffectRegistry.clear()}UpdateDuration(a,n,r,o){let f=this.getStatusEffectRegistryForPlayer(n,o).get(a);if(f){let p=r-f.timestamp;if(D(this,q)&&f.expirationTimer&&(this.trace&&console.log("Clearing timeout for",f.instanceId,"because of duration change"),clearTimeout(f.expirationTimer),f.expirationTimer=void 0),f.expireAt){let l=f.expireAt.getTime()+Number(p),S=l-f.pktTime.getTime();S>0?(this.trace&&console.log("Extending duration by",p,"ms","New timeout delay",S,"from",f.expireAt.toISOString(),"to",new Date(l).toISOString()),D(this,q)&&(f.expirationTimer=setTimeout(this.ExpireStatusEffectByTimeout.bind(this,f),S)),f.expireAt=new Date(l),f.timestamp=r):f.expireAt=void 0}}else this.debug&&console.error("Tried to update duration for SE with instanceId",a," on target",n,"but where is no such SE registered")}SyncStatusEffect(a,n,r,o,i){let f=_t(this,ht,je).call(this,n,i),p=f?0:1,l=f?n:r;if(!l)return;let b=this.getStatusEffectRegistryForPlayer(l,p).get(a);if(!b)return;let T=b.value;b.value=o,this.RegisterValueUpdate(b,T,o)}ValidForWholeRaid(a){return(a.buffCategory===3||a.buffCategory===1||a.buffCategory===2)&&a.category===1&&a.showType===1}SetupStatusEffectTimeout(a){if(a.expirationDelay>0&&a.expirationDelay<604800){let n=a.pktTime.getTime()>a.occurTime.getTime()?a.pktTime:a.occurTime,r=Math.ceil(a.expirationDelay*1e3),o=n.getTime()+r+fa.TIMEOUT_DELAY_MS-a.pktTime.getTime();a.expireAt=new Date(a.pktTime.getTime()+o),this.trace&&console.log("Setting up statuseffect expiration time for",a.name,a.instanceId,"to",a.expireAt.toISOString(),"with delay",o),D(this,q)&&(a.expirationTimer=setTimeout(this.ExpireStatusEffectByTimeout.bind(this,a),o))}}ExpireStatusEffectByTimeout(a){this.debug&&console.error("Triggered timeout on",a.name,"with iid",a.instanceId),this.RemoveStatusEffect(a.targetId,a.instanceId,a.type,void 0,new Date)}RegisterValueUpdate(a,n,r){a.effectType===0&&this.emit("shieldChanged",a,n,r)}newPC(a,n,r){let o=_t(this,ht,je).call(this,a.pcStruct.characterId,n);o?this.RemovePartyObject(a.pcStruct.characterId,r):this.RemoveLocalObject(a.pcStruct.playerId,r);for(let i of a.pcStruct.statusEffectDatas)this.RegisterStatusEffect(this.buildStatusEffect(i,o?a.pcStruct.characterId:a.pcStruct.playerId,i.sourceId,o?0:1,r))}buildStatusEffect(a,n,r,o,i){let f=a.value?a.value.readUInt32LE():0,p=a.value?a.value.readUInt32LE(8):0,l=f<p?f:p,S=0,b=0,T=0,Z="Unknown",L=1,M=D(this,yt).skillBuff.get(a.statusEffectId);if(M){switch(Z=M.name,M.category){case"debuff":S=1;break}switch(M.buffcategory){case"bracelet":b=1;break;case"etc":b=2;break;case"battleitem":b=3;break}switch(M.iconshowtype){case"all":T=1;break}switch(M.type){case"shield":L=0;break}}return{instanceId:a.effectInstanceId,sourceId:r,statusEffectId:a.statusEffectId,targetId:n,type:o,dbTarget:M?.target??"none",value:l,buffCategory:b,category:S,showType:T,expirationDelay:a.totalTime,expirationTimer:void 0,timestamp:a.endTick,expireAt:void 0,occurTime:a.occurTime,name:Z,pktTime:i,effectType:L,stackCount:a.stackCount}}getStatusEffects(a,n,r,o){let i=[],f=[],p=_t(this,Rt,ua).call(this,a,r),l=this.GetStatusEffects(p?a.characterId:a.entityId,p?0:1,o);for(let S of l)f.push([S.statusEffectId,S.sourceId,S.stackCount]);if(n){let S=_t(this,Rt,ua).call(this,n,r),b=D(this,H).isEntityInParty(a.entityId),T=b?D(this,H).getPartyIdFromEntityId(a.entityId):void 0,Z=b&&T?this.GetStatusEffectsFromParty(S?n.characterId:n.entityId,S?0:1,T,o):this.GetStatusEffects(S?n.characterId:n.entityId,S?0:1,o);for(let L of Z)L.type===1&&L.category===1&&L.sourceId!==a.entityId&&L.dbTarget==="self"||i.push([L.statusEffectId,L.sourceId,L.stackCount])}return[f,i]}},Dt=fa;H=new WeakMap,yt=new WeakMap,q=new WeakMap,Rt=new WeakSet,ua=function(a,n){if(a.entityType!==1)return!1;let r=a;return _t(this,ht,je).call(this,r.characterId,n)},ht=new WeakSet,je=function(a,n){let r=D(this,H).isCharacterInParty(n),o=D(this,H).isCharacterInParty(a);if(r){if(!o||a===n)return!1;let i=D(this,H).getPartyIdFromCharacterId(n),f=D(this,H).getPartyIdFromCharacterId(a);return i===f}return!1},G(Dt,"TIMEOUT_DELAY_MS",1e3);var Fe=class{#t;#n;#r;#i;entities=new Map;localPlayer;constructor(t,a,n,r){this.#t=t,this.#n=a,this.#r=n,this.#i=r,this.localPlayer={entityId:0n,entityType:1,name:"You",class:0,gearLevel:0,characterId:0n,stance:0,stats:new Map,skills:new Map,items:{}}}processNewPC(t){let a=t.parsed;if(!a)return;let n={entityId:a.pcStruct.playerId,entityType:1,name:a.pcStruct.name,class:a.pcStruct.classId,gearLevel:a.pcStruct.maxItemLevel,characterId:a.pcStruct.characterId,stance:0,stats:this.#i.getStatPairMap(a.pcStruct.statPair),skills:new Map,items:{}};this.entities.set(n.entityId,n);let r=this.#t.getEntityId(n.characterId);r&&this.#n.changeEntityId(r,a.pcStruct.playerId),this.#t.addMapping(n.characterId,n.entityId),this.#n.completeEntry(n.characterId,n.entityId),this.#r.newPC(a,this.localPlayer.characterId,t.time),n.itemSet=this.getPlayerSetOptions(a.pcStruct.equipItemDataList);let o=[];a.pcStruct.equipItemDataList.forEach(f=>{f.id!==void 0&&f.slot!==void 0&&o.push({id:f.id,slot:f.slot})}),n.items.equipList=o;let i=[];return a.pcStruct.equipLifeToolDataList.forEach(f=>{f.id!==void 0&&f.slot!==void 0&&i.push({id:f.id,slot:f.slot})}),n.items.lifeToolList=i,n}processInitEnv(t){let a=t.parsed;if(!a)return;this.localPlayer.entityId!==0n&&this.#n.changeEntityId(this.localPlayer.entityId,a.playerId),this.entities.clear();let n={entityId:a.playerId,entityType:1,name:this.localPlayer.name,class:this.localPlayer.class,gearLevel:this.localPlayer.gearLevel,characterId:this.localPlayer.characterId,stance:this.localPlayer.stance,stats:this.localPlayer.stats,skills:this.localPlayer.skills,items:{}};this.localPlayer=n,this.entities.set(n.entityId,n),this.#t.clear(),this.#r.Clear(t.time),n.characterId!==0n&&this.#t.addMapping(n.characterId,n.entityId),this.localPlayer&&this.localPlayer.characterId&&this.localPlayer.characterId>0n&&this.#n.completeEntry(this.localPlayer.characterId,a.playerId)}processInitPC(t){let a=t.parsed;if(!a)return;this.entities.clear();let n={entityId:a.playerId,entityType:1,name:a.name,class:a.classId,gearLevel:a.gearLevel,characterId:a.characterId,stance:0,stats:this.#i.getStatPairMap(a.statPair),skills:new Map,items:{}};this.localPlayer=n,this.entities.set(n.entityId,n),this.#t.addMapping(n.characterId,n.entityId),this.#n.setOwnName(a.name),this.#n.completeEntry(n.characterId,a.playerId),this.#r.RemoveLocalObject(a.playerId,t.time);for(let r of a.statusEffectDatas){let o=this.getSourceEntity(r.sourceId);this.#r.RegisterStatusEffect(this.#r.buildStatusEffect(r,a.playerId,o.entityId,1,t.time))}return n}processNewNpc(t){let a=t.parsed;if(!a)return;let n=!1,r=this.#i.npc.get(a.npcStruct.typeId);r&&[6,7,9,10].includes(sa[r.grade])&&(n=!0);let o={entityId:a.npcStruct.objectId,entityType:2,name:r?.name??a.npcStruct.objectId.toString(16),typeId:a.npcStruct.typeId,isBoss:n,grade:r?.grade??"none",pushimmune:r?.pushimmune??!1,stats:this.#i.getStatPairMap(a.npcStruct.statPair),level:a.npcStruct.level,balanceLevel:a.npcStruct.balanceLevel??a.npcStruct.level},i=this.#i.getNpcEsther(a.npcStruct.typeId);i!==void 0&&(o.entityType=4,o.name=i.name,o.icon=i.icon),this.entities.set(o.entityId,o),this.#r.RemoveLocalObject(a.npcStruct.objectId,t.time);for(let f of a.npcStruct.statusEffectDatas){let p=this.getSourceEntity(f.sourceId);this.#r.RegisterStatusEffect(this.#r.buildStatusEffect(f,a.npcStruct.objectId,p.entityId,1,t.time))}return o}processNewNpcSummon(t){let a=t.parsed;if(!a)return;let n=!1,r=this.#i.npc.get(a.npcData.typeId);r&&["boss","raid","epic_raid","commander"].includes(r.grade)&&(n=!0);let o={entityId:a.npcData.objectId,entityType:3,name:r?.name??a.npcData.objectId.toString(16),ownerId:a.ownerId,typeId:a.npcData.typeId,isBoss:n,grade:r?.grade??"none",pushimmune:r?.pushimmune??!1,stats:this.#i.getStatPairMap(a.npcData.statPair),level:a.npcData.level,balanceLevel:a.npcData.balanceLevel??a.npcData.level};this.#r.RemoveLocalObject(a.npcData.objectId,t.time);for(let i of a.npcData.statusEffectDatas){let f=this.getSourceEntity(i.sourceId);this.#r.RegisterStatusEffect(this.#r.buildStatusEffect(i,a.npcData.objectId,f.entityId,1,t.time))}return this.entities.set(o.entityId,o),o}getPlayerSetOptions(t){let a=new Map;t.forEach(r=>{if(r.id&&r.slot&&r.slot>=1&&r.slot<=6){let o=this.#i.itemSet.items.get(r.id);if(o){let i=a.get(o.setname);i||(i=new Map,a.set(o.setname,i)),i.set(o.level,(i.get(o.level)??0)+1)}}});let n=[];return a.forEach((r,o)=>{let i=this.#i.itemSet.seteffects.get(o);if(!i)return;let f=0,p=0;for(let[l,S]of[...r.entries()].sort((b,T)=>T[0]-b[0])){let b=i.get(l);if(!b)return;for(let[T,Z]of[...b.entries()])T>f&&S+p>=T&&(n.push(...Z.options),f=Math.max(f,T));p=S}}),n}getSourceEntity(t){let a=this.entities.get(t);if((a?.entityType===5||a?.entityType===3)&&(t=a.ownerId),a=this.entities.get(t),a)return a;let n={entityId:t,entityType:2,name:t.toString(16),stats:new Map};return this.entities.set(t,n),n}guessIsPlayer(t,a){let n=this.#i.getSkillClassId(a);if(n!==0){let r;if(t.entityType===1){let o=t;if(o.class===n)return o;r={entityId:o.entityId,entityType:1,name:o.name,class:n,gearLevel:o.gearLevel,characterId:o.characterId,stance:o.stance,stats:o.stats,skills:new Map,items:{}}}else r={entityId:t.entityId,entityType:1,name:t.name,class:n,gearLevel:0,characterId:0n,stance:0,stats:new Map,skills:new Map,items:{}};return this.entities.set(t.entityId,r),r}return t}getOrCreateEntity(t){let a=this.entities.get(t);return a||(a={entityId:t,entityType:0,name:t.toString(16),stats:new Map},this.entities.set(t,a)),a}getEntityByName(t){return[...this.entities.values()].find(a=>a.name===t)}};var mu=require("tiny-typed-emitter");var uu=require("crypto");var fu=Yu(require("axios"));var d=class{b;o;constructor(t){this.b=t,this.o=0}skip(t=0){this.o+=t}bool(){return this.u8()===1}u8(){return this.b.readUint8(this.o++)}i8(){return this.b.readInt8(this.o++)}u16(){let t=this.b.readUint16LE(this.o);return this.o+=2,t}i16(){let t=this.b.readInt16LE(this.o);return this.o+=2,t}u32(){let t=this.b.readUint32LE(this.o);return this.o+=4,t}i32(){let t=this.b.readInt32LE(this.o);return this.o+=4,t}f32(){let t=this.b.readFloatLE(this.o);return this.o+=4,t}u64(){let t=this.b.readBigUint64LE(this.o);return this.o+=8,t}i64(){let t=this.b.readBigInt64LE(this.o);return this.o+=8,t}string(t){let a=this.u16();if(a<=t){a=a*2;let n=this.b.toString("utf16le",this.o,this.o+a);return this.o+=a,n}return""}bytes(t=0,a,n){if(a&&t>a)return Buffer.alloc(0);n&&(t=t*n);let r=Buffer.from(this.b.subarray(this.o,this.o+t));return this.o+=t,r}array(t,a,n){return n&&t>n?[]:new Array(t).fill(void 0).map(a)}},qe=class{b;o;constructor(t=65535){this.b=Buffer.allocUnsafe(t),this.o=0}get value(){return this.b.subarray(0,this.o)}skip(t=0){this.o+=t}bool(t=!1){return this.u8(t?1:0),t}u8(t=0){this.b.writeUInt8(t,this.o++)}i8(t=0){this.b.writeInt8(t,this.o++)}u16(t=0){this.o=this.b.writeUInt16LE(t,this.o)}i16(t=0){this.o=this.b.writeInt16LE(t,this.o)}u32(t=0){this.o=this.b.writeUInt32LE(t,this.o)}i32(t=0){this.o=this.b.writeInt32LE(t,this.o)}f32(t=0){this.o=this.b.writeFloatLE(t,this.o)}u64(t=0n){this.o=this.b.writeBigUInt64LE(BigInt(t),this.o)}i64(t=0n){this.o=this.b.writeBigInt64LE(BigInt(t),this.o)}string(t="",a=0){this.u16(t.length),t.length<=a&&(this.o+=this.b.write(t,this.o,"utf16le"))}bytes(t=Buffer.alloc(0),a={}){if(a.maxLen){let n=a.multiplier??1;if(t.length%n)throw new Error(`Error writing bytes, chunkSize should be a multiple of intut value size, got ${t.length}%${n}`);let r=t.length/n;if(r>a.maxLen)throw new Error(`Error writing bytes, input value size exceeded maxLen, got ${r} > ${a.maxLen}`);if(!a.lenType)throw new Error(`Error writing bytes, invalid lenType when writing chunks, got ${a.lenType}`);this[a.lenType](r)}else if(a.length&&t.length!==a.length)throw new Error(`Error writing bytes, input value size doesn't match opts.length, ${t.length} !== ${a.lenType}`);this.o+=t.copy(this.b,this.o)}array(t=[],a,n){if(t===void 0||t.length>a.maxLen){this[a.lenType](0);return}this[a.lenType](t.length),t.forEach(n)}};var at=class{time;#t;#n;#r;#i;constructor(...t){if(t.length===5){let[a,n,r,o,i]=t;this.#n=a,this.time=r,this.#t=n,this.#r=o,this.#i=i}else if(t.length===3){let[a,n,r]=t;this.#n=Buffer.alloc(0),this.time=new Date,this.#t=n,this.#r=()=>a,this.#i=r}else throw new Error("[meter-core/logger/parser] - LogEvent<T>: Invalid constructor arguments")}#a;get parsed(){if(!this.#a)try{this.#a=this.#r(new d(this.#n))}catch(t){console.error(`[meter-core/logger/parser] - parsed - ${t}`);return}return this.#a}#e;get serialized(){if(!this.#e)try{if(!this.parsed)return;let t=new qe;t.skip(ws),this.#i(t,this.parsed);let a=t.value;a.writeUint16LE(a.length,Ks),a.writeUint16LE(this.#t,ca),a.writeUintLE(+new Date,As,da),this.#e=t.value}catch(t){console.error(`[meter-core/logger/parser] - serialized - ${t}`);return}return this.#e}},ma=6,Ls=2,Ks=0,la=2,ca=Ks+Ls,da=6,As=ca+la,ws=Ls+la+da;function St(e,t){let a={};return a.points=e.u16(),a.id=e.u32(),a.level=e.u8(),a}function Pt(e,t){e.u16(t.points),e.u32(t.id),e.u8(t.level)}function _a(e,t){let a={};return a.abilityDataList=e.array(e.u16(),()=>St(e,t),100),a}function ba(e,t){e.array(t.abilityDataList,{maxLen:100,lenType:"u16"},a=>{Pt(e,a)})}var ha="AbilityChangeNotify";function Bs(e,t){let a={};return a.featureType=e.u16(),a.level=e.u32(),a}function Cs(e,t){e.u16(t.featureType),e.u32(t.level)}function Sa(e,t){let a={};return a.activeAbilityList=e.array(e.u16(),()=>Bs(e,t),60),a.objectId=e.u64(),a}function Pa(e,t){e.array(t.activeAbilityList,{maxLen:60,lenType:"u16"},a=>{Cs(e,a)}),e.u64(t.objectId)}var ka="ActiveAbilityNotify";function Ta(e,t){let a={};return a.objectId=e.u64(),a.addonSkillFeatureList=e.array(e.u16(),()=>{let n={};return n.addonSkillFeatureIdList=e.array(e.u16(),()=>e.u32(),5),n.skillId=e.u32(),n},200),a}function Ia(e,t){e.u64(t.objectId),e.array(t.addonSkillFeatureList,{maxLen:200,lenType:"u16"},a=>{e.array(a.addonSkillFeatureIdList,{maxLen:5,lenType:"u16"},n=>{e.u32(n)}),e.u32(a.skillId)})}var Ea="AddonSkillFeatureChangeNotify";function va(e,t){let a={};return a.paralyzationMaxPoint=e.u32(),a.type=e.u8(),a.objectId=e.u64(),a.paralyzationPoint=e.u32(),a}function xa(e,t){e.u32(t.paralyzationMaxPoint),e.u8(t.type),e.u64(t.objectId),e.u32(t.paralyzationPoint)}var Na="BlockSkillStateNotify";function Da(e,t){let a={};return a.sourceId=e.u64(),a.targetId=e.u64(),a.type=e.u32(),a}function ya(e,t){e.u64(t.sourceId),e.u64(t.targetId),e.u32(t.type)}var Ra="CounterAttackNotify";function ga(e,t){let a={};return a.sourceId=e.u64(),a.targetId=e.u64(),a}function La(e,t){e.u64(t.sourceId),e.u64(t.targetId)}var Ka="DeathNotify";function Aa(e,t){let a={};return a.abilityDataList=e.array(e.u16(),()=>St(e,t),100),a}function wa(e,t){e.array(t.abilityDataList,{maxLen:100,lenType:"u16"},a=>{Pt(e,a)})}var Ba="InitAbility";function Ca(e,t){let a={};return a.playerId=e.u64(),a}function Ma(e,t){e.u64(t.playerId)}var ja="InitEnv";var Xu=[0,31,28,31,30,31,30,31,31,30,31,30,31];function tf(e){return!(e%4||!(e%100)&&e%400)}function ef(e,t,a){if(e>99){if(e<1752||e==1752&&(t<9||t==9&&a<<14))return!1}else e+=1900;return a>0&&t<=12&&(a<=Xu[t]||a==29&&t==2&&tf(e))}function Oa(e){let t=Number(e&0xffffffffn),a=Number(e>>32n&0xffffffffn),n=t&4095,r=(t&65535)>>12,o=t>>16&31;ef(n,r,o)||(n=r=o=0);let i=t>>21&31,f=t>>26&63,p=a&63,l=a>>6&16383;return i<24&&f<60&&p<60&&l<1e3||(i=24,f=p=l=0),new Date(Date.UTC(n<=99?n+1900:n,r-1,o,i,f,p,l))}function Ms(e){let t=0n;return t|=BigInt(e.getUTCMilliseconds())<<38n,t|=BigInt(e.getUTCSeconds())<<32n,t|=BigInt(e.getUTCMinutes())<<26n,t|=BigInt(e.getUTCHours())<<21n,t|=BigInt(e.getUTCDate())<<16n,t|=BigInt(e.getUTCMonth()+1)<<12n,t|=BigInt(e.getUTCFullYear()<2e3?e.getUTCFullYear()-1900:e.getUTCFullYear()),t}function j(e,t=0){let a=e.u16();return(a&4095)<2079?(e.o-=2,Oa(e.i64())):Oa(BigInt(a)&0xfffn|0x11000n)}function rt(e,t=Oa(0x1181fn)){t.getUTCFullYear()>=2079?e.u16(Number(Ms(t)&0xffffn)):e.i64(Ms(t))}function W(e,t){let a={};return a.skillLevel=e.u8(),a.occurTime=j(e,t),a.statusEffectId=e.u32(),a.sourceId=e.u64(),a.totalTime=e.f32(),a.endTick=e.u64(),e.bool()&&(a.value=e.bytes(16)),a.effectInstanceId=e.u32(),t>=1?a.stackCount=e.u8():a.stackCount=1,a}function U(e,t){e.u8(t.skillLevel),rt(e,t.occurTime),e.u32(t.statusEffectId),e.u64(t.sourceId),e.f32(t.totalTime),e.u64(t.endTick),e.bool(t.value!==void 0)&&e.bytes(t.value,{length:16}),e.u32(t.effectInstanceId),e.u8(t.stackCount)}function af(e){if(e.length===0)return 0n;if(e.length>8)throw new Error("Value is too large");let t=Buffer.alloc(8);return e.copy(t),t.readBigInt64LE()}function I(e,t=0){let a=e.u8(),n=e.bytes(a>>1&7),r=af(n)<<4n|BigInt(a>>4);return a&1?-r:r}function w(e,t=0n){let a=Buffer.alloc(8),n=t<0n;a.writeBigInt64LE((n?-t:t)>>4n);let r=0;for(let[o,i]of a.entries())i!=0&&(r=o+1);if(r>7)throw new Error("Value is too large");e.u8(Number((n?-t:t)&0xfn)<<4|(r&7)<<1|(n?1:0)),e.bytes(a.subarray(0,r),{length:r})}function Fa(e,t){let a={};return a.statPair=e.array(e.u16(),()=>{let n={};return n.StatType=e.u8(),n.Value=I(e,t),n},152),a.name=e.string(20),a.level=e.u16(),a.statusEffectDatas=e.array(e.u16(),()=>W(e,t),80),a.characterId=e.u64(),a.gearLevel=e.f32(),a.playerId=e.u64(),a.classId=e.u16(),a}function qa(e,t){e.array(t.statPair,{maxLen:152,lenType:"u16"},a=>{e.u8(a.statType),w(e,a.value)}),e.string(t.name,20),e.u16(t.level),e.array(t.statusEffectDatas,{maxLen:80,lenType:"u16"},a=>{U(e,a)}),e.u64(t.characterId),e.f32(t.gearLevel),e.u64(t.playerId),e.u16(t.classId)}var Wa="InitPC";function Ua(e,t){let a={};return a.statPair=e.array(e.u16(),()=>{let n={};return n.statType=e.u8(),n.value=I(e,t),n},152),a.statusEffectDatas=e.array(e.u16(),()=>W(e,t),80),a.addonSkillFeatureList=e.array(e.u16(),()=>{let n={};return n.addonSkillFeatureIdList=e.array(e.u16(),()=>e.u32(),5),n.skillId=e.u32(),n},200),a.abilityDataList=e.array(e.u16(),()=>St(e,t),100),a}function Va(e,t){e.array(t.statPair,{maxLen:152,lenType:"u16"},a=>{e.u8(a.statType),w(e,a.value)}),e.array(t.statusEffectDatas,{maxLen:80,lenType:"u16"},a=>{U(e,a)}),e.array(t.addonSkillFeatureList,{maxLen:200,lenType:"u16"},a=>{e.array(a.addonSkillFeatureIdList,{maxLen:5,lenType:"u16"},n=>{e.u32(n)}),e.u32(a.skillId)}),e.array(t.abilityDataList,{maxLen:100,lenType:"u16"},a=>{Pt(e,a)})}var Za="InitLocal";function Ha(e,t){let a={};return a.account_CharacterId1=e.u64(),a.serverAddr=e.string(256),a.account_CharacterId2=e.u64(),a}function gt(e,t){e.u64(t.account_CharacterId1),e.string(t.serverAddr,256),e.u64(t.account_CharacterId2)}var za="MigrationExecute";function Ga(e){return e>>20===1?-((~e>>>0)+1&2097151):e}function y(e,t=0){let a=e.u64();return{x:Ga(Number(a&0x1fffffn)),y:Ga(Number(a>>21n&0x1fffffn)),z:Ga(Number(a>>42n&0x1fffffn))}}function F(e,t={x:0,y:0,z:0}){e.u64(BigInt(Math.round(t.x??0)>>>0&2097151)|BigInt(Math.round(t.y??0)>>>0&2097151)<<21n|BigInt(Math.round(t.z??0)>>>0&2097151)<<42n)}function O(e,t=0){return e.u16()*(2*Math.PI)/65536}function nt(e,t=0){e.u16(Math.round(t*65536/(2*Math.PI))%65536)}function We(e,t){let a={};return a.spawnIndex=e.u32(),a.objectId=e.u64(),e.bool()&&(a.transitIndex=e.u32()),a.position=y(e,t),a.statusEffectDatas=e.array(e.u16(),()=>W(e,t),80),a.directionYaw=O(e,t),a.statPair=e.array(e.u16(),()=>{let n={};return n.statType=e.u8(),n.value=I(e,t),n},152),a.typeId=e.u32(),t>=1?(a.level=e.u16(),e.bool()&&(a.balanceLevel=e.u16())):a.level=0,a}function Ue(e,t){e.u32(t.spawnIndex),e.u64(t.objectId),e.bool(t.transitIndex!==void 0)&&e.u32(t.transitIndex),F(e,t.position),e.array(t.statusEffectDatas,{maxLen:80,lenType:"u16"},a=>{U(e,a)}),nt(e,t.directionYaw),e.array(t.statPair,{maxLen:152,lenType:"u16"},a=>{e.u8(a.statType),w(e,a.value)}),e.u32(t.typeId),e.u16(t.level),e.bool(t.balanceLevel!==void 0)&&e.u16(t.balanceLevel)}function Ya(e,t){let a={};return a.npcStruct=We(e,t),a}function $a(e,t){Ue(e,t.npcStruct)}var Qa="NewNpc";function Ja(e,t){let a={};return a.publishReason=e.u8(),a.ownerId=e.u64(),a.npcData=We(e,t),a}function Xa(e,t){e.u8(t.publishReason),e.u64(t.ownerId),Ue(e,t.npcData)}var tn="NewNpcSummon";function ft(e,t){let a={};return a.slot=e.u16(),a.level=e.u16(),a.itemTint=e.bytes(e.u16(),3,14),a.expireTime=j(e),a.id=e.u32(),a}function mt(e,t){e.u16(t.slot),e.u16(t.level),e.bytes(t.itemTint,{maxLen:3,lenType:"u16",multiplier:14}),rt(e,t.expireTime),e.u32(t.id)}function Os(e,t){let a={};return a.maxItemLevel=e.f32(),a.statPair=e.array(e.u16(),()=>{let n={};return n.statType=e.u8(),n.value=I(e,t),n},152),a.name=e.string(20),a.heading=O(e,t),a.characterId=e.u64(),a.playerId=e.u64(),a.addonSkillFeatureList=e.array(e.u16(),()=>{let n={};return n.addonSkillFeatureIdList=e.array(e.u16(),()=>e.u32(),5),n.SkillId=e.u32(),n},200),a.classId=e.u16(),a.level=e.u16(),a.statusEffectDatas=e.array(e.u16(),()=>W(e,t),80),t>=1?(a.avgItemLevel=e.f32(),a.position=y(e),a.equipItemDataList=e.array(e.u16(),()=>ft(e,t),32),a.equipLifeToolDataList=e.array(e.u16(),()=>ft(e,t),9),a.guildName=e.string(20),t>=2?a.guildId=e.u64():a.guildId=BigInt(e.u32())):(a.avgItemLevel=a.maxItemLevel,a.position={x:0,y:0,z:0},a.equipItemDataList=[],a.equipLifeToolDataList=[],a.guildName="",a.guildId=0n),a}function Fs(e,t){e.f32(t.maxItemLevel),e.array(t.statPair,{maxLen:152,lenType:"u16"},a=>{e.u8(a.statType),w(e,a.value)}),e.string(t.name,20),nt(e,t.heading),e.u64(t.characterId),e.u64(t.playerId),e.array(t.addonSkillFeatureList,{maxLen:200,lenType:"u16"},a=>{e.array(a.addonSkillFeatureIdList,{maxLen:5,lenType:"u16"},n=>{e.u32(n)}),e.u32(a.skillId)}),e.u16(t.classId),e.u16(t.level),e.array(t.statusEffectDatas,{maxLen:80,lenType:"u16"},a=>{U(e,a)}),e.f32(t.avgItemLevel),F(e,t.position),e.array(t.equipItemDataList,{maxLen:32,lenType:"u16"},a=>{mt(e,a)}),e.array(t.equipLifeToolDataList,{maxLen:9,lenType:"u16"},a=>{mt(e,a)}),e.string(t.guildName,20),e.u64(t.guildId)}function an(e,t){let a={};return a.pcStruct=Os(e,t),a}function nn(e,t){Fs(e,t.pcStruct)}var on="NewPC";function Tt(e,t=0){return{first:e.u8(),second:e.u8(),third:e.u8()}}function Ve(e,t){e.u8(t.first),e.u8(t.second),e.u8(t.third)}function It(e,t=0){return{first:e.u16(),second:e.u16(),third:e.u16()}}function Ze(e,t){e.u16(t.first),e.u16(t.second),e.u16(t.third)}function qs(e,t){let a={};return a.tripodIndex=Tt(e,t),a.chainSkillEffect=e.u32(),a.skillEffect=e.u32(),a.skillId=e.u32(),a.targetObjectId=e.u64(),a.ownerId=e.u64(),a.skillLevel=e.u8(),a.projectileId=e.u64(),a.tripodLevel=It(e,t),a}function Ws(e,t){Ve(e,t.tripodIndex),e.u32(t.chainSkillEffect),e.u32(t.skillEffect),e.u32(t.skillId),e.u64(t.targetObjectId),e.u64(t.ownerId),e.u8(t.skillLevel),e.u64(t.projectileId),Ze(e,t.tripodLevel)}function un(e,t){let a={};return a.projectileInfo=qs(e,t),a}function fn(e,t){Ws(e,t.projectileInfo)}var mn="NewProjectile";function ln(e,t){let a={};return a.enable=e.bool(),a.paralyzationPoint=e.u32(),a.decreasePoint=e.u32(),a.paralyzationMaxPoint=e.u32(),a.noHitCheckTime=e.u32(),a.hitCheckTime=e.u32(),a.objectId=e.u64(),a}function cn(e,t){e.bool(t.enable),e.u32(t.paralyzationPoint),e.u32(t.decreasePoint),e.u32(t.paralyzationMaxPoint),e.u32(t.noHitCheckTime),e.u32(t.hitCheckTime),e.u64(t.objectId)}var dn="ParalyzationStateNotify";function Us(e,t){let a={};return a.maxHp=I(e,t),a.characterId=e.u64(),a.position=y(e,t),a.transitIndex=e.u32(),a.curHp=I(e,t),a.characterLevel=e.u16(),a.gearLevel=e.f32(),a.zoneId=e.u32(),a.partyMemberNumber=e.u8(),a.name=e.string(20),a.zoneInstId=e.u64(),a.worldId=e.u8(),a.classId=e.u16(),a.auths=e.u8(),a}function Vs(e,t){w(e,t.maxHp),e.u64(t.characterId),F(e,t.position),e.u32(t.transitIndex),w(e,t.curHp),e.u16(t.characterLevel),e.f32(t.gearLevel),e.u32(t.zoneId),e.u8(t.partyMemberNumber),e.string(t.name,20),e.u64(t.zoneInstId),e.u8(t.worldId),e.u16(t.classId),e.u8(t.auths)}function pn(e,t){let a={};return a.raidInstanceId=e.u32(),a.lootGrade=e.u32(),a.partyType=e.u8(),a.partyInstanceId=e.u32(),a.partyLootType=e.u8(),a.memberDatas=e.array(e.u16(),()=>Us(e,t),40),a}function _n(e,t){e.u32(t.raidInstanceId),e.u32(t.lootGrade),e.u8(t.partyType),e.u32(t.partyInstanceId),e.u8(t.partyLootType),e.array(t.memberDatas,{maxLen:40,lenType:"u16"},a=>{Vs(e,a)})}var bn="PartyInfo";function hn(e,t){let a={};return a.partyLeaveType=e.u8(),a.partyInstanceId=e.u32(),a.name=e.string(20),a}function Sn(e,t){e.u8(t.partyLeaveType),e.u32(t.partyInstanceId),e.string(t.name,20)}var Pn="PartyLeaveResult";function kn(e,t){let a={};return a.objectId=e.u64(),a.passiveStatusEffectList=e.array(e.u16(),()=>e.u32(),10),a.unk0_m=e.u8(),a}function Tn(e,t){e.u64(t.objectId),e.array(t.passiveStatusEffectList,{maxLen:10,lenType:"u16"},a=>{e.u32(a)}),e.u8(t.unk0_m)}var In="PartyPassiveStatusEffectAddNotify";function En(e,t){let a={};return a.objectId=e.u64(),a.passiveStatusEffectList=e.array(e.u16(),()=>e.u32(),10),a}function vn(e,t){e.u64(t.objectId),e.array(t.passiveStatusEffectList,{maxLen:10,lenType:"u16"},a=>{e.u32(a)})}var xn="PartyPassiveStatusEffectRemoveNotify";function Nn(e,t){let a={};return a.characterId=e.u64(),a.statusEffectDatas=e.array(e.u16(),()=>W(e,t),80),a.playerIdOnRefresh=e.u64(),a}function Dn(e,t){e.u64(t.characterId),e.array(t.statusEffectDatas,{maxLen:80,lenType:"u16"},a=>{U(e,a)}),e.u64(t.playerIdOnRefresh)}var yn="PartyStatusEffectAddNotify";function Rn(e,t){let a={};return a.characterId=e.u64(),a.statusEffectIds=e.array(e.u16(),()=>e.u32(),80),a.reason=e.u8(),a}function gn(e,t){e.u64(t.characterId),e.array(t.statusEffectIds,{maxLen:80,lenType:"u16"},a=>{e.u32(a)}),e.u8(t.reason)}var Ln="PartyStatusEffectRemoveNotify";function Kn(e,t){let a={};return a.partyInstanceId=e.u32(),a.raidInstanceId=e.u32(),a.characterId=e.u64(),a}function An(e,t){e.u32(t.partyInstanceId),e.u32(t.raidInstanceId),e.u64(t.characterId)}var wn="PartyStatusEffectResultNotify";function Bn(e,t){let a={};return a.passiveStatusEffectList=e.array(e.u16(),()=>e.u32(),10),a}function Cn(e,t){e.array(t.passiveStatusEffectList,{maxLen:10,lenType:"u16"},a=>{e.u32(a)})}var Mn="PassiveStatusEffectAddNotify";function jn(e,t){let a={};return a.passiveStatusEffectList=e.array(e.u16(),()=>e.u32(),10),a}function On(e,t){e.array(t.passiveStatusEffectList,{maxLen:10,lenType:"u16"},a=>{e.u32(a)})}var Fn="PassiveStatusEffectRemoveNotify";function qn(e,t){return{}}function Wn(e,t){}var Un="RaidBossKillNotify";function Vn(e,t){return{}}function Zn(e,t){}var Hn="RaidResult";function Zs(e,t){let a={};return a.unpublishReason=e.u8(),a.objectId=e.u64(),a}function Hs(e,t){e.u8(t.unpublishReason),e.u64(t.objectId)}function zn(e,t){let a={};return a.unpublishedObjects=e.array(e.u16(),()=>Zs(e,t),200),a}function Gn(e,t){e.array(t.unpublishedObjects,{maxLen:200,lenType:"u16"},a=>{Hs(e,a)})}var Yn="RemoveObject";function He(e,t=0){let a={},n=e.u8();return n&1&&(a.moveTime=e.u32()),n&2&&(a.standUpTime=e.u32()),n&4&&(a.downTime=e.u32()),n&8&&(a.freezeTime=e.u32()),n&16&&(a.moveHeight=e.u32()),n&32&&(a.farmostDist=e.u32()),n&64&&(a.flag40=e.bytes(e.u16(),6)),a}function zs(e,t){let a=(t.moveTime===void 0?0:1)|(t.standUpTime===void 0?0:2)|(t.downTime===void 0?0:4)|(t.freezeTime===void 0?0:8)|(t.moveHeight===void 0?0:16)|(t.farmostDist===void 0?0:32)|(t.flag40===void 0?0:64);e.u8(a),a&1&&e.u32(t.moveTime),a&2&&e.u32(t.standUpTime),a&4&&e.u32(t.downTime),a&8&&e.u32(t.freezeTime),a&16&&e.u32(t.moveHeight),a&32&&e.u32(t.farmostDist),a&64&&e.bytes(t.flag40,{maxLen:6,lenType:"u16"})}function ze(e,t){let a={};return a.modifier=e.u8(),a.targetId=e.u64(),a.damageType=e.u8(),e.bool()&&(a.damageAttr=e.u8()),a.curHp=I(e,t),a.unk3_m=e.u16(),a.maxHp=I(e,t),a.damage=I(e,t),a}function Ge(e,t){e.u8(t.modifier),e.u64(t.targetId),e.u8(t.damageType),e.bool(t.damageAttr!==void 0)&&e.u8(t.damageAttr),w(e,t.curHp),e.u16(t.unk3_m),w(e,t.maxHp),w(e,t.damage)}function $s(e,t){let a={};return a.skillMoveOptionData=He(e,t),a.destination=y(e,t),a.position=y(e,t),a.skillDamageEvent=ze(e,t),a}function Qs(e,t){zs(e,t.skillMoveOptionData),F(e,t.destination),F(e,t.position),Ge(e,t.skillDamageEvent)}function $n(e,t){let a={};return a.skillId=e.u32(),a.skillDamageAbnormalMoveEvents=e.array(e.u16(),()=>$s(e,t),50),a.skillEffectId=e.u32(),a.sourceId=e.u64(),a}function Qn(e,t){e.u32(t.skillId),e.array(t.skillDamageAbnormalMoveEvents,{maxLen:50,lenType:"u16"},a=>{Qs(e,a)}),e.u32(t.skillEffectId),e.u64(t.sourceId)}var Jn="SkillDamageAbnormalMoveNotify";function Xn(e,t){let a={};return a.skillLevel=e.u8(),a.sourceId=e.u64(),a.skillId=e.u32(),a.skillDamageEvents=e.array(e.u16(),()=>ze(e,t),50),a.skillEffectId=e.u32(),a}function ti(e,t){e.u8(t.skillLevel),e.u64(t.sourceId),e.u32(t.skillId),e.array(t.skillDamageEvents,{maxLen:50,lenType:"u16"},a=>{Ge(e,a)}),e.u32(t.skillEffectId)}var ei="SkillDamageNotify";function ai(e,t){let a={};return a.sourceId=e.u64(),a.skillId=e.u32(),a.stage=e.u8(),a}function ni(e,t){e.u64(t.sourceId),e.u32(t.skillId),e.u8(t.stage)}var ii="SkillStageNotify";function Ye(e,t=0){let a={},n=e.u8();return n&1&&(a.layerIndex=e.u8()),n&2&&(a.startStageIndex=e.u8()),n&4&&(a.transitIndex=e.u32()),n&8&&(a.stageStartTime=e.u32()),n&16&&(a.farmostDistance=e.u32()),n&32&&(a.tripodIndex=Tt(e)),n&64&&(a.tripodLevel=It(e)),a}function Js(e,t){let a=(t.layerIndex===void 0?0:1)|(t.startStageIndex===void 0?0:2)|(t.transitIndex===void 0?0:4)|(t.stageStartTime===void 0?0:8)|(t.farmostDistance===void 0?0:16)|(t.tripodIndex===void 0?0:32)|(t.tripodLevel===void 0?0:64);e.u8(a),a&1&&e.u8(t.layerIndex),a&2&&e.u8(t.startStageIndex),a&4&&e.u32(t.transitIndex),a&8&&e.u32(t.stageStartTime),a&16&&e.u32(t.farmostDistance),a&32&&Ve(e,t.tripodIndex),a&64&&Ze(e,t.tripodLevel)}function oi(e,t){let a={};return a.sourceId=e.u64(),a.curDirectionYaw=O(e,t),a.newDirectionYaw=O(e,t),a.aimTargetPosition=y(e,t),e.bool()&&(a.pitchRotation=O(e,t)),e.bool()&&(a.aiStateId=e.u32()),a.curPosition=y(e,t),e.bool()&&(a.unk1_m=e.u32()),a.skillLevel=e.u8(),a.newPosition=y(e,t),a.skillId=e.u32(),a.skillOptionData=Ye(e,t),a}function ri(e,t){e.u64(t.sourceId),nt(e,t.curDirectionYaw),nt(e,t.newDirectionYaw),F(e,t.aimTargetPosition),e.bool(t.pitchRotation!==void 0)&&nt(e,t.pitchRotation),e.bool(t.aiStateId!==void 0)&&e.u32(t.aiStateId),F(e,t.curPosition),e.bool(t.unk1_m!==void 0)&&e.u32(t.unk1_m),e.u8(t.skillLevel),F(e,t.newPosition),e.u32(t.skillId),Js(e,t.skillOptionData)}var si="SkillStartNotify";function ui(e,t){let a={};return a.statusEffectData=W(e,t),a.objectId=e.u64(),a.new=e.bool(),a}function fi(e,t){U(e,t.statusEffectData),e.u64(t.objectId),e.bool(t.new)}var mi="StatusEffectAddNotify";function li(e,t){let a={};return a.statusEffectIds=e.array(e.u16(),()=>e.u32(),80),a.objectId=e.u64(),a.reason=e.u8(),a}function ci(e,t){e.array(t.statusEffectIds,{maxLen:80,lenType:"u16"},a=>{e.u32(a)}),e.u64(t.objectId),e.u8(t.reason)}var di="StatusEffectRemoveNotify";function pi(e,t){let a={};return a.effectInstanceId=e.u32(),a.targetId=e.u64(),a.expirationTick=e.u64(),a}function _i(e,t){e.u32(t.effectInstanceId),e.u64(t.targetId),e.u64(t.expirationTick)}var bi="StatusEffectDurationNotify";function hi(e,t){let a={};return a.objectId=e.u64(),a.effectInstanceId=e.u32(),a.characterId=e.u64(),a.value=e.u32(),a}function Si(e,t){e.u64(t.objectId),e.u32(t.effectInstanceId),e.u64(t.characterId),e.u32(t.value)}var Pi="StatusEffectSyncDataNotify";function ki(e,t){let a={};return a.step=e.u32(),a.unk2_m=e.bool(),a.triggerId=e.u32(),a}function Ti(e,t){e.u32(t.step),e.bool(t.unk2_m),e.u32(t.triggerId)}var Ii="TriggerBossBattleStatus";function Ei(e,t){let a={};return a.packetResultCode=e.u32(),a.triggerId=e.u32(),a.unk0_m=e.u32(),a.involvedPCs=e.array(e.u16(),()=>e.u64(),40),a}function vi(e,t){e.u32(t.packetResultCode),e.u32(t.triggerId),e.u32(t.unk0_m),e.array(t.involvedPCs,{maxLen:40,lenType:"u16"},a=>{e.u64(a)})}var xi="TriggerFinishNotify";function Ni(e,t){let a={};return a.triggerId=e.u32(),a.triggerSignalType=e.u32(),a.sourceId=e.u64(),a.involvedPCs=e.array(e.u16(),()=>e.u64(),40),a}function Di(e,t){e.u32(t.triggerId),e.u32(t.triggerSignalType),e.u64(t.sourceId),e.array(t.involvedPCs,{maxLen:40,lenType:"u16"},a=>{e.u64(a)})}var yi="TriggerStartNotify";function Ri(e,t){let a={};return a.maxHp=I(e,t),a.characterId=e.u64(),a.unk0_m=e.u32(),a.statusEffectDatas=e.array(e.u16(),()=>W(e,t),80),a.position=e.u64(),a.curHp=I(e,t),a}function gi(e,t){w(e,t.maxHp),e.u64(t.characterId),e.u32(t.unk0_m),e.array(t.statusEffectDatas,{maxLen:80,lenType:"u16"},a=>{U(e,a)}),e.u64(t.position),w(e,t.curHp)}var Li="TroopMemberUpdateMinNotify";function Ki(e,t){let a={};return a.identityGauge1=e.u32(),a.identityGauge2=e.u32(),a.identityGauge3=e.u32(),a.playerId=e.u64(),a}function Ai(e,t){e.u32(t.identityGauge1),e.u32(t.identityGauge2),e.u32(t.identityGauge3),e.u64(t.playerId)}var wi="IdentityGaugeChangeNotify";function Bi(e,t){let a={};return a.objectId=e.u64(),a}function Ci(e,t){e.u64(t.objectId)}var Mi="ZoneObjectUnpublishNotify";function tu(e,t){let a={};return a.stackCount=e.u8(),a.target=e.u8(),a.id=e.u32(),a}function eu(e,t){e.u8(t.stackCount),e.u8(t.target),e.u32(t.id)}function ji(e,t){let a={};return a.zoneStatusEffectDataList=e.array(e.u16(),()=>tu(e,t),4),a}function Oi(e,t){e.array(t.zoneStatusEffectDataList,{maxLen:4,lenType:"u16"},a=>{eu(e,a)})}var Fi="ZoneStatusEffectAddNotify";function qi(e,t){let a={};return a.statusEffectId=e.u32(),a}function Wi(e,t){e.u32(t.statusEffectId)}var Ui="ZoneStatusEffectRemoveNotify";function Vi(e,t){let a={};return a.skillLevel=e.u8(),a.caster=e.u64(),a.skillId=e.u32(),a}function Zi(e,t){e.u8(t.skillLevel),e.u64(t.caster),e.u32(t.skillId)}var Hi="SkillCastNotify";function zi(e,t){let a={};return a.objectId=e.u64(),a.stance=e.u8(),a}function Gi(e,t){e.u64(t.objectId),e.u8(t.stance)}var Yi="IdentityStanceChangeNotify";function $i(e,t){let a={};return a.objectId=e.u64(),a.equipItemDataList=e.array(e.u16(),()=>ft(e,t),32),a}function Qi(e,t){e.u64(t.objectId),e.array(t.equipItemDataList,{maxLen:32,lenType:"u16"},a=>{mt(e,a)})}var Ji="EquipChangeNotify";function Xi(e,t){let a={};return a.objectId=e.u64(),a.equipLifeToolDataList=e.array(e.u16(),()=>ft(e,t),9),a}function to(e,t){e.u64(t.objectId),e.array(t.equipLifeToolDataList,{maxLen:9,lenType:"u16"},a=>{mt(e,a)})}var eo="EquipLifeToolChangeNotify";function au(e,t){let a={};return e.bool()&&(a.serialNumber=e.u64(),a.id=e.u32(),a.level=e.u16(),a.slot=e.u16(),a.durability=e.u32(),a.unk1_6_m=e.u32(),a.flag=e.u32(),a.expireTime=j(e),a.lockUpdateTime=j(e)),a}function nu(e,t){e.bool(t.slot!==void 0)&&(e.u64(t.serialNumber),e.u32(t.id),e.u16(t.level),e.u16(t.slot),e.u32(t.durability),e.u32(t.unk1_6_m),e.u32(t.flag),rt(e,t.expireTime),rt(e,t.lockUpdateTime))}function ao(e,t){let a={};return a.itemDataList=e.array(e.u16(),()=>au(e,t),80),a.storageType=e.u8(),a}function no(e,t){e.array(t.storageType===1?t.itemDataList:[],{maxLen:80,lenType:"u16"},a=>{nu(e,a)}),e.u8(t.storageType)}var io="InitItem";function iu(e,t){let a={};return a.npcId=e.u32(),a.isDead=e.bool(),a}function ou(e,t){e.u32(t.npcId),e.bool(t.isDead)}function oo(e,t){let a={};return a.raidResult=e.u8(),a.raidId=e.u32(),a.totalTime=e.u64(),a.bossKillDataList=e.array(e.u16(),()=>iu(e,t),3),a.endTick=e.u64(),a.startTick=e.u64(),a}function ro(e,t){e.u8(t.raidResult),e.u32(t.raidId),e.u64(t.totalTime),e.array(t.bossKillDataList,{maxLen:3,lenType:"u16"},a=>{ou(e,a)}),e.u64(t.endTick),e.u64(t.startTick)}var so="RaidBegin";function uo(e,t){let a={};return a.zoneInstId=e.u64(),a.zoneId=e.u32(),a.loadComplete=e.bool(),a.completeMembers=e.array(e.u16(),()=>e.u64(),40),a.totalMembers=e.array(e.u16(),()=>e.u64(),40),a.firstPCEnterTick=e.u64(),a.zoneLevel=e.u8(),a}function fo(e,t){e.u64(t.zoneInstId),e.u32(t.zoneId),e.bool(t.loadComplete),e.array(t.completeMembers,{maxLen:40,lenType:"u16"},a=>{e.u64(a)}),e.array(t.totalMembers,{maxLen:40,lenType:"u16"},a=>{e.u64(a)}),e.u64(t.firstPCEnterTick),e.u8(t.zoneLevel)}var mo="ZoneMemberLoadStatusNotify";function ru(e,t){let a={};return a.position=y(e),a.objectId=e.u64(),a.ownerId=e.u64(),a.skillId=e.u32(),a.skillEffect=e.u32(),a}function su(e,t){F(e,t.position),e.u64(t.objectId),e.u64(t.ownerId),e.u32(t.skillId),e.u32(t.skillEffect)}function lo(e,t){let a={};return a.trapData=ru(e,t),a}function co(e,t){su(e,t.trapData)}var po="NewTrap";function _o(e,t){let a={};return a.players=e.array(e.u8(),()=>{let n={};return n.name=e.string(20),n.stats=e.array(e.u8(),()=>{let r={};return r.id=e.u8(),r.value=e.u32(),r},100),n},24),a}function bo(e,t){e.array(t.players,{maxLen:24,lenType:"u8"},a=>{e.string(a.name,20),e.array(a.stats,{maxLen:100,lenType:"u8"},n=>{e.u8(n.id),e.u32(n.value)})})}var ho="APP_StatApi";var $e=new Map([[0,[ha,_a,ba]],[1,[ka,Sa,Pa]],[2,[Ea,Ta,Ia]],[4,[Na,va,xa]],[5,[Ra,Da,ya]],[6,[Ka,ga,La]],[7,[Ba,Aa,wa]],[8,[ja,Ca,Ma]],[9,[Wa,Fa,qa]],[10,[Za,Ua,Va]],[11,[za,Ha,gt]],[12,[Qa,Ya,$a]],[13,[tn,Ja,Xa]],[14,[on,an,nn]],[15,[mn,un,fn]],[16,[dn,ln,cn]],[17,[bn,pn,_n]],[18,[Pn,hn,Sn]],[19,[In,kn,Tn]],[20,[xn,En,vn]],[21,[yn,Nn,Dn]],[22,[Ln,Rn,gn]],[23,[wn,Kn,An]],[24,[Mn,Bn,Cn]],[25,[Fn,jn,On]],[26,[Un,qn,Wn]],[27,[Hn,Vn,Zn]],[28,[Yn,zn,Gn]],[29,[Jn,$n,Qn]],[30,[ei,Xn,ti]],[31,[ii,ai,ni]],[32,[si,oi,ri]],[34,[mi,ui,fi]],[35,[di,li,ci]],[36,[bi,pi,_i]],[37,[Pi,hi,Si]],[38,[Ii,ki,Ti]],[39,[xi,Ei,vi]],[40,[yi,Ni,Di]],[41,[Li,Ri,gi]],[42,[wi,Ki,Ai]],[43,[Mi,Bi,Ci]],[44,[Fi,ji,Oi]],[45,[Ui,qi,Wi]],[46,[Hi,Vi,Zi]],[47,[Yi,zi,Gi]],[48,[Ji,$i,Qi]],[49,[eo,Xi,to]],[50,[io,ao,no]],[52,[so,oo,ro]],[51,[mo,uo,fo]],[53,[po,lo,co]],[6e4,[ho,_o,bo]]]);var J,it,Kt,Po=class{constructor(t,a,n){$(this,J,void 0);$(this,it,void 0);$(this,Kt,void 0);G(this,"ip");G(this,"zoneSyncStatus",0);G(this,"cache",new Map);n&&et(this,J,n),et(this,it,t),et(this,Kt,a)}syncData(){let t=[];D(this,it).entities.forEach(a=>{a.entityType===1&&t.push(a)}),this.getPlayersData(t)}getPlayersData(t,a=0){if(a>24){t.forEach(r=>{let o=this.cache.get(r.name);o&&o.status===1?o.status=0:o||this.cache.set(r.name,{hash:"",status:0,info:{name:r.name,stats:[]}})});return}if(!this.isCurrentZoneValid()){t.forEach(r=>{let o=this.cache.get(r.name);o&&o.status===1&&this.cache.delete(r.name)});return}if(!D(this,J)||!this.ip)return;let n={};t.forEach(r=>{let o=this.getHash(r),i=this.cache.get(r.name);if(!o){i&&i.status===1&&this.cache.delete(r.name);return}i&&(i.status===0||a===0&&i.status===1||i.status===2&&i.hash===o)||(i?(i.hash=o,i.status=1):i={hash:o,status:1,info:{name:r.name,stats:[]}},this.cache.set(r.name,i),n[r.name]=o)}),Object.keys(n).length!==0&&fu.default.get(`${Po.baseUrl}/req2`,{params:{ip:this.ip,ci:D(this,Kt),...n}}).then(r=>{if(r.status===200&&D(this,J))try{let o=r.data,i=$e.get(6e4);if(i){let[f,p,l]=i,S={players:o};if(t=t.filter(b=>!o.find(T=>T.name===b.name)),t.length>0&&setTimeout(()=>{t=t.map(b=>D(this,it).getEntityByName(b.name)).filter(b=>b!==void 0&&b.entityType===1),this.getPlayersData(t,a+1)},1e4),S.players.length>0){let b=new at(S,6e4,l);D(this,J).emit(f,b),D(this,J).emit("*",f,b),D(this,J).appendLog(b)}}}catch{setTimeout(()=>{t=t.map(i=>D(this,it).getEntityByName(i.name)).filter(i=>i!==void 0&&i.entityType===1),this.getPlayersData(t,a+5)},1e4)}}).catch(r=>{setTimeout(()=>{t=t.map(o=>D(this,it).getEntityByName(o.name)).filter(o=>o!==void 0&&o.entityType===1),this.getPlayersData(t,a+5)},1e4)})}getHash(t){if(!t.items.equipList||t.characterId===0n||!t.class||t.name==="You")return;let a=new Array(32).fill(0);t.items.equipList?.forEach(r=>{a[r.slot]=r.id});let n=`${t.name}${t.class}${t.characterId}${a.join("")}`;return(0,uu.createHash)("md5").update(n).digest("hex")}updatePlayerStats(t){t.forEach(a=>{let n=this.cache.get(a.name);n?(n.info=a,n.status=2):this.cache.set(a.name,{hash:"",status:2,info:a})})}getStats(t){if(!this.isCurrentZoneValid())return;let a=this.cache.get(t);if(a&&a.status===2)return a.info.stats}isCurrentZoneValid(){return this.zoneSyncStatus!==0&&(this.zoneSyncStatus&10)===0}},Lt=Po;J=new WeakMap,it=new WeakMap,Kt=new WeakMap,G(Lt,"baseUrl","https://la.herysia.com");var hf={isLive:!0,dontResetOnZoneChange:!1,resetAfterPhaseTransition:!1,splitOnPhaseTransition:!1},Qe=class extends mu.TypedEmitter{#t;encounters;#n;#r;#i;#a;options;resetTimer;phaseTransitionResetRequest;phaseTransitionResetRequestTime;#e;constructor(t,a,n,r,o){super(),this.#n=t,this.#r=a,this.#i=n,this.#a=r,this.options={...hf,...o},this.resetTimer=null,this.phaseTransitionResetRequest=!1,this.phaseTransitionResetRequestTime=0,this.#e=new Map,this.encounters=[],this.#t={startedOn:0,lastCombatPacket:0,fightStartedOn:0,localPlayer:this.#n.localPlayer.name,currentBoss:void 0,entities:new Map,damageStatistics:{totalDamageDealt:0,topDamageDealt:0,totalDamageTaken:0,topDamageTaken:0,totalHealingDone:0,topHealingDone:0,totalShieldDone:0,topShieldDone:0,debuffs:new Map,buffs:new Map,topShieldGotten:0,totalEffectiveShieldingDone:0,topEffectiveShieldingDone:0,topEffectiveShieldingUsed:0,effectiveShieldingBuffs:new Map,appliedShieldingBuffs:new Map}}}onCounterAttack(t,a){let n=this.updateEntity(t,{},a);n.hits.counter+=1}onInitEnv(t,a){this.options.isLive?(this.#t.entities.forEach((n,r,o)=>{n.hits.total===0&&o.delete(r)}),this.options.dontResetOnZoneChange===!1&&this.resetTimer===null&&(this.resetTimer=setTimeout(()=>{this.resetState(+a+6e3)},6e3),this.emit("message","new-zone"))):(this.splitEncounter(a),this.emit("message","new-zone"))}splitEncounter(t){if(this.#t.fightStartedOn!==0&&(this.#t.damageStatistics.totalDamageDealt!==0||this.#t.damageStatistics.totalDamageTaken!==0)){let a=structuredClone(this.#t);a.entities.forEach(n=>{n.isPlayer&&(n.statApiValid=this.#i.isCurrentZoneValid()&&this.#i.cache.get(n.name)?.status===2)}),a.localPlayer=this.#n.localPlayer.name,this.applyBreakdowns(a.entities),this.encounters.push(a)}this.resetState(+t)}getBossIfStillExist(){if(this.#t.currentBoss?.id){let t=BigInt(`0x0${this.#t.currentBoss?.id}`);return this.#n.entities.has(t)?this.#t.currentBoss:void 0}}resetState(t){this.cancelReset(),this.resetBreakdowns(),this.#t={startedOn:+t,lastCombatPacket:+t,fightStartedOn:0,localPlayer:this.#n.localPlayer.name,currentBoss:this.getBossIfStillExist(),entities:new Map,damageStatistics:{totalDamageDealt:0,topDamageDealt:0,totalDamageTaken:0,topDamageTaken:0,totalHealingDone:0,topHealingDone:0,totalShieldDone:0,topShieldDone:0,debuffs:new Map,buffs:new Map,appliedShieldingBuffs:new Map,effectiveShieldingBuffs:new Map,topEffectiveShieldingDone:0,topEffectiveShieldingUsed:0,topShieldGotten:0,totalEffectiveShieldingDone:0}},this.emit("reset-state",this.#t)}cancelReset(){this.resetTimer&&clearTimeout(this.resetTimer),this.resetTimer=null}onPhaseTransition(t,a){this.options.isLive&&(this.emit("message",`phase-transition-${t}`),this.options.resetAfterPhaseTransition&&(this.phaseTransitionResetRequest=!0,this.phaseTransitionResetRequestTime=+a)),!this.options.isLive&&this.options.splitOnPhaseTransition&&this.splitEncounter(a)}updateOptions(t){this.options={...this.options,...t}}onDeath(t,a){let n=this.#t.entities.get(t.name),r=0;n?n.isDead?r=n.deaths:r=n.deaths+1:r=1,this.updateEntity(t,{isDead:!0,deathTime:+a,deaths:r},a)}onDamage(t,a,n,r,o,i){if((r.modifier&15)===11&&r.skillId===0&&r.skillEffectId===0)return;this.phaseTransitionResetRequest&&this.phaseTransitionResetRequestTime>0&&this.phaseTransitionResetRequestTime<+i-8e3&&(this.resetState(+i),this.phaseTransitionResetRequest=!1);let[f,p]=this.#r.getStatusEffects(t,n,this.#n.localPlayer.characterId,i);if(this.#a.isBattleItem(r.skillEffectId,"attack")&&a&&a.entityType===5){let A=a;r.skillEffectId=A.skillEffectId}let l=this.updateEntity(t,{},i),S=this.updateEntity(n,{currentHp:r.targetCurHp,maxHp:r.targetMaxHp},i);if(!l||!S)return;!S.isPlayer&&r.targetCurHp<0&&(r.damage=r.damage+r.targetCurHp);let b=r.skillId;r.skillId===0&&r.skillEffectId!==0&&(b=r.skillEffectId);let T=l.skills.get(b);T||(T={...this.createEntitySkill(),id:b,...this.getSkillNameIcon(r.skillId,r.skillEffectId)},l.skills.set(b,T));let Z=r.modifier&15,L=(r.modifier>>4&7)-1,M=(Z&9)!==0,Y=new Set,B=new Set;f.forEach(([A])=>{Y.add(A)}),p.forEach(([A])=>{B.add(A)}),T.damageInfo.damageDealt+=r.damage,r.damage>T.maxDamage&&(T.maxDamage=r.damage),l.hits.total+=1,T.hits.total+=1,l.damageInfo.damageDealt+=r.damage,S.damageTaken+=r.damage;let Le=M?1:0;l.hits.crit+=Le,T.hits.crit+=Le;let Ke=!1,Ae=!1,we=this.#a.getSkillEffectDirectionalMask(r.skillEffectId)-1;if(we===0||we===2){Ae=L===0;let A=Ae?1:0;l.hits.backAttack+=A,l.hits.totalBackAttack+=1,T.hits.backAttack+=A,T.hits.totalBackAttack+=1}if(we===1||we===2){Ke=L===1;let A=Ke?1:0;l.hits.frontAttack+=A,l.hits.totalFrontAttack+=1,T.hits.frontAttack+=A,T.hits.totalFrontAttack+=1}if(l.isPlayer){this.#t.damageStatistics.totalDamageDealt+=r.damage,this.#t.damageStatistics.topDamageDealt=Math.max(this.#t.damageStatistics.topDamageDealt,l.damageInfo.damageDealt);let A=!1,ct=!1;Y.forEach(c=>{if(!this.#t.damageStatistics.buffs.has(c)){let x=this.#a.getStatusEffectHeaderData(c);x&&this.#t.damageStatistics.buffs.set(c,x)}let K=this.#t.damageStatistics.buffs.get(c);K&&!A&&(A=(K.buffcategory==="classskill"||K.buffcategory==="identity"||K.buffcategory==="ability")&&K.source.skill!==void 0&&K.target===1&&this.#a.isSupportClassId(K.source.skill.classid));let Q=T.damageDealtBuffedBy.get(c)??0;T.damageDealtBuffedBy.set(c,Q+r.damage);let dt=l.damageDealtBuffedBy.get(c)??0;l.damageDealtBuffedBy.set(c,dt+r.damage);let xt=l.hits.hitsBuffedBy.get(c)??0;l.hits.hitsBuffedBy.set(c,xt+1);let R=T.hits.hitsBuffedBy.get(c)??0;T.hits.hitsBuffedBy.set(c,R+1)}),B.forEach(c=>{if(!this.#t.damageStatistics.debuffs.has(c)){let x=this.#a.getStatusEffectHeaderData(c);x&&this.#t.damageStatistics.debuffs.set(c,x)}let K=this.#t.damageStatistics.debuffs.get(c);K&&!ct&&(ct=(K.buffcategory==="classskill"||K.buffcategory==="identity"||K.buffcategory==="ability")&&K.source.skill!==void 0&&K.target===1&&this.#a.isSupportClassId(K.source.skill.classid));let Q=T.damageDealtDebuffedBy.get(c)??0;T.damageDealtDebuffedBy.set(c,Q+r.damage);let dt=l.damageDealtDebuffedBy.get(c)??0;l.damageDealtDebuffedBy.set(c,dt+r.damage);let xt=l.hits.hitsDebuffedBy.get(c)??0;l.hits.hitsDebuffedBy.set(c,xt+1);let R=T.hits.hitsDebuffedBy.get(c)??0;T.hits.hitsDebuffedBy.set(c,R+1)});let Ds=ct?1:0,ys=A?1:0;if(T.damageInfo.damageDealtBuffedBySupport+=A?r.damage:0,T.damageInfo.damageDealtDebuffedBySupport+=ct?r.damage:0,l.damageInfo.damageDealtBuffedBySupport+=A?r.damage:0,l.damageInfo.damageDealtDebuffedBySupport+=ct?r.damage:0,l.hits.hitsBuffedBySupport+=ys,l.hits.hitsDebuffedBySupport+=Ds,T.hits.hitsBuffedBySupport+=ys,T.hits.hitsDebuffedBySupport+=Ds,r.damage>0&&l.isPlayer){let c={multDmg:{sumRate:0,totalRate:1,values:Array()},atkPowSubRate2:{selfSumRate:0,sumRate:0,values:Array()},atkPowSubRate1:{sumRate:0,totalRate:1,values:Array()},skillDamRate:{selfSumRate:0,sumRate:0,values:Array()},atkPowAmplify:{values:Array()},crit:{selfSumRate:0,sumRate:0,values:Array()},critDmgRate:2};if(f.forEach(([R,x,g])=>{let v=this.#n.entities.get(x);if(!v)return;let _=this.getBuffAfterTripods(this.#a.skillBuff.get(R),v,r);if(_){if(_.type==="skill_damage_amplify"&&_.statuseffectvalues&&v.entityType===1&&x!==t.entityId){let k=_.statuseffectvalues[0]??0,h=_.statuseffectvalues[4]??0;if((k===0||k===r.skillId)&&(h===0||h===r.skillEffectId)){let E=_.statuseffectvalues[1]??0;if(E!==0){let N=E/1e4*g;c.multDmg.values.push({casterEntity:v,rate:N}),c.multDmg.sumRate+=N,c.multDmg.totalRate*=1+N}}}else if(_.type==="attack_power_amplify"&&_.statuseffectvalues&&v.entityType===1&&x!==t.entityId){let k=_.statuseffectvalues[0]??0;if(k!==0){let h=k/1e4*g,E=this.#i.getStats(v.name)?.find(tt=>tt.id===4)?.value,N=this.#i.getStats(t.name)?.find(tt=>tt.id===4)?.value;E&&N&&(h*=E/N),c.atkPowAmplify.values.push({casterEntity:v,rate:h})}}_.passiveoption.forEach(k=>{if(ot[k.type]===2){if(k.keystat==="attack_power_sub_rate_2"){let h=k.value;if(h!==0){let E=h/1e4*g;v.entityType===1&&x!==t.entityId?(c.atkPowSubRate2.values.push({casterEntity:v,rate:E}),c.atkPowSubRate2.sumRate+=E):c.atkPowSubRate2.selfSumRate+=E}}else if(k.keystat==="attack_power_sub_rate_1"){let h=k.value;if(h!==0){let E=h/1e4*g;v.entityType===1&&x!==t.entityId&&(c.atkPowSubRate1.values.push({casterEntity:v,rate:E}),c.atkPowSubRate1.sumRate+=E,c.atkPowSubRate1.totalRate*=1+E)}}else if(k.keystat==="skill_damage_rate"){let h=k.value;if(h!==0){let E=h/1e4*g;v.entityType===1&&x!==t.entityId?(c.skillDamRate.values.push({casterEntity:v,rate:E}),c.skillDamRate.sumRate+=E):c.skillDamRate.selfSumRate+=E}}}if(k.keystat==="critical_hit_rate"){let h=k.value;if(h!==0){let E=h/1e4*g;v.entityType===1&&x!==t.entityId?(c.crit.values.push({casterEntity:v,rate:E}),c.crit.sumRate+=E):c.crit.selfSumRate+=E}}if(v.entityType===1&&x!==t.entityId)if(k.keystat==="skill_damage_sub_rate_2"){let h=k.value;if(h!==0){let E=h/1e4*g,N=this.#i.getStats(v.name)?.find(tt=>tt.id===1)?.value??0;switch(v.class){case 204:E*=1+N/.0699*.35/1e4;break;case 105:E*=1+N/.0699*.63/1e4;break;case 602:E*=1+N/.0699*.38/1e4;break;default:break}c.multDmg.values.push({casterEntity:v,rate:E}),c.multDmg.sumRate+=E,c.multDmg.totalRate*=1+E}}else k.keystat==="critical_dam_rate"&&_.category==="buff"&&(c.critDmgRate+=k.value/1e4*g);else if(ot[k.type]===4){let h=this.#a.combatEffect.get(k.keyindex);c.critDmgRate+=g*this.getCritMultiplierFromCombatEffect(h,{self:t,target:n,caster:v,skill:this.#a.skill.get(b),hitOption:L,targetCount:o})}})}}),p.forEach(([R,x,g])=>{let v=this.#n.entities.get(x);if(!v)return;let _=this.getBuffAfterTripods(this.#a.skillBuff.get(R),v,r);if(_){if(_.type==="instant_stat_amplify"&&_.statuseffectvalues){let k=_.statuseffectvalues[0]??0;if(k!==0){let h=k/1e4*g;v.entityType===1&&x!==t.entityId?(c.crit.values.push({casterEntity:v,rate:h}),c.crit.sumRate+=h):c.crit.selfSumRate+=h}}if(!(v.entityType!==1||x===t.entityId)){if(_.type==="instant_stat_amplify"&&_.statuseffectvalues){let k=_.statuseffectvalues[0]??0;if(r.damageType===0){let h=_.statuseffectvalues[2]??0;if(h!==0){let N=-(h/1e4)*g*.5;c.multDmg.values.push({casterEntity:v,rate:N}),c.multDmg.sumRate+=N,c.multDmg.totalRate*=1+N}let E=_.statuseffectvalues[7]??0;if(E!==0){let N=E/1e4*g;c.multDmg.values.push({casterEntity:v,rate:N}),c.multDmg.sumRate+=N,c.multDmg.totalRate*=1+N}}else if(r.damageType===1){let h=_.statuseffectvalues[3]??0;if(h!==0){let N=-(h/1e4)*g*.5;c.multDmg.values.push({casterEntity:v,rate:N}),c.multDmg.sumRate+=N,c.multDmg.totalRate*=1+N}let E=_.statuseffectvalues[8]??0;if(E!==0){let N=E/1e4*g;c.multDmg.values.push({casterEntity:v,rate:N}),c.multDmg.sumRate+=N,c.multDmg.totalRate*=1+N}}}if(_.type==="skill_damage_amplify"&&_.statuseffectvalues){let k=_.statuseffectvalues[0]??0,h=_.statuseffectvalues[4]??0;if((k===0||k===r.skillId)&&(h===0||h===r.skillEffectId)){let E=_.statuseffectvalues[1]??0;if(E!==0){let N=E/1e4*g;c.multDmg.values.push({casterEntity:v,rate:N}),c.multDmg.sumRate+=N,c.multDmg.totalRate*=1+N}}}if(_.type==="directional_attack_amplify"&&_.statuseffectvalues){if(Ke){let k=_.statuseffectvalues[0]??0;if(k!==0){let h=k/100*g;c.multDmg.values.push({casterEntity:v,rate:h}),c.multDmg.sumRate+=h,c.multDmg.totalRate*=1+h}}if(Ae){let k=_.statuseffectvalues[4]??0;if(k!==0){let h=k/100*g;c.multDmg.values.push({casterEntity:v,rate:h}),c.multDmg.sumRate+=h,c.multDmg.totalRate*=1+h}}}}}}),c.crit.values.length>0){let R=this.#a.skill.get(r.skillId);t.itemSet?.forEach(x=>{if(ot[x.type]===2&&bt[x.keystat]===76)c.critDmgRate+=x.value/1e4;else if(ot[x.type]===4){let g=this.#a.combatEffect.get(x.keyindex);c.critDmgRate+=this.getCritMultiplierFromCombatEffect(g,{self:t,target:n,caster:t,skill:R,hitOption:L,targetCount:o})}t.skills.get(r.skillId)?.tripods.forEach(g=>{let v=new Map;g.options.forEach(_=>{let k=Me[_.type];if(k===45){if((_.params[0]??0)===0||r.skillEffectId===(_.params[0]??0)){let h=_.params[1];if(h){let E=this.#a.combatEffect.get(h);E&&v.set(E.id,E)}}}else if(k===46)v.delete(_.params[0]??0);else if(k===104){if((_.params[0]??0)===0||r.skillEffectId===(_.params[0]??0)){let h=v.get(_.params[1]??0);if(h){let E=structuredClone(h);v.set(h.id,E),E.effects.forEach(N=>{N.actions.forEach(tt=>{for(let pt=0;pt<_.params.length-2;pt++)Ce[_.paramtype]===1?tt.args[pt]*=1+(_.params[pt+2]??0)/100:tt.args[pt]+=_.params[pt+2]??0})})}}}else k===29?((_.params[0]??0)===0||r.skillEffectId===(_.params[0]??0))&&(c.critDmgRate+=(_.params[1]??0)/1e4):k===30&&((_.params[0]??0)===0||r.skillEffectId===(_.params[0]??0))&&(c.crit.selfSumRate+=(_.params[1]??0)/1e4)}),v.forEach(_=>{c.critDmgRate+=this.getCritMultiplierFromCombatEffect(_,{self:t,target:n,caster:t,skill:R,hitOption:L,targetCount:o})})})})}if(c.skillDamRate.values.length>0){let R=this.#i.getStats(t.name)?.find(x=>x.id===5)?.value;R&&(c.skillDamRate.selfSumRate+=R/1e4)}let K=0;if(c.crit.values.length>0){c.crit.selfSumRate+=(this.#i.getStats(t.name)?.find(x=>x.id===0)?.value??0)/.2794/1e4;let R=Math.min(Math.max(0,1-c.crit.selfSumRate),c.crit.sumRate);K=(R*c.critDmgRate-R)/(c.crit.selfSumRate*c.critDmgRate-c.crit.selfSumRate+1)}let Q=c.atkPowAmplify.values.length<=0?{rate:0}:c.atkPowAmplify.values.reduce((R,x)=>R.rate>x.rate?R:x),dt=(1+K)*(1+c.atkPowSubRate2.sumRate/(1+c.atkPowSubRate2.selfSumRate))*(1+c.skillDamRate.sumRate/(1+c.skillDamRate.selfSumRate))*(1+Q.rate)*c.multDmg.totalRate*c.atkPowSubRate1.totalRate-1,xt=K+c.atkPowSubRate2.sumRate/(1+c.atkPowSubRate2.selfSumRate)+c.skillDamRate.sumRate/(1+c.skillDamRate.selfSumRate)+Q.rate+(c.multDmg.totalRate-1)+(c.atkPowSubRate1.totalRate-1);{let R=dt*r.damage/(xt*(1+dt)),x=K*R/c.crit.sumRate;c.crit.values.forEach(_=>{let k=_.rate*x,h=this.#t.entities.get(_.casterEntity.name);this.applyRdps(l,h,T,k)}),c.atkPowSubRate2.values.forEach(_=>{let k=_.rate/(1+c.atkPowSubRate2.selfSumRate)*R,h=this.#t.entities.get(_.casterEntity.name);this.applyRdps(l,h,T,k)}),c.skillDamRate.values.forEach(_=>{let k=_.rate/(1+c.skillDamRate.selfSumRate)*R,h=this.#t.entities.get(_.casterEntity.name);this.applyRdps(l,h,T,k)});let g=(c.multDmg.totalRate-1)*R/c.multDmg.sumRate;c.multDmg.values.forEach(_=>{let k=_.rate*g,h=this.#t.entities.get(_.casterEntity.name);this.applyRdps(l,h,T,k)});let v=(c.atkPowSubRate1.totalRate-1)*R/c.atkPowSubRate1.sumRate;if(c.atkPowSubRate1.values.forEach(_=>{let k=_.rate*v,h=this.#t.entities.get(_.casterEntity.name);this.applyRdps(l,h,T,k)}),Q.rate>0){let _=Q.rate*R,k=this.#t.entities.get(Q.casterEntity?.name);this.applyRdps(l,k,T,_)}}}let P={timestamp:+i,damage:r.damage,targetEntity:S.id,isCrit:M,isBackAttack:Ae,isFrontAttack:Ke,isBuffedBySupport:A,isDebuffedBySupport:ct,buffedBy:[...Y],debuffedBy:[...B]},qu=BigInt("0x"+l.id);this.addBreakdown(qu,b,P)}S.isPlayer&&(this.#t.damageStatistics.totalDamageTaken+=r.damage,this.#t.damageStatistics.topDamageTaken=Math.max(this.#t.damageStatistics.topDamageTaken,S.damageTaken)),S.isBoss&&(this.#t.currentBoss=S),this.#t.fightStartedOn===0&&(this.#t.fightStartedOn=+i),this.#t.lastCombatPacket=+i}getBuffAfterTripods(t,a,n){if(!t||a.entityType!==1)return t;let r=structuredClone(t);return a.skills.get(n.skillId)?.tripods.forEach(o=>{o.options.forEach(i=>{let f=Me[i.type];if(f===19){if(((i.params[0]??0)===0||n.skillEffectId===(i.params[0]??0))&&r.id===(i.params[1]??0)){let p=new Map;for(let l=2;l<i.params.length;l+=2)i.params[l]&&i.params[l+1]&&p.set(i.params[l]??0,i.params[l+1]??0);r.passiveoption.forEach(l=>{let S=p.get(bt[l.keystat]);ot[l.type]===2&&S&&(Ce[i.paramtype]===0?l.value+=S:l.value*=1+S/100)})}}else if(f===42){if(((i.params[0]??0)===0||n.skillEffectId===(i.params[0]??0))&&r.id===(i.params[1]??0)){let p=bt[i.params[2]??0],l=i.params[3]??0;p&&l!==void 0&&r.passiveoption.push({type:"stat",keystat:p,keyindex:0,value:l})}}else if(f===21&&r.statuseffectvalues&&((i.params[0]??0)===0||n.skillEffectId===(i.params[0]??0))&&r.id===(i.params[1]??0))if((i.paramtype[2]??0)===0)r.statuseffectvalues=i.params.slice(3);else{let p=[];for(let l=0;l<Math.max(r.statuseffectvalues.length,i.params.length-3);l++)i.params[l+3]&&p.push((r.statuseffectvalues[l]??0)*(1+(i.params[l+3]??0)/100));r.statuseffectvalues=p}})}),r}getCritMultiplierFromCombatEffect(t,a){if(!t)return 0;let n=0;return t.effects.filter(r=>r.actions.find(o=>Be[o.type]===4)).forEach(r=>{this.#a.isCombatEffectConditionsValid({effect:r,...a})&&r.actions.filter(o=>Be[o.type]===4).forEach(o=>{n+=(o.args[0]??0)/100})}),n}applyRdps(t,a,n,r){a&&(a.damageInfo.rdpsDamageGiven+=r),a&&this.#a.isSupportClassId(a.classId)&&(t.damageInfo.rdpsDamageReceivedSupp+=r,n.damageInfo.rdpsDamageReceivedSupp+=r),t.damageInfo.rdpsDamageReceived+=r,n.damageInfo.rdpsDamageReceived+=r}onStartSkill(t,a,n){let r=this.updateEntity(t,{isDead:!1},n);if(r){r.hits.casts+=1;let o=r.skills.get(a);o||(o={...this.createEntitySkill(),id:a,...this.getSkillNameIcon(a,0)},r.skills.set(a,o)),o.hits.casts+=1}}onShieldUsed(t,a,n,r){if(r<0&&console.error("Shield change values was negative, shield ammount increased"),t.entityType===1&&a.entityType===1){if(!this.#t.damageStatistics.effectiveShieldingBuffs.has(n)){let S=this.#a.getStatusEffectHeaderData(n);S&&this.#t.damageStatistics.effectiveShieldingBuffs.set(n,S)}let o=new Date,i=this.updateEntity(t,{},o),f=this.updateEntity(a,{},o);i.damagePreventedByShield+=r;let p=i.damagePreventedByShieldBy.get(n)??0;i.damagePreventedByShieldBy.set(n,p+r),this.#t.damageStatistics.topEffectiveShieldingUsed=Math.max(i.damagePreventedByShield,this.#t.damageStatistics.topEffectiveShieldingUsed),f.damagePreventedWithShieldOnOthers+=r;let l=f.damagePreventedWithShieldOnOthersBy.get(n)??0;f.damagePreventedWithShieldOnOthersBy.set(n,l+r),this.#t.damageStatistics.topEffectiveShieldingDone=Math.max(f.damagePreventedWithShieldOnOthers,this.#t.damageStatistics.topEffectiveShieldingDone),this.#t.damageStatistics.totalEffectiveShieldingDone+=r}}onShieldApplied(t,a,n,r){let o=new Date,i=this.updateEntity(t,{},o),f=this.updateEntity(a,{},o);if(f.isPlayer&&i.isPlayer){if(!this.#t.damageStatistics.appliedShieldingBuffs.has(n)){let S=this.#a.getStatusEffectHeaderData(n);S&&this.#t.damageStatistics.appliedShieldingBuffs.set(n,S)}i.shieldReceived+=r,f.shieldDone+=r;let p=f.shieldDoneBy.get(n)??0;f.shieldDoneBy.set(n,p+r);let l=i.shieldReceivedBy.get(n)??0;i.shieldReceivedBy.set(n,l+r),this.#t.damageStatistics.topShieldDone=Math.max(f.shieldDone,this.#t.damageStatistics.topShieldDone),this.#t.damageStatistics.topShieldGotten=Math.max(i.shieldReceived,this.#t.damageStatistics.topShieldGotten),this.#t.damageStatistics.totalShieldDone+=r}}getSkillNameIcon(t,a){if(t===0&&a===0)return{name:"Bleed",icon:"buff_168.png"};if(t===0){let n=this.#a.skillEffect.get(a);if(n&&n.itemname)return{name:n.itemname,icon:n.icon??""};if(n){if(n.sourceskill){let r=this.#a.skill.get(n.sourceskill);if(r)return{name:r.name,icon:r.icon}}else{let r=this.#a.skill.get(Math.floor(a/10));if(r)return{name:r.name,icon:r.icon}}return{name:n.comment}}else return{name:this.#a.getSkillName(t)}}else{let n=this.#a.skill.get(t);return!n&&(n=this.#a.skill.get(t-t%10),!n)?{name:this.#a.getSkillName(t),icon:""}:n.summonsourceskill?(n=this.#a.skill.get(n.summonsourceskill),n?{name:n.name+" (Summon)",icon:n.icon}:{name:this.#a.getSkillName(t),icon:""}):n.sourceskill?(n=this.#a.skill.get(n.sourceskill),n?{name:n.name,icon:n.icon}:{name:this.#a.getSkillName(t),icon:""}):{name:n.name,icon:n.icon}}}updateEntity(t,a,n){let r={lastUpdate:+n},o=this.#t.entities.get(t.name),i={};if(!o||t.entityType===1&&o.isPlayer!==!0){if(t.entityType===1){let f=t;i={classId:f.class,gearScore:f.gearLevel,isPlayer:!0}}else if(t.entityType===2||t.entityType===3){let f=t;i={npcId:f.typeId,isBoss:f.isBoss}}else if(t.entityType===4){let f=t;i={npcId:f.typeId,isBoss:f.isBoss,isEsther:!0,icon:f.icon}}}return o?Object.assign(o,a,r,i):(o={...this.createEntity(),...a,...r,...i,name:t.name,id:t.entityId.toString(16)},this.#t.entities.set(t.name,o)),o}updateOrCreateEntity(t,a,n){if(!(!a.name||!a.id)){for(let[r,o]of this.#t.entities)if(a.id===o.id){this.#t.entities.delete(r),this.updateEntity(t,{...o,...a},n);return}this.updateEntity(t,a,n)}}createEntitySkill(){return{id:0,name:"",icon:"",damageInfo:{damageDealt:0,rdpsDamageReceived:0,rdpsDamageReceivedSupp:0,rdpsDamageGiven:0,damageDealtDebuffedBySupport:0,damageDealtBuffedBySupport:0},maxDamage:0,hits:{casts:0,total:0,crit:0,backAttack:0,totalBackAttack:0,frontAttack:0,totalFrontAttack:0,counter:0,hitsDebuffedBySupport:0,hitsBuffedBySupport:0,hitsBuffedBy:new Map,hitsDebuffedBy:new Map},breakdown:[],damageDealtDebuffedBy:new Map,damageDealtBuffedBy:new Map}}createEntity(){return{lastUpdate:0,id:"",npcId:0,name:"",classId:0,isBoss:!1,isPlayer:!1,isDead:!1,deaths:0,deathTime:0,gearScore:0,currentHp:0,maxHp:0,damageInfo:{damageDealt:0,rdpsDamageReceived:0,rdpsDamageReceivedSupp:0,rdpsDamageGiven:0,damageDealtDebuffedBySupport:0,damageDealtBuffedBySupport:0},healingDone:0,shieldDone:0,damageTaken:0,skills:new Map,hits:{casts:0,total:0,crit:0,backAttack:0,totalBackAttack:0,frontAttack:0,totalFrontAttack:0,counter:0,hitsDebuffedBySupport:0,hitsBuffedBySupport:0,hitsBuffedBy:new Map,hitsDebuffedBy:new Map},damageDealtDebuffedBy:new Map,damageDealtBuffedBy:new Map,damagePreventedByShieldBy:new Map,damagePreventedWithShieldOnOthersBy:new Map,shieldDoneBy:new Map,shieldReceivedBy:new Map,damagePreventedWithShieldOnOthers:0,damagePreventedByShield:0,shieldReceived:0,statApiValid:!1}}getBroadcast(){let t={...this.#t};return t.entities=new Map,this.#t.entities.forEach((a,n)=>{!a.isPlayer&&!a.isEsther||(a.statApiValid=this.#i.isCurrentZoneValid()&&this.#i.cache.get(a.name)?.status===2,t.entities.set(n,{...a}))}),t.localPlayer=this.#n.localPlayer.name,t}resetBreakdowns(){this.#e.clear()}createBreakdownEntity(t){return this.#e.has(t)||this.#e.set(t,new Map),this.#e.get(t)}removeBreakdownEntry(t){this.#e.delete(t)}addBreakdown(t,a,n){let r=this.createBreakdownEntity(t);if(r.has(a))r.get(a).push(n);else{let o=new Array(n);r.set(a,o)}}getBreakdowns(t,a){let n=this.#e.get(t);if(n)return n.get(a)}clearBreakdowns(t,a){let n=this.#e.get(t);n&&n.delete(a)}applyBreakdowns(t,a=!0){t.forEach(n=>{n.skills.forEach(r=>{let o=BigInt("0x"+n.id),i=this.getBreakdowns(o,r.id);i&&(r.breakdown=[...i])})}),a&&this.resetBreakdowns()}};var Mu=require("tiny-typed-emitter");function Et(e){let t={};return t.level=e.u8(),t.points=e.u16(),t.id=e.u32(),t}function To(e){let t=new d(e),a={};return a.abilityDataList=t.array(t.u16(),()=>Et(t),100),a}var Io="PKTAbilityChangeNotify",At=30112;function lu(e){let t={};return t.level=e.u32(),t.featureType=e.u16(),t}function Eo(e){let t=new d(e),a={};return a.objectId=t.u64(),a.activeAbilityList=t.array(t.u16(),()=>lu(t),60),a}var vo="PKTActiveAbilityNotify",wt=5325;function xo(e){let t=new d(e),a={};return a.objectId=t.u64(),a.addonSkillFeatureList=t.array(t.u16(),()=>{let n={};return n.skillId=t.u32(),n.addonSkillFeatureIdList=t.array(t.u16(),()=>t.u32(),5),n},200),a.addonFeatureIdList=t.bytes(t.u16(),200,4),a}var No="PKTAddonSkillFeatureChangeNotify",Bt=30074;function Do(e){let t=new d(e),a={};return a.unk1_m=t.bytes(t.u32(),688),a.unk1=t.u32(),a}var yo="PKTAuthTokenResult",Ro=28747;function go(e){let t=new d(e),a={};return a.paralyzationPoint=t.u32(),a.type=t.u8(),a.paralyzationMaxPoint=t.u32(),a.objectId=t.u64(),t.skip(1),a}var Lo="PKTBlockSkillStateNotify",Ct=40912;function Ko(e){let t=new d(e),a={};return a.type=t.u32(),a.sourceId=t.u64(),a.targetId=t.u64(),t.skip(1),a}var Ao="PKTCounterAttackNotify",Mt=24539;function wo(e){let t=new d(e),a={};return a.sourceId=t.u64(),a.unk1=t.u32(),a.unk2=t.u32(),t.bool()&&(a.unk4_0=t.u8()),a.unk5=t.u8(),a.targetId=t.u64(),t.bool()&&(a.unk8_0=t.u8()),a.unk9=t.u16(),a.unk10=t.u64(),t.bool()&&(a.unk12_0=t.u8()),a}var Bo="PKTDeathNotify",jt=36756;function X(e){let t={};return t.level=e.u16(),t.id=e.u32(),e.bool()&&(t.unk3_0=e.u8()),t.itemTint=e.bytes(e.u16(),5,14),t.expireTime=j(e),t.slot=e.u16(),t}function Co(e){let t=new d(e),a={};return a.unk0=t.u32(),a.unk1=t.u32(),a.objectId=t.u64(),a.equipItemDataList=t.array(t.u16(),()=>X(t),33),a}var Mo="PKTEquipChangeNotify",Ot=7264;function jo(e){let t=new d(e),a={};return a.objectId=t.u64(),a.equipLifeToolDataList=t.array(t.u16(),()=>X(t),9),a}var Oo="PKTEquipLifeToolChangeNotify",Ft=11505;function Fo(e){let t=new d(e),a={};return a.objectId=t.u64(),a.stance=t.u8(),t.skip(1),a}var qo="PKTIdentityStanceChangeNotify",qt=24961;function Wo(e){let t=new d(e),a={};return a.struct_139=t.bytes(t.u16(),353,48),a.abilityDataList=t.array(t.u16(),()=>Et(t),100),a}var Uo="PKTInitAbility",Wt=4854;function Vo(e){let t=new d(e),a={};return a.lostArkDateTime=j(t),a.unk1=t.u64(),a.unk2=t.u8(),a.unk3=t.u32(),a.struct_591=t.string(128),a.playerId=t.u64(),a.unk6=t.u32(),a.struct_32=t.array(t.u16(),()=>{let n={};return n.struct_574=t.string(32),n.versionString=t.string(64),n.struct_591=t.string(128),n},64),a}var Zo="PKTInitEnv",Ut=25291;function vt(e){let t={};return t.unk0=e.u16(),t.unk1=e.u64(),t.unk2=e.u8(),t.unk3=I(e),t.unk4=e.u8(),t.unk5=I(e),t.unk6=e.u8(),t}function V(e){let t={};return t.struct_441=e.bytes(e.u16(),8,7),t.endTick=e.u64(),t.statusEffectId=e.u32(),e.bool()&&(t.unk4_0=e.u64()),t.occurTime=j(e),e.bool()&&(t.value=e.bytes(16)),t.effectInstanceId=e.u32(),t.stackCount=e.u8(),t.totalTime=e.f32(),t.sourceId=e.u64(),t.skillLevel=e.u8(),t}function zo(e){let t=new d(e),a={};return a.unk0=t.u8(),a.unk1=t.u8(),a.unk2=t.u32(),a.unk3=t.u32(),a.unk4=t.u8(),a.unk5=t.u64(),a.unk6=t.u16(),a.unk7=t.u8(),a.unk8=t.u64(),a.playerId=t.u64(),a.struct_363=t.string(7),a.unk11=t.u8(),a.unk12=t.bytes(35),a.unk13=t.u32(),a.struct_107=t.bytes(t.u16(),63),a.unk15=t.u8(),a.classId=t.u16(),a.unk17=t.u8(),a.unk18=t.u8(),a.name=t.string(20),a.unk20=t.u8(),a.unk21=t.u32(),a.unk22=t.u64(),t.bool()&&(a.unk24_0=t.u32()),a.unk25=t.u32(),a.level=t.u16(),a.unk27=t.u8(),a.unk28=t.u32(),a.periodUpdateStatDataList=t.array(t.u16(),()=>vt(t),5),a.unk30=t.u8(),a.statusEffectDatas=t.array(t.u16(),()=>V(t),80),a.unk32=t.u8(),a.unk33=t.u32(),a.unk34=t.u8(),a.unk35=t.u8(),a.unk36=t.u16(),a.unk37=t.u16(),a.unk38=t.u8(),a.struct_339=t.bytes(t.u16(),104,30),a.unk40=t.u32(),a.statPair=t.array(t.u16(),()=>{let n={};return n.statType=t.u8(),n.value=I(t),n},153),a.unk42=t.u16(),a.gearLevel=t.f32(),a.unk44=t.u64(),a.unk45=t.u8(),a.unk46=t.u32(),a.unk47=t.u8(),a.unk48=t.u8(),a.characterId=t.u64(),a.unk50=t.u32(),a.unk51=t.u8(),a.unk52=t.u64(),a.struct_225=t.bytes(t.u16(),3,17),a.unk54=t.u32(),a.unk55=t.bytes(120),a.unk56=t.u8(),a.unk57=t.bytes(25),a}var Go="PKTInitPC",Vt=6064;function cu(e){let t={},a=e.u16();return a===1&&(t.unk1_0=e.bytes(a)),t}function du(e){let t={};return t.unk0=e.u8(),t.unk1=e.u32(),t.unk2=e.u8(),t.unk3=e.u8(),t.unk4=e.u8(),t.struct_147=cu(e),t.struct_148=e.bytes(e.u16(),3,9),t.unk7=e.u32(),t}function pu(e){let t={};return t.struct_149=e.bytes(e.u16(),10,9),t.unk1=e.u8(),t.unk2=e.u32(),t.struct_236=e.bytes(e.u16(),10,18),t.unk4=e.u32(),t.unk5=e.u32(),t.unk6=e.u32(),t.unk7=e.u32(),t.struct_388=e.bytes(e.u16(),2,10),t.unk9=e.u32(),t.unk10=e.u64(),t.struct_234=e.array(e.u16(),()=>du(e),3),t.unk12=e.u16(),t.struct_258=e.bytes(e.u16(),2,9),t}function _u(e){let t={};return t.unk0=e.u8(),t.unk1=e.bytes(3),t.struct_101=e.bytes(e.u32(),51),t.unk3=e.u8(),t.unk4=e.u16(),t.unk5=e.u16(),t.unk6=e.u8(),t.unk7=e.u16(),t}function bu(e){let t={};return t.unk0=e.bytes(e.u16(),7),e.bool()&&(t.struct_746=_u(e)),t.unk3=e.u8(),t.unk4=e.bytes(e.u16(),7),t}function hu(e){let t={};return t.unk0=e.u32(),t.unk1=e.u32(),t.unk2=e.u32(),e.bool()&&(t.struct_192=e.bytes(e.u16(),5,30),t.unk1_1=e.u32(),t.unk1_2=e.u32()),t.struct_238=e.bytes(e.u16(),10,29),t.struct_434=e.bytes(e.u16(),3,10),e.bool()&&(t.unk7_0=e.bytes(9)),e.bool()&&(t.struct_229=e.bytes(e.u16(),2,32)),t.itemTint=e.bytes(e.u16(),5,14),t.unk11=e.u32(),t.struct_269=e.bytes(e.u16(),3,21),e.bool()&&(t.struct_786=bu(e)),t.unk15=e.u32(),t.struct_232=e.bytes(e.u16(),3,7),t.unk17=e.u32(),t.unk18=e.u8(),t}function Xe(e){let t={};return t.isDead=e.bool(),t.npcId=e.u32(),t}function Pu(e){let t={};return t.bossKillDataList=e.array(e.u16(),()=>Xe(e),3),t.unk1=e.u8(),t.unk2=e.u8(),t.unk3=e.u32(),t.struct_2=e.array(e.u16(),()=>{let a={};return a.struct_522=e.bytes(e.u16(),10),a.unk1_0_1=e.u32(),a},3),t}function ku(e){let t={};return t.struct_232=e.bytes(e.u16(),3,7),t.unk1=e.u8(),t.unk2=e.u8(),t.struct_233=e.bytes(e.u16(),5,7),t.unk4=e.u8(),t.struct_24=e.array(e.u16(),()=>{let a={};return a.struct_231=e.string(2),a.unk1_0_1=e.u16(),a.unk1_0_2=e.u8(),a},20),t}function Tu(e){let t={},a=e.u8();return a===1&&(t.struct_662=pu(e)),a===2&&(t.struct_136=e.bytes(e.u16(),3,6),t.struct_3=e.array(e.u16(),()=>{let n={};return n.struct_522=e.bytes(e.u16(),10),n.unk1_0_1=e.u32(),n.unk1_0_2=e.u8(),n.unk1_0_3=e.u8(),n},3),t.unk2_2=e.u8()),a===3&&(t.unk3_0=e.bytes(26)),a===4&&(t.unk4_0=e.bytes(e.u16(),10,13),t.unk4_1=e.bytes(e.u16(),10,13),t.unk4_2=e.u32()),a===5&&(t.struct_661=hu(e)),a===6&&(t.struct_606=Pu(e)),a===7&&(t.unk7_0=e.bytes(9)),a===8&&(t.struct_654=ku(e)),a===9&&(t.unk9_0=e.u8()),t}function Iu(e){let t={};return e.u32()>0&&(t.serialNumber=e.u64(),t.id=e.u32(),t.level=e.u16(),t.slot=e.u16(),t.durability=e.u32(),t.unk1_6_m=e.u32(),t.flag=e.u32(),t.expireTime=j(e),t.lockUpdateTime=j(e),e.bool()&&(t.unk1_10_0=e.bytes(9)),t.unk1_11=e.u8(),t.unk1_12=e.u8(),t.unk1_13=e.u32(),t.struct_561=Tu(e),t.unk1_15=e.u32()),t}function Yo(e){let t=new d(e),a={};return a.storageType=t.u8(),a.itemDataList=t.array(t.u16(),()=>Iu(t),80),a}var $o="PKTInitItem",Zt=55719;function Eu(e){let t={};return t.unk0=e.u32(),e.bool()&&(t.unk2_0=e.u32()),e.bool()&&(t.unk4_0=e.bytes(9)),t.unk5=e.u32(),t.unk6=e.u32(),t}function Qo(e){let t=new d(e),a={};return t.bool()&&(a.unk1_0=t.u32()),a.statPair=t.array(t.u16(),()=>{let n={};return n.statType=t.u8(),n.value=I(t),n},153),a.abilityDataList=t.array(t.u16(),()=>Et(t),100),a.unk4=t.u8(),a.unk5=t.u8(),a.unk6=t.u64(),a.struct_225=t.bytes(t.u16(),3,17),a.addonFeatureIdList=t.bytes(t.u16(),200,4),a.statusEffectDatas=t.array(t.u16(),()=>V(t),80),a.unk10=t.u32(),a.addonSkillFeatureList=t.array(t.u16(),()=>{let n={};return n.skillId=t.u32(),n.addonSkillFeatureIdList=t.array(t.u16(),()=>t.u32(),5),n},200),a.struct_339=t.bytes(t.u16(),104,30),a.unk13=t.u64(),a.struct_139=t.bytes(t.u16(),353,48),a.unk15=t.u8(),a.struct_419=t.array(t.u16(),()=>Eu(t),300),a}var Jo="PKTInitLocal",Ht=27956;function Xo(e){let t=new d(e),a={};return a.account_CharacterId1=t.u64(),a.account_CharacterId2=t.u64(),a.serverAddr=t.string(256),a.unk3=t.u32(),a}var tr="PKTMigrationExecute",zt=27501;function vu(e){let t={};return t.unk0=e.u8(),t.lookData=e.bytes(e.u32(),512),t.lostArkString=e.string(20),t.unk3=e.u16(),t.unk4=e.u64(),t.unk5=e.u64(),t.unk6=e.u8(),t.equipItemDataList=e.array(e.u16(),()=>X(e),33),t.unk8=e.u8(),t}function ta(e){let t={};return t.level=e.u16(),e.bool()&&(t.struct_270=e.bytes(e.u16(),12,12)),e.bool()&&(t.unk4_0=e.u8()),t.unk5=e.u8(),t.directionYaw=O(e),e.bool()&&(t.unk8_0=e.u32()),t.statPair=e.array(e.u16(),()=>{let a={};return a.statType=e.u8(),a.value=I(e),a},153),e.bool()&&(t.unk11_0=e.u32()),t.position=y(e),e.bool()&&(t.unk14_0=e.u8()),e.bool()&&(t.balanceLevel=e.u16()),e.bool()&&(t.unk18_0=e.u64()),t.unk19=e.u8(),e.bool()&&(t.transitIndex=e.u32()),t.unk22=e.u8(),t.unk23=e.u8(),e.bool()&&(t.unk25_0=e.u8()),t.typeId=e.u32(),t.periodUpdateStatDataList=e.array(e.u16(),()=>vt(e),5),t.statusEffectDatas=e.array(e.u16(),()=>V(e),80),e.bool()&&(t.unk30_0=e.u8()),e.bool()&&(t.unk32_0=e.u8()),t.objectId=e.u64(),e.bool()&&(t.unk35_0=e.u32()),e.bool()&&(t.unk37_0=e.u8()),t.unk38=e.u8(),t.spawnIndex=e.u32(),e.bool()&&(t.struct_730=vu(e)),e.bool()&&(t.unk43_0=e.u32()),e.bool()&&(t.unk45_0=e.u16()),e.bool()&&(t.struct_335=e.bytes(e.u16(),11,9)),e.bool()&&(t.unk49_0=e.u8()),t.unk50=e.u8(),t}function er(e){let t=new d(e),a={};return t.bool()&&(a.unk1_0=t.u64()),a.unk2=t.u8(),a.npcStruct=ta(t),t.bool()&&(a.unk1_0_0=t.string(20),a.unk1_1=t.string(20)),t.bool()&&(a.unk6_0=t.u8()),a}var ar="PKTNewNpc",Gt=17218;function nr(e){let t=new d(e),a={};return a.publishReason=t.u8(),t.skip(9),a.ownerId=t.u64(),t.skip(26),a.npcData=ta(t),a}var ir="PKTNewNpcSummon",Yt=7148;function Nu(e){let t={};return t.statusEffectDatas=e.array(e.u16(),()=>V(e),80),t.unk1=e.u8(),t.periodUpdateStatDataList=e.array(e.u16(),()=>vt(e),5),t.unk29_m=e.u8(),t.firstHonorTitleId=e.u16(),t.guildName=e.string(20),t.unk7_m=e.u32(),t.guildId=e.u64(),t.unk17_m=e.u8(),t.classId=e.u16(),t.equipLifeToolDataList=e.array(e.u16(),()=>X(e),9),t.heading=O(e),t.equipItemDataList=e.array(e.u16(),()=>X(e),33),t.unk1_m=e.u8(),t.petId=e.u32(),t.playerId=e.u64(),t.unk16=e.u32(),t.unk17=e.u32(),t.unk0_m=e.bytes(5),t.name=e.string(20),t.statPair=e.array(e.u16(),()=>{let a={};return a.statType=e.u8(),a.value=I(e),a},153),t.lookData=e.bytes(e.u32(),512),t.rvRLevel=e.u16(),t.avgItemLevel=e.f32(),t.addonFeatureIdList=e.bytes(e.u16(),200,4),t.unk23_m=e.u8(),t.unk2_m=e.u8(),t.maxItemLevel=e.f32(),t.secondHonorTitleId=e.u16(),t.unk29=e.u64(),t.unk4_m=e.u32(),e.bool()&&(t.grabbedData=e.bytes(12)),t.unk33=e.u8(),t.position=y(e),t.unk35=e.u32(),t.unk5_m=e.u32(),t.unk25_m=e.u8(),t.level=e.u16(),t.characterId=e.u64(),t.unk32_m=e.u8(),t.unk45_m=e.u32(),t.addonSkillFeatureList=e.array(e.u16(),()=>{let a={};return a.skillId=e.u32(),a.addonSkillFeatureIdList=e.array(e.u16(),()=>e.u32(),5),a},200),t.unk43=e.u8(),t.avatarHide=e.u8(),t.worldId=e.u8(),t.identityData=e.bytes(25),t}function Du(e){let t={};return t.unk0=e.u32(),t.unk1=e.bytes(12),e.bool()&&(t.unk3_0=e.bytes(12)),t.unk4=e.u32(),t}function or(e){let t=new d(e),a={};return a.unk0_m=t.u8(),a.unk2_m=t.u8(),a.pcStruct=Nu(t),t.bool()&&(a.unk5_0_m=t.bytes(20)),t.bool()&&(a.unk4_0_m=t.bytes(12)),t.bool()&&(a.itemTint=t.bytes(t.u16(),5,14),a.unk1_1=t.u64(),a.unk1_2=t.u32()),t.bool()&&(a.struct_63=t.array(t.u16(),()=>{let n={};return n.unk1_0_0=t.u64(),n.unk1_0_1=t.u32(),n.itemTint=t.bytes(t.u16(),5,14),n},5)),t.bool()&&(a.unk3_0_m=t.u32()),t.bool()&&(a.trackMoveInfo=Du(t)),a}var rr="PKTNewPC",$t=37942;function yu(e){let t={};return t.unk0=e.u32(),t.skillId=e.u32(),t.unk2=e.u16(),e.bool()&&(t.struct_335=e.bytes(e.u16(),11,9)),t.unk5=e.u16(),t.unk6=e.u8(),t.skillEffect=e.u32(),t.tripodIndex=Tt(e),t.unk9=e.u32(),t.chainSkillEffect=e.u32(),e.bool()&&(t.unk12_0=e.u64()),e.bool()&&(t.unk14_0=e.u32()),t.unk15=e.u32(),t.targetObjectId=e.u64(),t.unk17=e.u64(),t.tripodLevel=It(e),t.unk19=e.u8(),t.skillLevel=e.u8(),t.projectileId=e.u64(),t.unk22=e.u64(),t.ownerId=e.u64(),t}function sr(e){let t=new d(e),a={};return a.projectileInfo=yu(t),a}var ur="PKTNewProjectile",Qt=55254;function Ru(e){let t={};return t.skillEffect=e.u32(),t.skillId=e.u32(),t.position=y(e),t.ownerId=e.u64(),t.unk4=e.u16(),t.unk5=e.u8(),t.unk6=e.u32(),e.bool()&&(t.struct_335=e.bytes(e.u16(),11,9)),t.unk9=e.u8(),t.unk10=e.u32(),t.objectId=e.u64(),t.unk12=e.u32(),t.unk13=e.u8(),t}function fr(e){let t=new d(e),a={};return a.unk0=t.u8(),a.unk1=t.u8(),a.trapData=Ru(t),a}var mr="PKTNewTrap",Jt=59244;function lr(e){let t=new d(e),a={};return a.hitCheckTime=t.u32(),a.enable=t.bool(),a.objectId=t.u64(),a.noHitCheckTime=t.u32(),t.skip(1),a.paralyzationMaxPoint=t.u32(),a.paralyzationPoint=t.u32(),a.decreasePoint=t.u32(),a}var cr="PKTParalyzationStateNotify",Xt=11791;function gu(e){let t={};return t.position=y(e),t.characterLevel=e.u16(),t.zoneId=e.u32(),t.unk3=e.u8(),t.name=e.string(20),t.maxHp=I(e),t.auths=e.u8(),t.partyMemberNumber=e.u8(),t.gearLevel=e.f32(),t.unk9=e.u16(),t.zoneInstId=e.u64(),t.unk11=e.u8(),t.classId=e.u16(),t.characterId=e.u64(),t.worldId=e.u8(),t.unk15=e.u8(),t.unk16=e.u8(),t.curHp=I(e),t.transitIndex=e.u32(),t.unk19=e.u8(),t}function dr(e){let t=new d(e),a={};return a.lootGrade=t.u32(),a.partyLootType=t.u8(),a.memberDatas=t.array(t.u16(),()=>gu(t),40),a.partyType=t.u8(),a.raidInstanceId=t.u32(),a.partyInstanceId=t.u32(),a}var pr="PKTPartyInfo",te=39503;function _r(e){let t=new d(e),a={};return a.name=t.string(20),a.partyInstanceId=t.u32(),a.partyLeaveType=t.u8(),a}var br="PKTPartyLeaveResult",ee=19429;function hr(e){let t=new d(e),a={};return a.objectId=t.u64(),a.passiveStatusEffectList=t.array(t.u16(),()=>t.u32(),10),a.unk0_m=t.u8(),a}var Sr="PKTPartyPassiveStatusEffectAddNotify",ae=21670;function Pr(e){let t=new d(e),a={};return a.objectId=t.u64(),a.passiveStatusEffectList=t.array(t.u16(),()=>t.u32(),10),a}var kr="PKTPartyPassiveStatusEffectRemoveNotify",ne=4932;function Tr(e){let t=new d(e),a={};return a.statusEffectDatas=t.array(t.u16(),()=>V(t),80),a.unk1=t.u64(),a.characterId=t.u64(),a.unk3=t.u8(),a.playerIdOnRefresh=t.u64(),a}var Ir="PKTPartyStatusEffectAddNotify",ie=36112;function Er(e){let t=new d(e),a={};return a.unk0=t.u64(),a.statusEffectIds=t.array(t.u16(),()=>t.u32(),80),a.reason=t.u8(),a.characterId=t.u64(),a}var vr="PKTPartyStatusEffectRemoveNotify",oe=21631;function xr(e){let t=new d(e),a={};return t.skip(13),a.characterId=t.u64(),t.skip(12),a.raidInstanceId=t.u32(),t.skip(1),a.partyInstanceId=t.u32(),a}var Nr="PKTPartyStatusEffectResultNotify",re=14771;function Dr(e){let t=new d(e),a={};return a.passiveStatusEffectList=t.array(t.u16(),()=>t.u32(),10),a}var yr="PKTPassiveStatusEffectAddNotify",se=46523;function Rr(e){let t=new d(e),a={};return a.passiveStatusEffectList=t.array(t.u16(),()=>t.u32(),10),a}var gr="PKTPassiveStatusEffectRemoveNotify",ue=2713;function Lr(e){let t=new d(e),a={};return a.unk5_m=t.u64(),a.unk4_m=t.u64(),a.unk6_m=t.u64(),a.totalTime=t.u64(),a.bossKillDataList=t.array(t.u16(),()=>Xe(t),3),a.startTick=t.u64(),a.raidResult=t.u8(),a.endTick=t.u64(),a.unk0_m=t.bool(),a.braveHeartCount=t.u8(),a.unk1_m=t.bool(),a.initBraveHeartCount=t.u8(),a.unk11_m=t.bool(),a.raidId=t.u32(),a}var Kr="PKTRaidBegin",fe=31743;function Ar(e){let t=new d(e),a={};return a.unk0=t.bytes(5),a}var wr="PKTRaidBossKillNotify",me=1956;function Br(e){let t=new d(e),a={};return a.unk0=t.u8(),a.struct_53=t.array(t.u16(),()=>{let n={};return n.unk1_0_0=t.u32(),n.struct_528=t.bytes(t.u16(),3),n.unk1_0_2=I(t),n.unk1_0_3=I(t),n},3),a.unk2=t.u8(),a.unk3=t.u8(),a.unk4=t.u64(),a.unk5=t.u64(),a.unk6=t.u64(),a.unk7=t.u64(),a}var Cr="PKTRaidResult",le=43793;function Lu(e){let t={};return t.unpublishReason=e.u8(),t.objectId=e.u64(),t}function Mr(e){let t=new d(e),a={};return a.unpublishedObjects=t.array(t.u16(),()=>Lu(t),200),a}var jr="PKTRemoveObject",ce=52386;function Or(e){let t=new d(e),a={};return a.caster=t.u64(),t.skip(1),a.skillId=t.u32(),a.skillLevel=t.u8(),a}var Fr="PKTSkillCastNotify",de=57492;function ea(e){let t={};return t.damage=I(e),t.maxHp=I(e),t.modifier=e.u8(),t.curHp=I(e),t.unk3_m=e.u16(),t.targetId=e.u64(),t.damageType=e.u8(),e.bool()&&(t.damageAttr=e.u8()),t}function Au(e){let t={};return t.unk8_m=e.u16(),t.unk3_m=e.u16(),t.destination=y(e),t.unk1_m=e.u8(),t.skillDamageEvent=ea(e),t.position=y(e),t.skillMoveOptionData=He(e),t.unk2_m=e.u64(),t.unk4_m=e.u16(),t}function qr(e){let t=new d(e),a={};return a.unk1_m=t.u8(),a.sourceId=t.u64(),a.skillEffectId=t.u32(),a.skillDamageAbnormalMoveEvents=t.array(t.u16(),()=>Au(t),50),a.unk2_m=t.u32(),a.skillId=t.u32(),a}var Wr="PKTSkillDamageAbnormalMoveNotify",pe=55047;function Ur(e){let t=new d(e),a={};return a.skillDamageEvents=t.array(t.u16(),()=>ea(t),50),t.bool()&&(a.unk2_0=t.u32()),t.bool()&&(a.skillEffectId=t.u32()),a.sourceId=t.u64(),a.skillId=t.u32(),a.skillLevel=t.u8(),a}var Vr="PKTSkillDamageNotify",_e=4363;function Zr(e){let t=new d(e),a={};return t.skip(14),a.stage=t.u8(),t.skip(1),a.skillId=t.u32(),t.skip(17),a.sourceId=t.u64(),t.skip(9),a}var Hr="PKTSkillStageNotify",be=17268;function zr(e){let t=new d(e),a={};return t.bool()&&(a.unk1_m=t.u32()),t.bool()&&(a.aiStateId=t.u32()),t.bool()&&(a.pitchRotation=O(t)),a.newDirectionYaw=O(t),a.sourceId=t.u64(),a.newPosition=y(t),a.skillOptionData=Ye(t),a.aimTargetPosition=y(t),a.curDirectionYaw=O(t),a.curPosition=y(t),a.skillId=t.u32(),a.skillLevel=t.u8(),a}var Gr="PKTSkillStartNotify",he=22542;function Yr(e){let t=new d(e),a={};return a.statPairChangedList=t.array(t.u16(),()=>{let n={};return n.statType=t.u8(),n.value=I(t),n},153),a.unk1=t.array(t.u16(),()=>{let n={};return n.statType=t.u8(),n.value=I(t),n},153),a.unk2=t.u8(),a.objectId=t.u64(),t.bool()&&(a.unk5_0=t.u32()),a}var $r="PKTStatChangeOriginNotify",Qr=30731;function Jr(e){let t=new d(e),a={};return a.statusEffectData=V(t),a.objectId=t.u64(),t.bool()&&(a.unk3_0=t.u64()),a.new=t.bool(),a.unk5=t.u64(),a}var Xr="PKTStatusEffectAddNotify",Se=9208;function ts(e){let t=new d(e),a={};return a.reason=t.u8(),a.objectId=t.u64(),a.statusEffectIds=t.array(t.u16(),()=>t.u32(),80),a}var es="PKTStatusEffectRemoveNotify",Pe=23255;function as(e){let t=new d(e),a={};return t.skip(3),a.targetId=t.u64(),a.expirationTick=t.u64(),a.effectInstanceId=t.u32(),a}var ns="PKTStatusEffectDurationNotify",ke=53072;function is(e){let t=new d(e),a={};return a.characterId=t.u64(),t.skip(2),a.objectId=t.u64(),a.value=t.u32(),t.skip(5),a.effectInstanceId=t.u32(),a}var os="PKTStatusEffectSyncDataNotify",Te=17105;function rs(e){let t=new d(e),a={};return t.skip(1),a.triggerId=t.u32(),a.step=t.u32(),a.unk2_m=t.bool(),a}var ss="PKTTriggerBossBattleStatus",Ie=42744;function us(e){let t=new d(e),a={};return a.triggerId=t.u32(),a.unk0_m=t.u32(),a.involvedPCs=t.array(t.u16(),()=>t.u64(),40),a.packetResultCode=t.u32(),a}var fs="PKTTriggerFinishNotify",Ee=50289;function ms(e){let t=new d(e),a={};return a.involvedPCs=t.array(t.u16(),()=>t.u64(),40),a.sourceId=t.u64(),a.triggerSignalType=t.u32(),a.triggerId=t.u32(),a}var ls="PKTTriggerStartNotify",ve=45410;function cs(e){let t=new d(e),a={};return a.maxHp=I(t),a.characterId=t.u64(),a.curHp=I(t),a.statusEffectDatas=t.array(t.u16(),()=>V(t),80),a.position=t.u64(),a.unk0_m=t.u32(),a}var ds="PKTTroopMemberUpdateMinNotify",xe=26173;function ps(e){let t=new d(e),a={};return a.playerId=t.u64(),a.identityGauge1=t.u32(),a.identityGauge2=t.u32(),a.identityGauge3=t.u32(),t.skip(2),a}var _s="PKTIdentityGaugeChangeNotify",Ne=14757;function bs(e){let t=new d(e),a={};return a.loadComplete=t.bool(),a.completeMembers=t.array(t.u16(),()=>t.u64(),40),a.firstPCEnterTick=t.u64(),a.totalMembers=t.array(t.u16(),()=>t.u64(),40),a.zoneInstId=t.u64(),a.zoneId=t.u32(),a.zoneLevel=t.u8(),a}var hs="PKTZoneMemberLoadStatusNotify",De=23367;function Ss(e){let t=new d(e),a={};return t.skip(2),a.objectId=t.u64(),t.skip(1),a}var Ps="PKTZoneObjectUnpublishNotify",ye=29716;function wu(e){let t={};return e.skip(4),t.stackCount=e.u8(),t.target=e.u8(),t.instanceId=e.u32(),t.id=e.u32(),t}function ks(e){let t=new d(e),a={};return a.zoneStatusEffectDataList=t.array(t.u16(),()=>wu(t),4),a}var Ts="PKTZoneStatusEffectAddNotify",Re=1314;function Is(e){let t=new d(e),a={};return t.skip(2),a.statusEffectId=t.u32(),a}var Es="PKTZoneStatusEffectRemoveNotify",ge=37714;var vs=new Map([[At,[Io,To]],[wt,[vo,Eo]],[Bt,[No,xo]],[Ro,[yo,Do]],[Ct,[Lo,go]],[Mt,[Ao,Ko]],[jt,[Bo,wo]],[Ot,[Mo,Co]],[Ft,[Oo,jo]],[qt,[qo,Fo]],[Wt,[Uo,Wo]],[Ut,[Zo,Vo]],[Vt,[Go,zo]],[Zt,[$o,Yo]],[Ht,[Jo,Qo]],[zt,[tr,Xo]],[Gt,[ar,er]],[Yt,[ir,nr]],[$t,[rr,or]],[Qt,[ur,sr]],[Jt,[mr,fr]],[Xt,[cr,lr]],[te,[pr,dr]],[ee,[br,_r]],[ae,[Sr,hr]],[ne,[kr,Pr]],[ie,[Ir,Tr]],[oe,[vr,Er]],[re,[Nr,xr]],[se,[yr,Dr]],[ue,[gr,Rr]],[fe,[Kr,Lr]],[me,[wr,Ar]],[le,[Cr,Br]],[ce,[jr,Mr]],[de,[Fr,Or]],[pe,[Wr,qr]],[_e,[Vr,Ur]],[be,[Hr,Zr]],[he,[Gr,zr]],[Qr,[$r,Yr]],[Se,[Xr,Jr]],[Pe,[es,ts]],[ke,[ns,as]],[Te,[os,is]],[Ie,[ss,rs]],[Ee,[fs,us]],[ve,[ls,ms]],[xe,[ds,cs]],[Ne,[_s,ps]],[De,[hs,bs]],[ye,[Ps,Ss]],[Re,[Ts,ks]],[ge,[Es,Is]]]);var Cu=new Map([[At,[0]],[wt,[1]],[Bt,[2]],[Ct,[4]],[Mt,[5]],[jt,[6]],[Wt,[7]],[Ut,[8]],[Vt,[9]],[Ht,[10]],[zt,[11]],[Gt,[12]],[Yt,[13]],[$t,[14]],[Qt,[15]],[Xt,[16]],[te,[17]],[ee,[18]],[ae,[19]],[ne,[20]],[ie,[21]],[oe,[22]],[re,[23]],[se,[24]],[ue,[25]],[me,[26]],[le,[27]],[ce,[28]],[pe,[29]],[_e,[30]],[be,[31]],[he,[32]],[Se,[34]],[Pe,[35]],[ke,[36]],[Te,[37]],[Ie,[38]],[Ee,[39]],[ve,[40]],[xe,[41]],[Ne,[42]],[ye,[43]],[Re,[44]],[ge,[45]],[de,[46]],[qt,[47]],[Ot,[48]],[Ft,[49]],[Zt,[50]],[fe,[52]],[De,[51]],[Jt,[53]]]);var qf=require("tiny-typed-emitter");var aa=class{#t;#n;#r;#i;#a;#e;constructor(t,a,n,r,o,i){this.#t=t,this.#n=a,this.#r=n,this.#i=r,this.#a=o,this.#e=i}#o;get parsed(){if(!this.#o)try{this.#o=this.#e(this.#a.decrypt(this.#t,this.#n,this.#r,this.#i))}catch(t){console.error(`[meter-core/pkt-stream] - ${t}`);return}return this.#o}};var ju=require("fs");var xs=class extends Mu.TypedEmitter{},na=class extends xs{#t;#n;constructor(t,a,n){super(),this.#t=a,n&&(this.#n=(0,ju.createWriteStream)(n,{highWaterMark:0}));let r=Buffer.allocUnsafe(ma);r.writeUIntLE(2,0,ma),this.#n?.write(r),t.on("*",this.handlePkt.bind(this))}handlePkt(t,a,n,r){try{let o=vs.get(a),i=Cu.get(a);if(o&&i){let[f]=i,[p,l]=o,S=$e.get(f);if(S){let[b,T,Z]=S,M=new aa(Buffer.from(t),a,n,!!r,this.#t,l).parsed;if(!M)return;let Y=new at(M,f,Z);this.emit(b,Y),this.emit("*",b,Y),this.appendLog(Y)}}}catch(o){console.error(o)}}appendLog(t){this.#n&&t.serialized&&this.#n.write(t.serialized)}};var ia=class{characterIdToPartyId;entityIdToPartyId;raidInstanceToPartyInstances;ownName;characterNameToCharacterId;#t;constructor(t){this.characterIdToPartyId=new Map,this.entityIdToPartyId=new Map,this.raidInstanceToPartyInstances=new Map,this.characterNameToCharacterId=new Map,this.#t=t}add(t,a,n=void 0,r=void 0,o=void 0){!n&&!r||(n&&!r&&(r=this.#t.getEntityId(n)),r&&!n&&(n=this.#t.getEntityId(r)),n&&this.characterIdToPartyId.set(n,a),r&&this.entityIdToPartyId.set(r,a),o&&n&&this.characterNameToCharacterId.set(o,n),this.registerPartyId(t,a))}completeEntry(t,a){let n=this.getPartyIdFromCharacterId(t),r=this.getPartyIdFromEntityId(a);n&&r||(!n&&r&&this.characterIdToPartyId.set(t,r),!r&&n&&this.entityIdToPartyId.set(a,n))}changeEntityId(t,a){let n=this.getPartyIdFromEntityId(t);n&&(this.entityIdToPartyId.delete(t),this.entityIdToPartyId.set(a,n))}setOwnName(t){this.ownName=t}remove(t,a){if(a===this.ownName){this.removePartyMappings(t);return}let n=this.characterNameToCharacterId.get(a);if(this.characterNameToCharacterId.delete(a),!n)return;this.characterIdToPartyId.delete(n);let r=this.#t.getEntityId(n);r&&this.characterIdToPartyId.delete(r)}isCharacterInParty(t){return this.characterIdToPartyId.has(t)}isEntityInParty(t){return this.entityIdToPartyId.has(t)}getPartyIdFromCharacterId(t){return this.characterIdToPartyId.get(t)}getPartyIdFromEntityId(t){return this.entityIdToPartyId.get(t)}removePartyMappings(t){let a=this.getRaidInstanceId(t),n=a?this.raidInstanceToPartyInstances.get(a)??new Set([t]):new Set([t]);for(let[r,o]of this.characterIdToPartyId)if(n.has(o)){this.characterIdToPartyId.delete(r);for(let[i,f]of this.characterNameToCharacterId)if(r===f){this.characterNameToCharacterId.delete(i);break}}for(let[r,o]of this.entityIdToPartyId)n.has(o)&&this.entityIdToPartyId.delete(r)}getRaidInstanceId(t){for(let a of this.raidInstanceToPartyInstances)if(a[1].has(t))return a[0]}registerPartyId(t,a){let n=this.raidInstanceToPartyInstances.get(t);n||(n=new Set,this.raidInstanceToPartyInstances.set(t,n)),n.add(a)}partyInfo(t,a,n){let r=t.parsed;if(r){if(r.memberDatas.length===1&&r.memberDatas[0]?.name===n.name){this.remove(r.partyInstanceId,r.memberDatas[0].name);return}this.removePartyMappings(r.partyInstanceId);for(let o of r.memberDatas){o.characterId===n.characterId&&this.setOwnName(o.name);let i=this.#t.getEntityId(o.characterId);if(i){let f=a.get(i);if(f&&f.entityType===1&&f.name!==o.name){let p=f;p.gearLevel=o.gearLevel,p.name=o.name,p.class=o.classId}}this.add(r.raidInstanceId,r.partyInstanceId,o.characterId,i,o.name)}}}};var oa=class{entityToCharacterId;characterToEntityId;constructor(){this.entityToCharacterId=new Map,this.characterToEntityId=new Map}addMapping(t,a){this.entityToCharacterId.set(a,t),this.characterToEntityId.set(t,a)}getCharacterId(t){return this.entityToCharacterId.get(t)}getEntityId(t){return this.characterToEntityId.get(t)}clear(){this.entityToCharacterId.clear(),this.characterToEntityId.clear()}};var Ns=class extends Fu.TypedEmitter{#t;#n;#r;#i;#a;#e;#o;#s;#u;#f;constructor(t,a,n,r){super(),this.#t=t,this.#n=a,this.#r=new oa,this.#i=new ia(this.#r),this.#a=new Dt(this.#i,this.#n,r.isLive??!0),this.#e=new Fe(this.#r,this.#i,this.#a,this.#n),this.#s=new Lt(this.#e,n,Ou(this.#t,r.isLive)?this.#t:void 0),this.#o=new Qe(this.#e,this.#a,this.#s,this.#n,r),this.#o.emit=this.emit.bind(this),this.#u=!1,this.#f=!1,this.#o.options.isLive&&setInterval(this.broadcastStateChange.bind(this),100),this.#t.on("APP_StatApi",o=>{let i=o.parsed;i&&this.#s.updatePlayerStats(i.players)}).on("AbilityChangeNotify",o=>{}).on("ActiveAbilityNotify",o=>{}).on("AddonSkillFeatureChangeNotify",o=>{}).on("BlockSkillStateNotify",o=>{}).on("CounterAttackNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.entities.get(i.sourceId);f&&this.#o.onCounterAttack(f,o.time)}).on("DeathNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.entities.get(i.targetId);f&&this.#o.onDeath(f,o.time)}).on("EquipChangeNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.entities.get(i.objectId);if(!f||f.entityType!==1)return;f.itemSet=this.#e.getPlayerSetOptions(i.equipItemDataList);let p=[];i.equipItemDataList.forEach(l=>{l.id!==void 0&&l.slot!==void 0&&p.push({id:l.id,slot:l.slot})}),f.items.equipList=p}).on("EquipLifeToolChangeNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.entities.get(i.objectId);if(!f||f.entityType!==1)return;let p=[];i.equipLifeToolDataList.forEach(l=>{l.id!==void 0&&l.slot!==void 0&&p.push({id:l.id,slot:l.slot})}),f.items.lifeToolList=p}).on("IdentityStanceChangeNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.entities.get(i.objectId);f&&f.entityType===1&&(f.stance=i.stance)}).on("IdentityGaugeChangeNotify",o=>{}).on("InitAbility",o=>{}).on("InitEnv",o=>{this.#e.processInitEnv(o),this.#o.onInitEnv(o,o.time)}).on("InitLocal",o=>{}).on("InitPC",o=>{let i=this.#e.processInitPC(o);if(i&&o.parsed){let f=this.#n.getStatPairMap(o.parsed.statPair);this.#o.updateOrCreateEntity(i,{id:i.entityId.toString(16),name:i.name,classId:i.class,isPlayer:!0,gearScore:i.gearLevel,currentHp:Number(f.get(1))||0,maxHp:Number(f.get(27))||0},o.time)}}).on("InitItem",o=>{let i=o.parsed;if(i){if(i.storageType===1){this.#e.localPlayer.itemSet=this.#e.getPlayerSetOptions(i.itemDataList);let f=[];i.itemDataList.forEach(p=>{p.id!==void 0&&p.slot!==void 0&&f.push({id:p.id,slot:p.slot})}),this.#e.localPlayer.items.equipList=f}else if(i.storageType===21){let f=[];i.itemDataList.forEach(p=>{p.id!==void 0&&p.slot!==void 0&&f.push({id:p.id,slot:p.slot})}),this.#e.localPlayer.items.lifeToolList=f}}}).on("MigrationExecute",o=>{this.#s.zoneSyncStatus=0;let i=o.parsed;i&&(this.#e.localPlayer.characterId===0n&&(this.#e.localPlayer.characterId=i.account_CharacterId1<i.account_CharacterId2?i.account_CharacterId1:i.account_CharacterId2),this.#s.ip=o.parsed.serverAddr.split(":")[0])}).on("NewNpc",o=>{let i=this.#e.processNewNpc(o);if(i&&o.parsed){let f=this.#n.getStatPairMap(o.parsed.npcStruct.statPair);this.#o.updateOrCreateEntity(i,{id:i.entityId.toString(16),name:i.name,npcId:i.typeId,isPlayer:!1,isBoss:i.isBoss,currentHp:Number(f.get(1))||0,maxHp:Number(f.get(27))||0},o.time)}}).on("NewNpcSummon",o=>{let i=this.#e.processNewNpcSummon(o);if(i&&o.parsed){let f=this.#n.getStatPairMap(o.parsed.npcData.statPair);this.#o.updateOrCreateEntity(i,{id:i.entityId.toString(16),name:i.name,npcId:i.typeId,isPlayer:!1,isBoss:i.isBoss,currentHp:Number(f.get(1))||0,maxHp:Number(f.get(27))||0},o.time)}}).on("NewPC",o=>{let i=this.#e.processNewPC(o);if(i&&o.parsed){let f=this.#n.getStatPairMap(o.parsed.pcStruct.statPair);this.#o.updateOrCreateEntity(i,{id:i.entityId.toString(16),name:i.name,classId:i.class,isPlayer:!0,gearScore:i.gearLevel,currentHp:Number(f.get(1))||0,maxHp:Number(f.get(27))||0},o.time)}}).on("NewProjectile",o=>{let i=o.parsed;if(!i)return;let f={entityId:i.projectileInfo.projectileId,entityType:5,name:i.projectileInfo.projectileId.toString(16),ownerId:i.projectileInfo.ownerId,skillEffectId:i.projectileInfo.skillEffect,skillId:i.projectileInfo.skillId,stats:new Map};this.#e.entities.set(f.entityId,f)}).on("NewTrap",o=>{let i=o.parsed;if(!i)return;let f={entityId:i.trapData.objectId,entityType:5,name:i.trapData.objectId.toString(16),ownerId:i.trapData.ownerId,skillEffectId:i.trapData.skillEffect,skillId:i.trapData.skillId,stats:new Map};this.#e.entities.set(f.entityId,f)}).on("ParalyzationStateNotify",o=>{}).on("PartyInfo",o=>{this.#i.partyInfo(o,this.#e.entities,this.#e.localPlayer)}).on("PartyLeaveResult",o=>{let i=o.parsed;i&&this.#i.remove(i.partyInstanceId,i.name)}).on("PartyPassiveStatusEffectAddNotify",o=>{}).on("PartyPassiveStatusEffectRemoveNotify",o=>{}).on("PartyStatusEffectAddNotify",o=>{let i=o.parsed;if(i)for(let f of i.statusEffectDatas){let p=i.playerIdOnRefresh!==0n?i.playerIdOnRefresh:f.sourceId,l=this.#e.getSourceEntity(p);this.#a.RegisterStatusEffect(this.#a.buildStatusEffect(f,i.characterId,l.entityId,0,o.time))}}).on("PartyStatusEffectRemoveNotify",o=>{let i=o.parsed;if(i)for(let f of i.statusEffectIds){let p=this.#a.RemoveStatusEffect(i.characterId,f,0,i.reason,o.time);p&&p.statusEffectId===9701&&this.#s.syncData()}}).on("PartyStatusEffectResultNotify",o=>{let i=o.parsed;i&&this.#i.add(i.raidInstanceId,i.partyInstanceId,i.characterId)}).on("PassiveStatusEffectAddNotify",o=>{}).on("PassiveStatusEffectRemoveNotify",o=>{}).on("RaidBegin",o=>{let i=o.parsed;i&&(this.#n.statQueryFilter.raid.has(i.raidId)?this.#s.zoneSyncStatus|=16:this.#s.zoneSyncStatus|=8)}).on("ZoneMemberLoadStatusNotify",o=>{let i=o.parsed;i&&(this.#n.statQueryFilter.zone.has(i.zoneId)&&i.zoneLevel<=1?this.#s.zoneSyncStatus|=4:this.#s.zoneSyncStatus|=2)}).on("RaidBossKillNotify",o=>{this.#o.onPhaseTransition(1,o.time)}).on("RaidResult",o=>{this.#o.onPhaseTransition(0,o.time)}).on("RemoveObject",o=>{let i=o.parsed;if(i)for(let f of i.unpublishedObjects)this.#a.RemoveLocalObject(f.objectId,o.time)}).on("SkillCastNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.getSourceEntity(i.caster);f=this.#e.guessIsPlayer(f,i.skillId),this.#o.onStartSkill(f,i.skillId,o.time)}).on("SkillDamageAbnormalMoveNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.getSourceEntity(i.sourceId);i.skillDamageAbnormalMoveEvents.forEach(p=>{let l=this.#e.getOrCreateEntity(p.skillDamageEvent.targetId),S=this.#e.getOrCreateEntity(i.sourceId);l.stats.set(1,p.skillDamageEvent.curHp),l.stats.set(27,p.skillDamageEvent.maxHp),this.#o.onDamage(f,S,l,{skillId:i.skillId,skillEffectId:i.skillEffectId,damage:Number(p.skillDamageEvent.damage),modifier:p.skillDamageEvent.modifier,targetCurHp:Number(p.skillDamageEvent.curHp),targetMaxHp:Number(p.skillDamageEvent.maxHp),damageAttr:p.skillDamageEvent.damageAttr??0,damageType:p.skillDamageEvent.damageType},i.skillDamageAbnormalMoveEvents.length,o.time)})}).on("SkillDamageNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.getSourceEntity(i.sourceId);i.skillDamageEvents.forEach(p=>{let l=this.#e.getOrCreateEntity(p.targetId),S=this.#e.getOrCreateEntity(i.sourceId);this.#o.onDamage(f,S,l,{skillId:i.skillId,skillEffectId:i.skillEffectId,damage:Number(p.damage),modifier:p.modifier,targetCurHp:Number(p.curHp),targetMaxHp:Number(p.maxHp),damageAttr:p.damageAttr??0,damageType:p.damageType},i.skillDamageEvents.length,o.time)})}).on("SkillStageNotify",o=>{}).on("SkillStartNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.getSourceEntity(i.sourceId);if(f=this.#e.guessIsPlayer(f,i.skillId),f.entityType===1){let p=f,l=p.skills.get(i.skillId);if(l||(l={effects:new Set,tripods:new Map},p.skills.set(i.skillId,l)),l.level=i.skillLevel,i.skillOptionData.tripodIndex&&i.skillOptionData.tripodLevel){l.tripods||(l.tripods=new Map);for(let[S,b]of["first","second","third"].entries()){if(i.skillOptionData.tripodIndex[b]===0){for(let B=1;B<=3;B++)l.tripods.delete(3*S+B);continue}let T=3*S+i.skillOptionData.tripodIndex[b],Z=i.skillOptionData.tripodLevel[b],L=l.tripods.get(T);if(L&&Z===L.level)continue;for(let B=1;B<=3;B++)l.tripods.delete(3*S+B);let M=this.#n.skillFeature.get(i.skillId)?.get(T),Y=[];M&&M.entries.forEach(B=>{B.level!==0&&B.level!==Z||Y.push(B)}),l.tripods.set(T,{level:i.skillOptionData.tripodLevel[b],options:Y.sort((B,Le)=>Le.level-B.level)})}}}this.#o.onStartSkill(f,i.skillId,o.time)}).on("StatusEffectAddNotify",o=>{let i=o.parsed;if(!i)return;let f=this.#e.getSourceEntity(i.statusEffectData.sourceId);this.#a.RegisterStatusEffect(this.#a.buildStatusEffect(i.statusEffectData,i.objectId,f.entityId,1,o.time))}).on("StatusEffectDurationNotify",o=>{let i=o.parsed;i&&this.#a.UpdateDuration(i.effectInstanceId,i.targetId,i.expirationTick,1)}).on("StatusEffectRemoveNotify",o=>{let i=o.parsed;if(i)for(let f of i.statusEffectIds){let p=this.#a.RemoveStatusEffect(i.objectId,f,1,i.reason,o.time);p&&p.statusEffectId===9701&&this.#s.syncData()}}).on("StatusEffectSyncDataNotify",o=>{let i=o.parsed;i&&this.#a.SyncStatusEffect(i.effectInstanceId,i.characterId,i.objectId,i.value,this.#e.localPlayer.characterId)}).on("TriggerBossBattleStatus",o=>{this.#o.onPhaseTransition(2,o.time)}).on("TriggerFinishNotify",o=>{}).on("TriggerStartNotify",o=>{let i=o.parsed;if(i)switch(i.triggerSignalType){case 57:case 59:case 61:case 63:case 74:case 76:this.#f=!0,this.#u=!1;break;case 58:case 60:case 62:case 64:case 75:case 77:this.#f=!1,this.#u=!0;break;case 27:case 10:case 11:this.#s.syncData()}}).on("TroopMemberUpdateMinNotify",o=>{}).on("ZoneObjectUnpublishNotify",o=>{let i=o.parsed;i&&this.#a.RemoveLocalObject(i.objectId,o.time)}).on("ZoneStatusEffectAddNotify",o=>{}).on("TroopMemberUpdateMinNotify",o=>{let i=o.parsed;if(i&&i.statusEffectDatas.length>0)for(let f of i.statusEffectDatas){let p=this.#r.getEntityId(i.characterId),l=f.value?f.value.readUInt32LE():0,S=f.value?f.value.readUInt32LE(8):0,b=l<S?l:S;this.#a.SyncStatusEffect(f.effectInstanceId,i.characterId,p,b,this.#e.localPlayer.characterId)}}).on("ZoneStatusEffectRemoveNotify",o=>{}),this.#a.on("shieldApplied",o=>{let i=o.targetId;if(o.type===0&&(i=this.#r.getEntityId(o.targetId)??i),i===void 0)return;let f=this.#e.getSourceEntity(o.sourceId),p=this.#e.getOrCreateEntity(i);this.#o.onShieldApplied(p,f,o.statusEffectId,o.value)}).on("shieldChanged",(o,i,f)=>{let p=o.targetId;if(o.type===0&&(p=this.#r.getEntityId(o.targetId)??p),p===void 0)return;let l=this.#e.getSourceEntity(o.sourceId),S=this.#e.getOrCreateEntity(p);this.#o.onShieldUsed(S,l,o.statusEffectId,i-f)})}broadcastStateChange(){this.emit("state-change",this.#o.getBroadcast())}reset(){this.#o.resetState(+new Date)}cancelReset(){this.#o.cancelReset()}updateOptions(t){this.#o.updateOptions(t)}onConnect(t){this.#s.ip||(this.#s.ip=t.split(":")[0],Ou(this.#t,this.#o.options.isLive)&&this.#t.appendLog(new at({account_CharacterId1:0n,serverAddr:t,account_CharacterId2:0n},11,gt)))}get encounters(){return this.#o.splitEncounter(new Date),this.#o.encounters}};function Ou(e,t){return e instanceof na||e.appendLog&&t}0&&(module.exports={Parser});
